    1                                   Прогр sapun { 
    2          
    3          
    4          /*###########################################################*/
    5          /*#########                     #############################*/
    6          /*#########  ОПИСАНИЕ КОНСТАНТ  #############################*/
    7          /*#########                     #############################*/
    8          /*###########################################################*/
    9          /* ?????????????? Таймауты взяты с потолка */
   10          ТАКТ     50;    /* такт равен 500 миллисекундам */
   11          КОНСТ Т0_1                       0;  /* Константа обеспечивающая паузу в 0.5 сек */
   12          КОНСТ ОДНА_СЕКУНДА               2;  /* Константа обеспечивающая паузу в 1 сек */
   13          КОНСТ ДВЕ_СЕКУНДЫ             2*ОДНА_СЕКУНДА;
   14          КОНСТ ТРИ_СЕКУНДЫ             3*ОДНА_СЕКУНДА;
   15          КОНСТ ПЯТЬ_СЕКУНД             5*ОДНА_СЕКУНДА;
   16          КОНСТ ДЕСЯТЬ_СЕКУНД          10*ОДНА_СЕКУНДА;
   17          КОНСТ ДВАДЦАТЬ_СЕКУНД        20*ОДНА_СЕКУНДА;
   18          КОНСТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_ЗАТ_ВАК			10*ОДНА_СЕКУНДА;
   19          КОНСТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_САПУНА           	ДЕСЯТЬ_СЕКУНД;
   20          КОНСТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_УСТР_ПЛАВ_ПУСКА   3*ОДНА_СЕКУНДА;
   21          КОНСТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_ВАК_НАСОСА 		3*ОДНА_СЕКУНДА;
   22          КОНСТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_ВЕНТИЛЯТОРА		ПЯТЬ_СЕКУНД;
   23          КОНСТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_РЕГ_Т				3*ОДНА_СЕКУНДА;
   24          КОНСТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_РЕГ_УР			3*ОДНА_СЕКУНДА;
   25          КОНСТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_НАСОС_ОХЛ			3*ОДНА_СЕКУНДА;
   26          КОНСТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ  ДЕСЯТЬ_СЕКУНД;
   27          КОНСТ ОДНА_МИНУТА          60*ОДНА_СЕКУНДА;
   28          КОНСТ ДВЕ_МИНУТЫ          2*ОДНА_МИНУТА;
   29          КОНСТ ПЯТЬ_МИНУТ          5*60*ОДНА_СЕКУНДА;
   30          /* КОНСТ ТАЙМАУТ_ВАКУУМИРОВАНИЯ_ТРУБЫ  30*ОДНА_МИНУТА;*/
   31          КОНСТ ТРИДЦАТЬ_МИНУТ          30*ОДНА_МИНУТА;
   32          КОНСТ ТАЙМАУТ_ЗАДЕРЖКА_НА_ОТКАЧКУ ПЯТЬ_СЕКУНД;
   33          
   34          КОНСТ ВКЛ                1;
   35          КОНСТ ВЫК               0;
   36          КОНСТ ОТКР              1;
   37          КОНСТ ЗАКР          	0;
   38          КОНСТ ЕСТЬ               1;
   39          КОНСТ НЕТ                0;
   40          КОНСТ НОРМА              1;
   41          КОНСТ ВНЕ_НОРМЫ          0;
   42          
   43          
   44          
   45          КОНСТ ТАЙМАУТ_НА_ДИАГНОСТИКУ_РАЗРЫВА_СВЯЗИ 5*ОДНА_СЕКУНДА;
   46          
   47          КОНСТ Т_ПредельнаяВбакеОхлаждения          99.0; /*?????   градусов*/
   48          
   49          КОНСТ ЗД_P_ВбакеКомпрессора						10.0; /*?????  атмосфер */
   50          
   51          КОНСТ Т_ГИСТЕРЕЗИС_ВОДЫ_В_БАКЕ  1.0;
   52          КОНСТ Т_ГИСТЕРЕЗИС_ВОДЫ_В_РУБАХЕ  1.0;
   53          
   54          
   55          /*===========================================================*/
   56          /*=== КОДЫ СООБЩЕНИЙ КОНТРОЛЯ                               =*/
   57          /*===========================================================*/
   58          ПЕРЕЧИСЛЕНИЕ {
   59              УРОВЕНЬ_ВОДЫ_В_БАКЕ_ОХЛАЖДЕНИЯ_НИЗКИЙ,
   60              УРОВЕНЬ_ВОДЫ_В_БАКЕ_ОХЛАЖДЕНИЯ_ВЫСОКИЙ,
   61          	УРОВЕНЬ_ВОДЫ_В_БАКЕ_ОХЛАЖДЕНИЯ_В_НОРМЕ,
   62          	ТЕМПЕРАТУРА_ВОДЫ_В_БАКЕ_ОХЛАЖДЕНИЯ_НИЗКАЯ,
   63          	ТЕМПЕРАТУРА_ВОДЫ_В_БАКЕ_ОХЛАЖДЕНИЯ_ВЫСОКАЯ,
   64          	ТЕМПЕРАТУРА_ВОДЫ_В_БАКЕ_ОХЛАЖДЕНИЯ_В_НОРМЕ,
   65          
   66              ТЕМПЕРАТУРА_ВОДЫ_В_РУБАШКЕ_ОХЛАЖДЕНИЯ_НИЗКАЯ,
   67          	ТЕМПЕРАТУРА_ВОДЫ_В_РУБАШКЕ_ОХЛАЖДЕНИЯ_ВЫСОКАЯ,
   68          	ТЕМПЕРАТУРА_ВОДЫ_В_РУБАШКЕ_ОХЛАЖДЕНИЯ_В_НОРМЕ,
   69          
   70          	ДАВЛЕНИЕ_В_ВАКУУМНОЙ_ТРУБЕ_В_НОРМЕ,
   71          	ДАВЛЕНИЕ_В_ВАКУУМНОЙ_ТРУБЕ_ВНЕ_НОРМЫ,
   72          	
   73          	СКОРОСТЬ_ОТКАЧКИ_В_НОРМЕ,
   74          	СКОРОСТЬ_ОТКАЧКИ_НИЖЕ_НОРМЫ,
   75          	
   76          	ДАВЛЕНИЕ_В_БАКЕ_КОМПРЕССОРА_В_НОРМЕ,
   77              ДАВЛЕНИЕ_В_БАКЕ_КОМПРЕССОРА_НИЖЕ_НОРМЫ
   78          
   79          
   80          	
   81          };
   82          /*===========================================================*/
   83          /*========= КОМАНДЫ ОПЕРАТОРА ===============================*/
   84          /*===========================================================*/
   85          
   86          
   87          ПЕРЕЧИСЛЕНИЕ {
   88               ОТКР_ЗАТВОР_ВАК= ДАВЛЕНИЕ_В_БАКЕ_КОМПРЕССОРА_НИЖЕ_НОРМЫ + 1,
   89               ЗАКР_ЗАТВОР_ВАК    	,
   90               ОТКР_САПУН			    ,
   91               ЗАКР_САПУН			    ,
   92               ВКЛ_УСТР_ПЛАВ_ПУСКА    ,
   93               ВЫК_УСТР_ПЛАВ_ПУСКА    ,
   94          	 ВКЛ_ПИТ_ВАК_НАСОСА     ,
   95          	 ВЫК_ПИТ_ВАК_НАСОСА     ,
   96          	 ВКЛ_ПИТ_ВЕНТИЛЯТОР    ,
   97          	 ВЫК_ПИТ_ВЕНТИЛЯТОР    ,
   98               ВКЛ_ПИТ_РЕГ_Т    ,
   99          	 ВЫК_ПИТ_РЕГ_Т    ,
  100               ВКЛ_ПИТ_РЕГ_УР     ,
  101          	 ВЫК_ПИТ_РЕГ_УР     , 
  102          	 ВКЛ_ПИТ_НАС_ОХЛ ,
  103          	 ВЫК_ПИТ_НАС_ОХЛ    , 
  104          	 ВКЛ_ВАКУУМИРОВАНИЕ_ТРУБЫ,
  105          	 ВЫК_ВАКУУМИРОВАНИЕ_ТРУБЫ,
  106          	 ВКЛ_НАСОС_ВАКУУМНЫЙ ,
  107          	 ВЫК_НАСОС_ВАКУУМНЫЙ, 
  108               КОМАНДЫ_ОТ_ГУИ = ВЫК_НАСОС_ВАКУУМНЫЙ 
  109          	
  110          };
  111          
  112          
  113          /*===========================================================*/
  114          /*========= КОМАНДЫ ИЗМЕНЕНИЯ ФАКТИЧЕСКИХ ПАРАМЕТРОВ ========*/
  115          /*===========================================================*/
  116          
  117          
  118          ПЕРЕЧИСЛЕНИЕ {
  119          	ИЗМН_ФП_P_ВбакеКомпрессора = КОМАНДЫ_ОТ_ГУИ + 1,
  120          	ИЗМН_ФП_P_Впатрубке,
  121          	ИЗМН_ФП_T_Врубашке,	
  122          	ИЗМН_ФП_T_Вбаке,	
  123              ИЗМН_ФП_P_ВтрубеСидер,
  124              КОМАНДЫ_ИЗМ_ФП = ИЗМН_ФП_P_ВтрубеСидер
  125          };
  126          /*===========================================================*/
  127          /*========= КОДЫ КОМАНД ПОСТУПАЮЩИЕ К ГУИ ===================*/
  128          /*===========================================================*/
  129          /*===========================================================*/
  130          /*============= КОДЫ СООБЩЕНИЙ ВАКУУМНОЙ СИСТЕМЫ ============*/
  131          /*===========================================================*/
  132          /*===========================================================*/
  133          ПЕРЕЧИСЛЕНИЕ {                    
  134                ПК_ГУИ_ОТКАЗ_ОТКРЫТИЯ_ЗАТВОРА_ВАКУУМНОГО = КОМАНДЫ_ИЗМ_ФП + 1,
  135                ПК_ГУИ_ОТКАЗ_ЗАКРЫТИЯ_ЗАТВОРА_ВАКУУМНОГО,
  136                ПК_ГУИ_ОТКАЗ_ОТКРЫТИЯ_САПУНА,
  137                ПК_ГУИ_ОТКАЗ_ЗАКРЫТИЯ_САПУНА,
  138          	  ПК_ГУИ_ОТКАЗ_ВКЛЮЧЕНИЯ_ВЕНТИЛЯТОРА,
  139          	  ПК_ГУИ_ОТКАЗ_ВЫКЛЮЧЕНИЯ_ВЕНТИЛЯТОРА,
  140          	  ПК_ГУИ_ОТКАЗ_ВКЛЮЧЕНИЯ_УСТР_ПЛАВ_ПУСКА,
  141          	  ПК_ГУИ_ОТКАЗ_ВЫКЛЮЧЕНИЯ_УСТР_ПЛАВ_ПУСКА,
  142          	  ПК_ГУИ_ОТКАЗ_ВКЛЮЧЕНИЯ_РЕГУЛЯТОРА_ТЕМПЕРАТУРЫ,
  143          	  ПК_ГУИ_ОТКАЗ_ВЫКЛЮЧЕНИЯ_РЕГУЛЯТОРА_ТЕМПЕРАТУРЫ,
  144          	  ПК_ГУИ_ОТКАЗ_ВКЛЮЧЕНИЯ_РЕГУЛЯТОРА_УРОВНЯ,
  145          	  ПК_ГУИ_ОТКАЗ_ВЫКЛЮЧЕНИЯ_РЕГУЛЯТОРА_УРОВНЯ,
  146          	  ПК_ГУИ_ОТКАЗ_ВКЛЮЧЕНИЯ_НАСОСА_ОХЛАЖДЕНИЯ,
  147          	  ПК_ГУИ_ОТКАЗ_ВЫКЛЮЧЕНИЯ_НАСОСА_ОХЛАЖДЕНИЯ,
  148          	  ПК_ГУИ_ИДЕТ_ВАКУУМИРОВАНИЕ_ОТКАЗ_ВЫПОЛНЕНИЯ_КОМАНДЫ,
  149          	  ПК_ГУИ_НЕТ_УСЛОВИЙ_ДЛЯ_ВЫПОЛНЕНИЯ_КОМАНДЫ,
  150          	  ПК_ГУИ_УРОВЕНЬ_ВОДЫ_В_БАКЕ_ОХЛАЖДЕНИЯ_ВНЕ_НОРМЫ_ОТКАЗ_ВЫПОЛНЕНИЯ_КОМАНДЫ, 				
  151          	  ПК_ГУИ_ОТРИЦАТЕЛЬНАЯ_ТЕМПЕРАТУРА_ВОДЫ_ОТКАЗ_ВЫПОЛНЕНИЯ_КОМАНДЫ,
  152          	  ПК_ГУИ_ДАВЛЕНИЕ_В_ПАТРУБКЕ_НЕ_УМЕНЬШАЕТСЯ,	  
  153          	  ПК_ГУИ_ОТКАЗ_ВКЛЮЧЕНИЯ_ПИТАНИЯ_ВАКУУМНОГО_НАСОСА,
  154          	  ПК_ГУИ_ОТКАЗ_ВЫКЛЮЧЕНИЯ_ПИТАНИЯ_ВАКУУМНОГО_НАСОСА
  155                
  156                
  157          };
  158          /*===========================================================*/
  159          /*========= КОДЫ СООБЩЕНИЙ ИЗМЕНЕНИЙ ФП         =============*/
  160          /*===========================================================*/
  161          ПЕРЕЧИСЛЕНИЕ {                    
  162                ПК_ГУИ_ФП_P_ВбакеКомпрессора = ПК_ГУИ_ОТКАЗ_ВЫКЛЮЧЕНИЯ_ПИТАНИЯ_ВАКУУМНОГО_НАСОСА + 1,
  163                ПК_ГУИ_ФП_P_Впатрубке,
  164                ПК_ГУИ_ФП_T_Врубашке,
  165                ПК_ГУИ_ФП_T_Вбаке,
  166                ПК_ГУИ_ФП_P_ВтрубеСидер
  167                
  168          };
  169          
  170          
  171          
  172          
  173          /*===========================================================*/
  174          /*========= КОДЫ СООБЩЕНИЙ  О НЕВЕРНОЙ КОМАНДЕ ==============*/
  175          /*===========================================================*/
  176          
  177          
  178          ПЕРЕЧИСЛЕНИЕ {
  179               ПК_ГУИ_ОШИБКА_КОДА_КОМАНДЫ_ОТ_ГУИ = ПК_ГУИ_ФП_P_ВтрубеСидер + 1  
  180          }; 
  181          
  182          /*###########################################################*/
  183          /*###########################################################*/
  184          /*########                                          #########*/
  185          /*########  ОПИСАНИЕ ФУНКЦИЙ                        #########*/
  186          /*########                                          #########*/
  187          /*########                                          #########*/
  188          /*###########################################################*/
  189          
  190          /*:::::::::Функции для работы  с ГУИ :::::::::::::::::::::   */
  191          
  192          /*чтение кода и параметра события от ПИВ из кольцевого буфера в память */
  193          ФУНКЦИЯ ЦЕЛ GetNextMsgGUI(ПУСТО);
  194          
  195          ФУНКЦИЯ ЦЕЛ  GetMsgGUICode        (ПУСТО);  /*чтение из памяти кода события */
  196          ФУНКЦИЯ ПЛАВ GetFloatParamPIV     (ПУСТО);  /*чтение из памяти параметра события */
  197          /* ФУНКЦИЯ КЦЕЛ GetShortParamPIV     (ПУСТО); */
  198          ФУНКЦИЯ ЦЕЛ  GetIntParamPIV       (ПУСТО);  /*чтение с экрана гуи - не исползуется */
  199          ФУНКЦИЯ ДЦЕЛ GetLongParamPIV      (ПУСТО);  /*чтение с экрана гуи - не исползуется */
  200          
  201          ФУНКЦИЯ ЦЕЛ  SendMsgGUICode       (ЦЕЛ);
  202          ФУНКЦИЯ ЦЕЛ  SendMsgFloatParamGUI (ЦЕЛ, ПЛАВ);
  203          /* ФУНКЦИЯ ЦЕЛ  SendMsgShortParamPIV (ЦЕЛ, КЦЕЛ); */
  204          /* ФУНКЦИЯ ЦЕЛ  SendMsgIntParamPIV   (ЦЕЛ, ЦЕЛ); */
  205          ФУНКЦИЯ ЦЕЛ  SendMsgLongParamGUI  (ЦЕЛ, ДЦЕЛ);
  206          
  207          ФУНКЦИЯ ЦЕЛ  InitChannelStatus_PIV (ПУСТО); /* инициализация статуса,
  208          обнуление числа ошибок */
  209          ФУНКЦИЯ ЦЕЛ  GetChannelStatus_PIV  (ПУСТО);  /* чтение статуса канала 0/1 - не исползуется*/
  210          ФУНКЦИЯ ЦЕЛ  GetErrorNumberCS_PIV  (ПУСТО);  /* чтение числа ошибок КС  - не исползуется*/
  211          ФУНКЦИЯ ЦЕЛ  GetErrorNumberTO_PIV  (ПУСТО);  /* чтение числа ошибок по тайм ауту - не исползуется*/
  212          ФУНКЦИЯ ЦЕЛ  GetInpMsgNumber_PIV (ПУСТО);  /* чтение числа сообщ. во входн. буфере - не исползуется*/
  213          ФУНКЦИЯ ЦЕЛ  GetOutMsgNumber_PIV (ПУСТО); /* чтение числа сообщ. в выходн. буфере -  не исползуется*/
  214          
  215          ФУНКЦИЯ ПЛАВ GetFP_P_BAK_COMPRESSOR		(ПУСТО);	/* чтение давления в баке компрессора */ 
  216          ФУНКЦИЯ ПЛАВ GetFP_P_PATRUBKA			(ПУСТО);   /* чтение давления  в патрубке      */
  217          ФУНКЦИЯ ПЛАВ GetFP_T_RUBACHKA			(ПУСТО);	/* чтение температуры воды в рубашке охлаждения */
  218          ФУНКЦИЯ ПЛАВ GetFP_T_BAK				(ПУСТО);	/* чтение температуры воды в баке охлаждения */ 
  219          ФУНКЦИЯ ПЛАВ GetFP_P_TRUBA				(ПУСТО);	/* чтение давления в трубе сидера */
  220          
  221          
  222          /*###########################################################*/
  223          /*########                                          #########*/
  224          /*########  ОПИСАНИЕ РЕГИСТРОВ МОДУЛЕЙ УСО          #########*/
  225          /*########  (устройство связи с объектом)           #########*/
  226          /*###########################################################*/
  227          
  228          ВХОД  ЛОГ_ВХОД_GPIO1  0 0 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
  229          ВХОД  ЛОГ_ВХОД_GPIO2  0 1 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
  230          ВХОД  ЛОГ_ВХОД_GPIO5  0 1 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
  231          
  232          /* ВХОД АЦП_T_Вбаке		 			0 66 16; */  /* регистр АЦП */
  233          /*ВХОД АЦП_T_Врубашке	 			0 67 16; */ /* регистр АЦП */
  234          /*ВХОД АЦП_P_ВтрубеСидер	 		0 68 16; */ /* регистр АЦП */
  235          /*ВХОД АЦП_P_Впатрубке 				0 69 16; */ /*   регистр АЦП */
  236          /*ВХОД АЦП_P_ВбакеКомпрессора 		0 70 16; */ /* регистр АЦП */
  237          
  238          
  239          ВЫХОД  ЛОГ_ВЫХОД_GPIO3  1 2 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
  240          ВЫХОД  ЛОГ_ВЫХОД_GPIO4  1 3 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
  241          
  242          
  243          /*###########################################################*/
  244          /*########                                          #########*/
  245          /*########  ПРОЦЕССЫ                                #########*/
  246          /*########                                          #########*/
  247          /*###########################################################*/
  248          
  249          /*
  250           * Процесс Инициализация. Служит для
  251           * развертывания программы. Этот процесс (описанный
  252           * первым) - единственно активный процесс по запуску.
  253           * Кроме этого, процесс Инициализация содержит описание 
  254           * переменных для ссылок из других
  255           * процессов. Это удобно: описания локализованы в одном
  256           * месте.
  257          */
  258          
  259          ПРОЦ Инициализация{
  260          /*===========================================================*/
  261          /*=========== ОПИСАНИЕ ПЕРЕМЕННЫХ ===========================*/
  262          /*===========================================================*/
  263          
  264          /* ВХОДНЫЕ СИГНАЛЫ: */
  265          /*-----------------
  266          /*ЛОГ К_ВЕНТИЛЯТОР                    = {ЛОГ_ВХОД_GPIO1[1]} ДЛЯ ВСЕХ;  
  267          
  268          
  269          -------------------*/
  270          ЛОГ К_ОТКР_ЗАТВОР_ВАК             	= {ЛОГ_ВХОД_GPIO1[1]} ДЛЯ ВСЕХ; /*  концевик затвора вакуумного*/
  271          ЛОГ К_ЗАКР_ЗАТВОР_ВАК             	= {ЛОГ_ВХОД_GPIO1[1]} ДЛЯ ВСЕХ; /*  концевик затвора вакуумного*/
  272          ЛОГ К_САПУН                         = {ЛОГ_ВХОД_GPIO1[1]} ДЛЯ ВСЕХ;
  273          ЛОГ К_УСТР_ПЛАВ_ПУСКА				= {ЛОГ_ВХОД_GPIO1[1]} ДЛЯ ВСЕХ;
  274          ЛОГ К_ПИТ_ВАК_НАСОСА			 	= {ЛОГ_ВХОД_GPIO1[1]} ДЛЯ ВСЕХ; 
  275          ЛОГ К_ВЕНТИЛЯТОР                    = {ЛОГ_ВХОД_GPIO1[1]} ДЛЯ ВСЕХ; 
  276          ЛОГ К_ПИТ_РЕГ_Т 			        = {ЛОГ_ВХОД_GPIO1[1]} ДЛЯ ВСЕХ;
  277          ЛОГ К_ПИТ_РЕГ_УР     				= {ЛОГ_ВХОД_GPIO1[1]} ДЛЯ ВСЕХ;
  278          
  279          ЛОГ К_УР_ВОДЫ_MIN  					= {ЛОГ_ВХОД_GPIO2[1]} ДЛЯ ВСЕХ;
  280          ЛОГ К_УР_ВОДЫ_MAX   				= {ЛОГ_ВХОД_GPIO2[1]} ДЛЯ ВСЕХ;
  281          /* ЛОГ К_УР_ВОДЫ_АВАРИЯ				= {ЛОГ_ВХОД_GPIO2[1]} ДЛЯ ВСЕХ; */
  282          ЛОГ К_НАСОС_ОХЛ 					= {ЛОГ_ВХОД_GPIO2[1]} ДЛЯ ВСЕХ;
  283          
  284          
  285          /* ВЫХОДНЫЕ СИГНАЛЫ (т.к. привязаны к модулю выходов): */ 
  286          
  287          ЛОГ У_ВКЛ_ПИТ_ВЕНТИЛЯТОР   			= {ЛОГ_ВЫХОД_GPIO3[1]} ДЛЯ ВСЕХ; 
  288          ЛОГ У_ВЫК_ПИТ_ВЕНТИЛЯТОР  			= {ЛОГ_ВЫХОД_GPIO3[1]} ДЛЯ ВСЕХ;	
  289          ЛОГ У_ВКЛ_ПИТ_РЕГ_Т      			= {ЛОГ_ВЫХОД_GPIO3[1]} ДЛЯ ВСЕХ;            
  290          ЛОГ У_ВЫК_ПИТ_РЕГ_Т      			= {ЛОГ_ВЫХОД_GPIO3[1]} ДЛЯ ВСЕХ;  
  291          ЛОГ У_ВКЛ_ПИТ_НАС_ОХЛ				= {ЛОГ_ВЫХОД_GPIO3[1]} ДЛЯ ВСЕХ; 
  292          ЛОГ У_ВЫК_ПИТ_НАС_ОХЛ				= {ЛОГ_ВЫХОД_GPIO3[1]} ДЛЯ ВСЕХ; 	
  293          ЛОГ У_ВКЛ_ПИТ_ВАК_НАСОСА       		= {ЛОГ_ВЫХОД_GPIO3[1]} ДЛЯ ВСЕХ;                    
  294          ЛОГ У_ВЫК_ПИТ_ВАК_НАСОСА           	= {ЛОГ_ВЫХОД_GPIO3[1]} ДЛЯ ВСЕХ;   
  295          
  296          
  297          ЛОГ У_ОТКР_ЗАТВОР_ВАК				= {ЛОГ_ВЫХОД_GPIO4[1]} ДЛЯ ВСЕХ; 
  298          ЛОГ У_ОТКР_САПУН 					= {ЛОГ_ВЫХОД_GPIO4[1]} ДЛЯ ВСЕХ;
  299          ЛОГ У_ВКЛ_УСТР_ПЛАВ_ПУСКА        	= {ЛОГ_ВЫХОД_GPIO4[1]} ДЛЯ ВСЕХ;                   
  300          ЛОГ У_ВЫК_УСТР_ПЛАВ_ПУСКА      		= {ЛОГ_ВЫХОД_GPIO4[1]} ДЛЯ ВСЕХ;  
  301          ЛОГ У_ВКЛ_ПИТ_РЕГ_УР      			= {ЛОГ_ВЫХОД_GPIO4[1]} ДЛЯ ВСЕХ; 
  302          	
  303          ЛОГ ОШИБКА_ФУНКЦИОНИРОВАНИЯ  		= {ЛОГ_ВЫХОД_GPIO4[1]} ДЛЯ ВСЕХ;  /*резерв */
  304          /* предложение Саши Курочкина: ввести ошибку функционирования для контроля всех устройств, */
  305          /* составляющих вакуумную подсистему. Если Саша не достучится до них, или две единички одновременно */
  306          /* увидит у себя (ВКЛ/ВЫКЛ, например вентилятор). Правда, что в этом случае делать D2 - непонятно*/
  307          /* Предлагается ошибку функционирования обнулять перед каждым запуском соответствующего процесса */ 
  308          /* например: ВКЛ_ПИТ_ВЕНТИЛЯТОР, ВЫК_ПИТ_ВЕНТИЛЯТОР*/
  309          /* И еще, для каждой ошибки функционирования будет int - код ошибки */
  310          /* И еще, Саша говорит, что при обнаружении ош. функционирования надо прекращать вакуумирование ???*/
  311          
  312          ЛОГ ОШИБКА_ФУНКЦ_ЗАТВОР_ВАК 			= {ЛОГ_ВХОД_GPIO5[1]} ДЛЯ ВСЕХ;
  313          ЛОГ ОШИБКА_ФУНКЦ_САПУН 					= {ЛОГ_ВХОД_GPIO5[1]} ДЛЯ ВСЕХ;
  314          ЛОГ ОШИБКА_ФУНКЦ_УСТР_ПЛАВ_ПУСКА 		= {ЛОГ_ВХОД_GPIO5[1]} ДЛЯ ВСЕХ;
  315          ЛОГ ОШИБКА_ФУНКЦ_ПИТ_ВАК_НАСОСА 		= {ЛОГ_ВХОД_GPIO5[1]} ДЛЯ ВСЕХ;
  316          ЛОГ ОШИБКА_ФУНКЦ_ВЕНТИЛЯТОР 			= {ЛОГ_ВХОД_GPIO5[1]} ДЛЯ ВСЕХ;
  317          ЛОГ ОШИБКА_ФУНКЦ_ПИТ_РЕГ_Т 				= {ЛОГ_ВХОД_GPIO5[1]} ДЛЯ ВСЕХ;
  318          ЛОГ ОШИБКА_ФУНКЦ_ПИТ_РЕГ_УР 			= {ЛОГ_ВХОД_GPIO5[1]} ДЛЯ ВСЕХ;
  319          ЛОГ ОШИБКА_ФУНКЦ_НАСОС_ОХЛ 				= {ЛОГ_ВХОД_GPIO5[1]} ДЛЯ ВСЕХ;
  320          
  321          
  322          /*===========================================================*/
  323          /*=========== ЯЧЕЙКИ ИНФОРМАЦИОННЫХ КАНАЛОВ =================*/
  324          /*===========================================================*/
  325          ЦЕЛ КодСобытия_от_ГУИ        ДЛЯ ВСЕХ;
  326          ЦЕЛ КодСобытия_к_ГУИ         ДЛЯ ВСЕХ;
  327          
  328            
  329            
  330          /*===========================================================*/
  331          /*=========== ЯЧЕЙКИ ОБЩЕГО УПРАВЛЕНИЯ ======================*/
  332          /*===========================================================*/
  333          ЛОГ ФлагГотовУрВодыБО ДЛЯ ВСЕХ;  /* Флаг установлен, если уровень воды в баке охлаждения в норме*/ 
  334          ЛОГ ФлагГотовТемпВодыБО ДЛЯ ВСЕХ;  /* Флаг установлен, если  температура в баке охлаждения в норме*/ 
  335          ЛОГ ФлагГотовTВодыРО ДЛЯ ВСЕХ;  /* Флаг установлен, если  температура в рубашке охлаждения в норме*/ 
  336          ЛОГ ФлагГотовВакуумаВТ ДЛЯ ВСЕХ;
  337          ЛОГ ФлагОткачкиТрубыСидеростата ДЛЯ ВСЕХ;
  338          ЛОГ ФлагДавленияКомпрессора ДЛЯ ВСЕХ;
  339          
  340          ДЦЕЛ ЗАДЕРЖКА_НА_РАЗГРУЗКУ_ТРАФИКА ДЛЯ ВСЕХ; /* чтобы в отмену не уходить */
  341          
  342          
  343          /*===========================================================*/
  344          /*=========== ФАКТИЧЕСКИЕ ПАРАМЕТРЫ =========================*/
  345          /*===========================================================*/
  346          /*ПЛАВ ФП_Pтрубы ДЛЯ ВСЕХ;*/
  347          /* ????????????????????????????????????????????????????????????????? */
  348          /*  Саша Курочкин будет ацепировать */
  349          /*ЦЕЛ	ФП_P_ВбакеКомпрессора 	= {P_ВбакеКомпрессора [16]} 	ДЛЯ ВСЕХ; */
  350          /*ЦЕЛ	ФП_P_Впатрубке	 		= {P_Впатрубке [16]}			ДЛЯ ВСЕХ; 	*/
  351          /*ЦЕЛ	ФП_T_Врубашке 			= {T_Врубашке [16]}				ДЛЯ ВСЕХ; 	*/
  352          /*ЦЕЛ	ФП_T_Вбаке 				= {T_Вбаке [16]}				ДЛЯ ВСЕХ;	*/ 
  353          /*ЦЕЛ	ФП_P_ВтрубеСидер 		= {P_ВтрубеСидер [16]} 			ДЛЯ ВСЕХ; 	*/
  354          
  355          
  356          ПЛАВ ФП_P_ВбакеКомпрессора ДЛЯ ВСЕХ; 
  357          ПЛАВ ФП_P_Впатрубке ДЛЯ ВСЕХ;
  358          ПЛАВ ФП_T_Врубашке ДЛЯ ВСЕХ;	
  359          ПЛАВ ФП_T_Вбаке ДЛЯ ВСЕХ;
  360          
  361          ПЛАВ ЗД_P_ВтрубеСидер ДЛЯ ВСЕХ;	
  362          ПЛАВ ФП_P_ВтрубеСидер ДЛЯ ВСЕХ;
  363          
  364          
  365          /*########  СОСТОЯНИЯ ПРОЦЕССА  #########*/
  366           СОСТ Начало{  /* NB: 1-е f-сост. 1-го процесс. - активно по включению питания */
  367              	ЗАДЕРЖКА_НА_РАЗГРУЗКУ_ТРАФИКА = 1; /* параметр регулирует частоту подачи сообщений в зависимости от заполненности буфера сообщ  368          ений... */
  369               ОШИБКА_ФУНКЦИОНИРОВАНИЯ = ВЫК;
  370          	ЗД_P_ВтрубеСидер = 0.02;   /* ????? Уточнить */
  371          	
  372          /* СТАРТ ПРОЦ ЧтениеАЦП; */
  373          	СТАРТ ПРОЦ ЧтениеФактПараметров_с_Датчиков;
  374          	СТАРТ ПРОЦ ЧтениеКольцевогоБуфера;
  375          	СТАРТ ПРОЦ КонтрольИзменения_ФП_P_ВбакеКомпрессора;
  376          	СТАРТ ПРОЦ КонтрольИзменения_ФП_P_Впатрубке;
  377          	СТАРТ ПРОЦ КонтрольИзменения_ФП_T_Врубашке;
  378          	СТАРТ ПРОЦ КонтрольИзменения_ФП_T_Вбаке;
  379          	СТАРТ ПРОЦ КонтрольИзменения_ФП_P_ВтрубеСидер;
  380          
  381          	ЕСЛИ (!К_ПИТ_РЕГ_Т) СТАРТ ПРОЦ ВКЛ_ПИТ_РЕГ_Т;   /* питание всегда включено. На всякий случай */
  382          	
  383          	СТАРТ ПРОЦ ВКЛ_ПИТ_РЕГ_УР;
  384          
  385          	
  386          	СТАРТ ПРОЦ КонтрольУровняВодыБакаОхлаждения;
  387          	СТАРТ ПРОЦ КонтрольТемпературыРубашкиОхлаждения;
  388          	СТАРТ ПРОЦ КонтрольДавленияВбакеКомпрессора;
  389          	СТАРТ ПРОЦ КонтрольГотовностиВакуума_в_Вакуумной_Трубе;	
  390          	СТАРТ ПРОЦ КонтрольТемпературыВодыБакаОхлаждения;	
  391          /*	СТАРТ ПРОЦ КонтрольОткачкиВауумнойТрубыСидеростата;	*/
  392          /*контроль откачки из вакуумной трубы запускаем в процессе ВКЛ_ВАКУУМИРОВАНИЕ_ТРУБЫ  */
  393          /*  ВЫК_НАСОС_ВАКУУМНЫЙ*/
  394          	СТОП;
  395             }
  396          }
  397          
  398          /*========================================================*/
  399          /*                                                        */
  400          /*==            ЧТЕНИЕ ФАКТИЧЕСКИХ ПАРАМЕТРОВ           ==*/
  401          /*                                                        */
  402          /*========================================================*/
  403          ПРОЦ ЧтениеФактПараметров_с_Датчиков{
  404          ИЗ ПРОЦ Инициализация ФП_P_ВбакеКомпрессора,
  405                                ФП_P_Впатрубке,
  406                                ФП_T_Врубашке,
  407                                ФП_T_Вбаке,
  408          					  ФП_P_ВтрубеСидер;
  409          
  410          
  411           СОСТ Начало {
  412          	ФП_P_ВбакеКомпрессора 	= GetFP_P_BAK_COMPRESSOR();     /* чтение давления в баке компрессора */
  413          	ФП_P_Впатрубке 		= GetFP_P_PATRUBKA();     			/* чтение давления  в патрубке      */
  414          	ФП_T_Врубашке 		= GetFP_T_RUBACHKA();     			/* чтение температуры воды в рубашке охлаждения */   
  415          	ФП_T_Вбаке 			= GetFP_T_BAK();     				/* чтение температуры воды в баке охлаждения */ 
  416          	ФП_P_ВтрубеСидер 	= GetFP_P_TRUBA();     				/* чтение давления в трубе сидера */ 
  417             В СОСТ Начало;
  418           }
  419          }
  420          
  421          /*==============================================*/
  422          /*==============================================*/
  423          /*=                                            =*/
  424          /*=      ПРОЦЕСС ЧтениеКольцевогоБуфера        =*/
  425          /*=                                            =*/
  426          /*==============================================*/
  427          /*==============================================*/
  428          ПРОЦ ЧтениеКольцевогоБуфера{
  429          ИЗ ПРОЦ Инициализация
  430           /*                        ТекущийРежим, ТекущийЭтап,  Т_НА_СРАБАТЫВАНИЕ_УСТРОЙСТВ_ГВС,*/
  431                                  КодСобытия_от_ГУИ;       /* */
  432          
  433           СОСТ Начало{
  434              /*  читаем код и параметр события из кольцевого буфера в структуру */
  435              ЕСЛИ (GetNextMsgGUI()) {
  436                КодСобытия_от_ГУИ = GetMsgGUICode();
  437                      ЕСЛИ ((КодСобытия_от_ГУИ >= ОТКР_ЗАТВОР_ВАК) &&
  438                            (КодСобытия_от_ГУИ <= КОМАНДЫ_ОТ_ГУИ)) {
  439          				СТАРТ ПРОЦ ОбработкаКомандУправления_от_ГУИ;
  440          				В СОСТ КонтрольВыполненияК;
  441                       } 
  442          			 ИНАЧЕ В СОСТ НекорректноеСобытие;
  443          
  444          
  445          
  446                
  447              } /* конец ЕСЛИ */
  448           }
  449           СОСТ КонтрольВыполненияК{
  450              ЕСЛИ(ПРОЦ ОбработкаКомандУправления_от_ГУИ В СОСТ ПАССИВНОЕ)
  451              В СОСТ Начало;
  452           }
  453            СОСТ НекорректноеСобытие{
  454               ЕСЛИ (SendMsgLongParamGUI(ПК_ГУИ_ОШИБКА_КОДА_КОМАНДЫ_ОТ_ГУИ, КодСобытия_от_ГУИ))
  455                 В СОСТ Начало;
  456               ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
  457           }
  458            /*===== НЕНОРМАЛЬНЫЕ СИТУАЦИИ === */
  459           СОСТ НарушениеСвязи {
  460               СТОП;   /* м.б. в начало?*/
  461           }
  462          
  463          }
  464          
  465          /*=========================================*/
  466          /*=                                       =*/
  467          /*=     ОБРАБОТКА КОМАНД ОТ ГУИ           =*/
  468          /*=                                       =*/
  469          /*=========================================*/
  470          ПРОЦ ОбработкаКомандУправления_от_ГУИ{
  471          ИЗ ПРОЦ Инициализация
  472          						/*	ТекущийРежим,*/
  473                              КодСобытия_от_ГУИ,
  474          					К_УСТР_ПЛАВ_ПУСКА,
  475          					ФлагГотовУрВодыБО,
  476          					ФП_T_Вбаке,
  477          					К_ВЕНТИЛЯТОР,
  478          					К_НАСОС_ОХЛ,
  479          					К_ОТКР_ЗАТВОР_ВАК,
  480          					К_ЗАКР_ЗАТВОР_ВАК,
  481          					К_САПУН,
  482          					ФлагГотовTВодыРО;
  483          ЦЕЛ ЛП_КодСообщенияДляGUI ЛОКАЛ;
  484          
  485           СОСТ Анализ{
  486              РАЗБОР (КодСобытия_от_ГУИ) {
  487          	    СЛУЧАЙ ОТКР_ЗАТВОР_ВАК:
  488          			СТАРТ ПРОЦ ОТКР_ЗАТВОР_ВАК;
  489          			КОНЕЦ;
  490          	    СЛУЧАЙ ЗАКР_ЗАТВОР_ВАК:
  491          			СТАРТ ПРОЦ ЗАКР_ЗАТВОР_ВАК;
  492          			КОНЕЦ;		  
  493          	    СЛУЧАЙ ОТКР_САПУН:
  494          		  ЕСЛИ (К_УСТР_ПЛАВ_ПУСКА == ВЫК) { /* вакуумирование не включено*/
  495          			СТАРТ ПРОЦ ОТКР_САПУН; 
  496          		  } ИНАЧЕ {
  497          		    ЛП_КодСообщенияДляGUI = ПК_ГУИ_ИДЕТ_ВАКУУМИРОВАНИЕ_ОТКАЗ_ВЫПОЛНЕНИЯ_КОМАНДЫ;
  498          			В СОСТ ПередачаСообщенияСПараметромГУИ;
  499          		  }
  500          		  КОНЕЦ;
  501          	    СЛУЧАЙ ЗАКР_САПУН:
  502          		  ЕСЛИ (К_УСТР_ПЛАВ_ПУСКА == ВЫК) { /* вакуумирование не включено*/
  503          			СТАРТ ПРОЦ ЗАКР_САПУН; 
  504          		  } ИНАЧЕ {
  505          		    ЛП_КодСообщенияДляGUI = ПК_ГУИ_ИДЕТ_ВАКУУМИРОВАНИЕ_ОТКАЗ_ВЫПОЛНЕНИЯ_КОМАНДЫ;
  506          			В СОСТ ПередачаСообщенияСПараметромГУИ;
  507          		  }
  508          		  КОНЕЦ;
  509          
  510          		СЛУЧАЙ ВКЛ_УСТР_ПЛАВ_ПУСКА:
  511          			ЕСЛИ (К_УСТР_ПЛАВ_ПУСКА == ВЫК) { /* вакуумирование не включено*/
  512          				ЕСЛИ ((ФлагГотовУрВодыБО == НОРМА) && (К_ВЕНТИЛЯТОР)
  513          						&& (К_НАСОС_ОХЛ)&& (К_ЗАКР_ЗАТВОР_ВАК) && (К_САПУН)
  514          						&& (ФлагГотовTВодыРО == НОРМА)) {   /* можно включать */
  515          						СТАРТ ПРОЦ ВКЛ_УСТР_ПЛАВ_ПУСКА;
  516          				} ИНАЧЕ {
  517          					ЛП_КодСообщенияДляGUI = ПК_ГУИ_НЕТ_УСЛОВИЙ_ДЛЯ_ВЫПОЛНЕНИЯ_КОМАНДЫ;
  518          					В СОСТ ПередачаСообщенияСПараметромГУИ;
  519          				}
  520          			} ИНАЧЕ {
  521          				ЛП_КодСообщенияДляGUI = ПК_ГУИ_ИДЕТ_ВАКУУМИРОВАНИЕ_ОТКАЗ_ВЫПОЛНЕНИЯ_КОМАНДЫ;
  522          				В СОСТ ПередачаСообщенияСПараметромГУИ;
  523          			}			
  524          			КОНЕЦ;
  525          	
  526          			
  527          	    СЛУЧАЙ ВЫК_УСТР_ПЛАВ_ПУСКА:   /* вопрос: надо ли вообще выключать его. М.б. достаточно выкл питание????*/
  528          			СТАРТ ПРОЦ ВЫК_УСТР_ПЛАВ_ПУСКА;
  529          			КОНЕЦ;	
  530          		СЛУЧАЙ ВКЛ_ПИТ_ВАК_НАСОСА:			
  531                    СТАРТ ПРОЦ ВКЛ_ПИТ_ВАК_НАСОСА;
  532                    КОНЕЦ;
  533          	    СЛУЧАЙ ВЫК_ПИТ_ВАК_НАСОСА:
  534                    СТАРТ ПРОЦ ВЫК_ПИТ_ВАК_НАСОСА;
  535                    КОНЕЦ;			  
  536          	    СЛУЧАЙ ВКЛ_ПИТ_ВЕНТИЛЯТОР:
  537          		  ЕСЛИ (К_УСТР_ПЛАВ_ПУСКА == ВЫК) {  /* вакуумирование не включено*/
  538          			СТАРТ ПРОЦ ВКЛ_ПИТ_ВЕНТИЛЯТОР; 
  539          		  } ИНАЧЕ {
  540          		    ЛП_КодСообщенияДляGUI = ПК_ГУИ_ИДЕТ_ВАКУУМИРОВАНИЕ_ОТКАЗ_ВЫПОЛНЕНИЯ_КОМАНДЫ;
  541          			В СОСТ ПередачаСообщенияСПараметромГУИ;
  542          			}
  543                    КОНЕЦ;
  544          	    СЛУЧАЙ ВЫК_ПИТ_ВЕНТИЛЯТОР:
  545                    ЕСЛИ (К_УСТР_ПЛАВ_ПУСКА == ВЫК) { /* вакуумирование не включено*/
  546          			СТАРТ ПРОЦ ВЫК_ПИТ_ВЕНТИЛЯТОР; 
  547          		  } ИНАЧЕ {  /* идет вакуумирование*/
  548          		    ЛП_КодСообщенияДляGUI = ПК_ГУИ_ИДЕТ_ВАКУУМИРОВАНИЕ_ОТКАЗ_ВЫПОЛНЕНИЯ_КОМАНДЫ;
  549          			В СОСТ ПередачаСообщенияСПараметромГУИ;
  550          		  } 
  551                    КОНЕЦ;
  552          	    СЛУЧАЙ ВКЛ_ПИТ_РЕГ_Т:
  553          		  ЕСЛИ(К_УСТР_ПЛАВ_ПУСКА == ВЫК) {   /* вакуумирование не включено*/
  554          		  
  555          /*				ЕСЛИ ((ФлагГотовУрВодыБО = НОРМА) && (ФП_T_Вбаке > 0.0)) СТАРТ ПРОЦ ВКЛ_ПИТ_РЕГ_Т;  */
  556          
  557          				ЕСЛИ (ФлагГотовУрВодыБО == НОРМА) {
  558          					ЕСЛИ (ФП_T_Вбаке > 0.0) {
  559          						СТАРТ ПРОЦ ВКЛ_ПИТ_РЕГ_Т;
  560          					} ИНАЧЕ {
  561          					 ЛП_КодСообщенияДляGUI = ПК_ГУИ_ОТРИЦАТЕЛЬНАЯ_ТЕМПЕРАТУРА_ВОДЫ_ОТКАЗ_ВЫПОЛНЕНИЯ_КОМАНДЫ;
  562          					 В СОСТ ПередачаСообщенияСПараметромГУИ;
  563          					}
  564          				ЛП_КодСообщенияДляGUI = ПК_ГУИ_УРОВЕНЬ_ВОДЫ_В_БАКЕ_ОХЛАЖДЕНИЯ_ВНЕ_НОРМЫ_ОТКАЗ_ВЫПОЛНЕНИЯ_КОМАНДЫ;
  565          				В СОСТ ПередачаСообщенияСПараметромГУИ;				
  566          				}
  567          				
  568          		  } ИНАЧЕ {   /* идет вакуумирование*/
  569          		    ЛП_КодСообщенияДляGUI = ПК_ГУИ_ИДЕТ_ВАКУУМИРОВАНИЕ_ОТКАЗ_ВЫПОЛНЕНИЯ_КОМАНДЫ;
  570          			В СОСТ ПередачаСообщенияСПараметромГУИ;
  571          		  }
  572          		  КОНЕЦ;
  573          	    СЛУЧАЙ ВЫК_ПИТ_РЕГ_Т:
  574          		  ЕСЛИ(К_УСТР_ПЛАВ_ПУСКА == ВЫК) {   /* вакуумирование не включено*/
  575          			СТАРТ ПРОЦ ВЫК_ПИТ_РЕГ_Т;
  576          		  } ИНАЧЕ {   /* идет вакуумирование*/
  577          		    ЛП_КодСообщенияДляGUI = ПК_ГУИ_ИДЕТ_ВАКУУМИРОВАНИЕ_ОТКАЗ_ВЫПОЛНЕНИЯ_КОМАНДЫ;
  578          			В СОСТ ПередачаСообщенияСПараметромГУИ;
  579          		  }
  580                    КОНЕЦ;
  581          	    СЛУЧАЙ ВКЛ_ПИТ_РЕГ_УР:
  582          		  ЕСЛИ(К_УСТР_ПЛАВ_ПУСКА == ВЫК) {   /* вакуумирование не включено*/
  583          		  	СТАРТ ПРОЦ ВКЛ_ПИТ_РЕГ_УР;
  584          		  } ИНАЧЕ {   /* идет вакуумирование*/
  585          		    ЛП_КодСообщенияДляGUI = ПК_ГУИ_ИДЕТ_ВАКУУМИРОВАНИЕ_ОТКАЗ_ВЫПОЛНЕНИЯ_КОМАНДЫ;
  586          			В СОСТ ПередачаСообщенияСПараметромГУИ;
  587          		  } 
  588                    КОНЕЦ;
  589          	    СЛУЧАЙ ВЫК_ПИТ_РЕГ_УР:
  590          		  ЕСЛИ(К_УСТР_ПЛАВ_ПУСКА == ВЫК) {   /* вакуумирование не включено*/
  591          		  	СТАРТ ПРОЦ ВЫК_ПИТ_РЕГ_УР;
  592          		  } ИНАЧЕ {   /* идет вакуумирование*/
  593          		    ЛП_КодСообщенияДляGUI = ПК_ГУИ_ИДЕТ_ВАКУУМИРОВАНИЕ_ОТКАЗ_ВЫПОЛНЕНИЯ_КОМАНДЫ;
  594          			В СОСТ ПередачаСообщенияСПараметромГУИ;
  595          		  } 
  596          		  КОНЕЦ;
  597          	    СЛУЧАЙ ВКЛ_ПИТ_НАС_ОХЛ:
  598          		  ЕСЛИ(К_УСТР_ПЛАВ_ПУСКА == ВЫК) {   /* вакуумирование не включено*/
  599          				ЕСЛИ ((ФлагГотовУрВодыБО = НОРМА) && (ФП_T_Вбаке > 0.0)) СТАРТ ПРОЦ ВКЛ_ПИТ_НАС_ОХЛ;
  600          		  } ИНАЧЕ {   /* идет вакуумирование*/
  601          		    ЛП_КодСообщенияДляGUI = ПК_ГУИ_ИДЕТ_ВАКУУМИРОВАНИЕ_ОТКАЗ_ВЫПОЛНЕНИЯ_КОМАНДЫ;
  602          			В СОСТ ПередачаСообщенияСПараметромГУИ;
  603          		  }
  604          		  КОНЕЦ;
  605          	    СЛУЧАЙ ВЫК_ПИТ_НАС_ОХЛ:
  606          		  ЕСЛИ(К_УСТР_ПЛАВ_ПУСКА == ВЫК) {   /* вакуумирование не включено*/
  607          		  	СТАРТ ПРОЦ ВЫК_ПИТ_НАС_ОХЛ;
  608          		  } ИНАЧЕ {   /* идет вакуумирование*/
  609          		    ЛП_КодСообщенияДляGUI = ПК_ГУИ_ИДЕТ_ВАКУУМИРОВАНИЕ_ОТКАЗ_ВЫПОЛНЕНИЯ_КОМАНДЫ;
  610          			В СОСТ ПередачаСообщенияСПараметромГУИ;
  611          		  } 		
  612          		  КОНЕЦ;
  613          		  
  614          /*	    СЛУЧАЙ ВКЛ_НАСОС_ВАКУУМНЫЙ:   */
  615          /*          СТАРТ ПРОЦ ВКЛ_НАСОС_ВАКУУМНЫЙ; */
  616          /*          КОНЕЦ;  */
  617          /*	    СЛУЧАЙ ВЫК_НАСОС_ВАКУУМНЫЙ:  */
  618          /*          СТАРТ ПРОЦ ВЫК_НАСОС_ВАКУУМНЫЙ; */
  619          /*          КОНЕЦ;  */
  620          
  621          		  СЛУЧАЙ ВКЛ_ВАКУУМИРОВАНИЕ_ТРУБЫ:   /* достигает вакуума и выключает вак. насос и через 30 минут снова включает, если вакуума не  622          достаточно */
  623                    СТАРТ ПРОЦ ВКЛ_ВАКУУМИРОВАНИЕ_ТРУБЫ;
  624                    КОНЕЦ;
  625          	    СЛУЧАЙ ВЫК_ВАКУУМИРОВАНИЕ_ТРУБЫ:
  626                    СТАРТ ПРОЦ ВЫК_ВАКУУМИРОВАНИЕ_ТРУБЫ;
  627                    КОНЕЦ;
  628          		УМОЛЧАНИЕ:
  629                    В СОСТ НекорректноеСобытие;
  630                    КОНЕЦ;
  631              } /* конец разбора */
  632           }
  633          
  634          
  635           /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
  636           СОСТ НекорректноеСобытие {
  637              ЕСЛИ (SendMsgLongParamGUI(ПК_ГУИ_ОШИБКА_КОДА_КОМАНДЫ_ОТ_ГУИ, КодСобытия_от_ГУИ))
  638                   СТОП;   
  639              ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
  640           }
  641           СОСТ ПередачаСообщенияСПараметромГУИ{
  642              ЕСЛИ (SendMsgLongParamGUI(ЛП_КодСообщенияДляGUI, КодСобытия_от_ГУИ))
  643                  СТОП;
  644              ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
  645           }
  646          
  647           СОСТ НарушениеСвязи {
  648              ОШИБКА;
  649           }
  650          } /* конец ПРОЦ ОбработкаКомандУправленияРегуляторами_от_ПИВ   */
  651          
  652          /*====================================================*/
  653          /*					ПРОЦЕСС КОНТРОЛЯ				  */
  654          /*==           изменения ФП_P_ВбакеКомпрессора        */
  655          /*====================================================*/
  656          ПРОЦ КонтрольИзменения_ФП_P_ВбакеКомпрессора{
  657           ИЗ ПРОЦ Инициализация  ФП_P_ВбакеКомпрессора, ЗАДЕРЖКА_НА_РАЗГРУЗКУ_ТРАФИКА;
  658           ПЛАВ ЛП_Предыдущее ЛОКАЛ;
  659           СОСТ Начало{
  660              ЛП_Предыдущее = (!ФП_P_ВбакеКомпрессора);
  661              В СЛЕДУЮЩЕЕ;
  662           }
  663           СОСТ КонтрольИзменения{
  664              ЕСЛИ (ЛП_Предыдущее != ФП_P_ВбакеКомпрессора) {
  665                   ЛП_Предыдущее = ФП_P_ВбакеКомпрессора;
  666                   В СЛЕДУЮЩЕЕ;
  667              }
  668           }
  669           СОСТ СообщОбИзменении{
  670               ЕСЛИ (SendMsgFloatParamGUI(ПК_ГУИ_ФП_P_ВбакеКомпрессора, ЛП_Предыдущее))
  671                   В СОСТ ТрафикПауза;
  672               ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
  673           }
  674           СОСТ ТрафикПауза{
  675              ТАЙМАУТ ЗАДЕРЖКА_НА_РАЗГРУЗКУ_ТРАФИКА В СОСТ КонтрольИзменения;
  676          
  677           }
  678          /* НЕНОРМАЛЬНЫЕ СИТУАЦИИ */
  679           СОСТ НарушениеСвязи{
  680               В СОСТ КонтрольИзменения;
  681           }
  682          }
  683          /* ПРОЦ КонтрольИзменения_ФП_P_ВбакеКомпрессора  */
  684          
  685          /*====================================================*/
  686          /*					ПРОЦЕСС КОНТРОЛЯ				  */
  687          /*==           изменения ИЗМН_ФП_P_Впатрубке     */
  688          /*====================================================*/
  689          ПРОЦ КонтрольИзменения_ФП_P_Впатрубке{
  690           ИЗ ПРОЦ Инициализация  ФП_P_Впатрубке, ЗАДЕРЖКА_НА_РАЗГРУЗКУ_ТРАФИКА;
  691           ПЛАВ ЛП_Предыдущее ЛОКАЛ;
  692           СОСТ Начало{
  693              ЛП_Предыдущее = (!ФП_P_Впатрубке);
  694              В СЛЕДУЮЩЕЕ;
  695           }
  696           СОСТ КонтрольИзменения{
  697              ЕСЛИ (ЛП_Предыдущее != ФП_P_Впатрубке) {
  698                   ЛП_Предыдущее = ФП_P_Впатрубке;
  699                   В СЛЕДУЮЩЕЕ;
  700              }
  701           }
  702           СОСТ СообщОбИзменении{
  703               ЕСЛИ (SendMsgFloatParamGUI(ПК_ГУИ_ФП_P_Впатрубке, ЛП_Предыдущее))
  704                   В СОСТ ТрафикПауза;
  705               ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
  706           }
  707           СОСТ ТрафикПауза{
  708              ТАЙМАУТ ЗАДЕРЖКА_НА_РАЗГРУЗКУ_ТРАФИКА В СОСТ КонтрольИзменения;
  709          
  710           }
  711          /* НЕНОРМАЛЬНЫЕ СИТУАЦИИ */
  712           СОСТ НарушениеСвязи{
  713               В СОСТ КонтрольИзменения;
  714           }
  715          }
  716          /* ПРОЦ КонтрольИзменения_ФП_P_Впатрубке  */
  717          
  718          /*====================================================*/
  719          /*					ПРОЦЕСС КОНТРОЛЯ				  */
  720          /*==           изменения ИЗМН_ФП_T_Врубашке     */
  721          /*====================================================*/
  722          ПРОЦ КонтрольИзменения_ФП_T_Врубашке{
  723           ИЗ ПРОЦ Инициализация  ФП_T_Врубашке, ЗАДЕРЖКА_НА_РАЗГРУЗКУ_ТРАФИКА;
  724           ПЛАВ ЛП_Предыдущее ЛОКАЛ;
  725           СОСТ Начало{
  726              ЛП_Предыдущее = (!ФП_T_Врубашке);
  727              В СЛЕДУЮЩЕЕ;
  728           }
  729           СОСТ КонтрольИзменения{
  730              ЕСЛИ (ЛП_Предыдущее != ФП_T_Врубашке) {
  731                   ЛП_Предыдущее = ФП_T_Врубашке;
  732                   В СЛЕДУЮЩЕЕ;
  733              }
  734           }
  735           СОСТ СообщОбИзменении{
  736               ЕСЛИ (SendMsgFloatParamGUI(ПК_ГУИ_ФП_T_Врубашке, ЛП_Предыдущее))
  737                   В СОСТ ТрафикПауза;
  738               ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
  739           }
  740           СОСТ ТрафикПауза{
  741              ТАЙМАУТ ЗАДЕРЖКА_НА_РАЗГРУЗКУ_ТРАФИКА В СОСТ КонтрольИзменения;
  742          
  743           }
  744          /* НЕНОРМАЛЬНЫЕ СИТУАЦИИ */
  745           СОСТ НарушениеСвязи{
  746               В СОСТ КонтрольИзменения;
  747           }
  748          }
  749          /* ПРОЦ КонтрольИзменения_ФП_T_Врубашке  */
  750          
  751          /*====================================================*/
  752          /*					ПРОЦЕСС КОНТРОЛЯ				  */
  753          /*==           изменения ИЗМН_ФП_T_Вбаке     */
  754          /*====================================================*/
  755          ПРОЦ КонтрольИзменения_ФП_T_Вбаке{
  756           ИЗ ПРОЦ Инициализация  ФП_T_Вбаке, ЗАДЕРЖКА_НА_РАЗГРУЗКУ_ТРАФИКА;
  757           ПЛАВ ЛП_Предыдущее ЛОКАЛ;
  758           СОСТ Начало{
  759              ЛП_Предыдущее = (!ФП_T_Вбаке);
  760              В СЛЕДУЮЩЕЕ;
  761           }
  762           СОСТ КонтрольИзменения{
  763              ЕСЛИ (ЛП_Предыдущее != ФП_T_Вбаке) {
  764                   ЛП_Предыдущее = ФП_T_Вбаке;
  765                   В СЛЕДУЮЩЕЕ;
  766              }
  767           }
  768           СОСТ СообщОбИзменении{
  769               ЕСЛИ (SendMsgFloatParamGUI(ПК_ГУИ_ФП_T_Вбаке, ЛП_Предыдущее))
  770                   В СОСТ ТрафикПауза;
  771               ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
  772           }
  773           СОСТ ТрафикПауза{
  774              ТАЙМАУТ ЗАДЕРЖКА_НА_РАЗГРУЗКУ_ТРАФИКА В СОСТ КонтрольИзменения;
  775          
  776           }
  777          /* НЕНОРМАЛЬНЫЕ СИТУАЦИИ */
  778           СОСТ НарушениеСвязи{
  779               В СОСТ КонтрольИзменения;
  780           }
  781          }
  782          /* ПРОЦ КонтрольИзменения_ФП_T_Вбаке  */
  783          
  784          /*====================================================*/
  785          /*					ПРОЦЕСС КОНТРОЛЯ				  */
  786          /*==           изменения ИЗМН_ФП_P_ВтрубеСидер     */
  787          /*====================================================*/	
  788           ПРОЦ КонтрольИзменения_ФП_P_ВтрубеСидер{
  789           ИЗ ПРОЦ Инициализация  ФП_P_ВтрубеСидер, ЗАДЕРЖКА_НА_РАЗГРУЗКУ_ТРАФИКА;
  790           ПЛАВ ЛП_Предыдущее ЛОКАЛ;
  791           СОСТ Начало{
  792              ЛП_Предыдущее = (!ФП_P_ВтрубеСидер);
  793              В СЛЕДУЮЩЕЕ;
  794           }
  795           СОСТ КонтрольИзменения{
  796              ЕСЛИ (ЛП_Предыдущее != ФП_P_ВтрубеСидер) {
  797                   ЛП_Предыдущее = ФП_P_ВтрубеСидер;
  798                   В СЛЕДУЮЩЕЕ;
  799              }
  800           }
  801           СОСТ СообщОбИзменении{
  802               ЕСЛИ (SendMsgFloatParamGUI(ПК_ГУИ_ФП_P_ВтрубеСидер, ЛП_Предыдущее))
  803                   В СОСТ ТрафикПауза;
  804               ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
  805           }
  806           СОСТ ТрафикПауза{
  807              ТАЙМАУТ ЗАДЕРЖКА_НА_РАЗГРУЗКУ_ТРАФИКА В СОСТ КонтрольИзменения;
  808          
  809           }
  810          /* НЕНОРМАЛЬНЫЕ СИТУАЦИИ */
  811           СОСТ НарушениеСвязи{
  812               В СОСТ КонтрольИзменения;
  813           }
  814          }
  815          /* ПРОЦ КонтрольИзменения_ФП_P_ВтрубеСидер  */   
  816          
  817          
  818          /*====================================================*/
  819          /*					ПРОЦЕСС КОНТРОЛЯ				  */
  820          /*== 		Контроль Откачки в Трубе сидеростата 	==*/
  821          /*====================================================*/
  822          ПРОЦ КонтрольОткачкиВауумнойТрубыСидеростата{
  823          ИЗ ПРОЦ Инициализация 	ФлагОткачкиТрубыСидеростата,
  824          						ФП_P_ВтрубеСидер;
  825          ПЛАВ ЛП_Предыдущее ЛОКАЛ;
  826          					
  827           СОСТ Начало{
  828          	ЛП_Предыдущее = ФП_P_ВтрубеСидер;
  829          	ТАЙМАУТ ТАЙМАУТ_ЗАДЕРЖКА_НА_ОТКАЧКУ В СЛЕДУЮЩЕЕ;
  830           }
  831           СОСТ АнализОткачки{
  832          	ЕСЛИ ((ФП_P_ВтрубеСидер - ЛП_Предыдущее) < -0.05) {    /*  величина откачки  ?????*/
  833                  ЕСЛИ (SendMsgGUICode(СКОРОСТЬ_ОТКАЧКИ_В_НОРМЕ)) {
  834          					ФлагОткачкиТрубыСидеростата = НОРМА;
  835          					В СОСТ Начало;
  836          		} 
  837              } ИНАЧЕ{
  838          	ЕСЛИ (SendMsgGUICode(СКОРОСТЬ_ОТКАЧКИ_НИЖЕ_НОРМЫ)) {
  839          					ФлагОткачкиТрубыСидеростата = ВНЕ_НОРМЫ;
  840          					В СОСТ Начало;
  841          		} 
  842          	}
  843           }
  844          }
  845          
  846          
  847          /*====================================================*/
  848          /*					ПРОЦЕСС КОНТРОЛЯ				  */
  849          /*== Контроль Готовности Вакуума в Вакуумной Трубе  ==*/
  850          /*====================================================*/
  851          
  852          ПРОЦ КонтрольГотовностиВакуума_в_Вакуумной_Трубе{
  853          ИЗ ПРОЦ Инициализация  	ФП_P_ВтрубеСидер,
  854          						ЗД_P_ВтрубеСидер,
  855          						ФлагГотовВакуумаВТ;
  856          СОСТ Начало{
  857             ЕСЛИ (ФП_P_ВтрубеСидер <= ЗД_P_ВтрубеСидер) {
  858                   ЕСЛИ (SendMsgGUICode(ДАВЛЕНИЕ_В_ВАКУУМНОЙ_ТРУБЕ_В_НОРМЕ)) {
  859          					ФлагГотовВакуумаВТ = НОРМА;
  860          					В СОСТ ДавлениеНормальное;
  861          					}
  862              
  863              } ИНАЧЕ {
  864                          ЕСЛИ (SendMsgGUICode(ДАВЛЕНИЕ_В_ВАКУУМНОЙ_ТРУБЕ_ВНЕ_НОРМЫ)) {
  865          					ФлагГотовВакуумаВТ = ВНЕ_НОРМЫ;
  866          				   В СОСТ ДавлениеВысокое;
  867          				}
  868              }
  869              ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
  870           }
  871          
  872          СОСТ ДавлениеНормальное{
  873                 ЕСЛИ (ФП_P_ВтрубеСидер > 0.025)  В СОСТ Начало;
  874           } 
  875          СОСТ ДавлениеВысокое{
  876                 ЕСЛИ (ФП_P_ВтрубеСидер < 0.01)  В СОСТ Начало;
  877           }  
  878           
  879          СОСТ Задержка{
  880                ТАЙМАУТ ОДНА_МИНУТА В СОСТ Начало;
  881           }
  882          /* НЕНОРМАЛЬНЫЕ СИТУАЦИИ */
  883           СОСТ НарушениеСвязи{
  884               В СОСТ Начало;
  885           }
  886          }
  887          
  888          /* конец ПРОЦ КонтрольГотовностиВакуума_в_Вакуумной Трубе
  889          
  890          /*====================================================*/
  891          /*					ПРОЦЕСС КОНТРОЛЯ				  */
  892          /*==           Уровень воды в баке охлаждения       ==*/
  893          /*====================================================*/
  894          ПРОЦ КонтрольУровняВодыБакаОхлаждения{
  895           ИЗ ПРОЦ Инициализация
  896                                  К_УР_ВОДЫ_MIN,
  897                                  К_УР_ВОДЫ_MAX,
  898          						ФлагГотовУрВодыБО;
  899          						
  900           СОСТ Начало{
  901               ЕСЛИ (К_УР_ВОДЫ_MIN) {
  902                   ЕСЛИ (SendMsgGUICode(УРОВЕНЬ_ВОДЫ_В_БАКЕ_ОХЛАЖДЕНИЯ_НИЗКИЙ)) {
  903          					ФлагГотовУрВодыБО = ВНЕ_НОРМЫ;
  904          					В СОСТ НизкийУровеньВоды;
  905          					}
  906              } ИНАЧЕ ЕСЛИ (К_УР_ВОДЫ_MAX) {
  907                        ЕСЛИ (SendMsgGUICode(УРОВЕНЬ_ВОДЫ_В_БАКЕ_ОХЛАЖДЕНИЯ_ВЫСОКИЙ)) {
  908          			   ФлагГотовУрВодыБО = ВНЕ_НОРМЫ;
  909          			   В СОСТ ВысокийУровеньВоды;
  910          			   }
  911              } ИНАЧЕ {
  912                          ЕСЛИ (SendMsgGUICode(УРОВЕНЬ_ВОДЫ_В_БАКЕ_ОХЛАЖДЕНИЯ_В_НОРМЕ)) {
  913          					ФлагГотовУрВодыБО = НОРМА;
  914          				   В СОСТ УровеньВодыВнорме;
  915          				}
  916                   }
  917              ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
  918           }
  919          
  920           СОСТ НизкийУровеньВоды{
  921                  ЕСЛИ (!К_УР_ВОДЫ_MIN)  В СОСТ Задержка;
  922           }
  923          
  924           СОСТ ВысокийУровеньВоды{
  925                 ЕСЛИ (!К_УР_ВОДЫ_MAX)  В СОСТ Задержка;
  926           }
  927           СОСТ УровеньВодыВнорме{
  928          	   ЕСЛИ (К_УР_ВОДЫ_MIN && К_УР_ВОДЫ_MAX)  В СОСТ Задержка;
  929           } 
  930           
  931          СОСТ Задержка{
  932                ТАЙМАУТ ОДНА_МИНУТА В СОСТ Начало;
  933           }
  934           
  935          /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
  936           СОСТ НарушениеСвязи {
  937              В СОСТ Начало;
  938           }
  939          }   /*   Конец ПРОЦ КонтрольУровняВодыБакаОхлаждения */
  940          
  941          
  942          /*====================================================*/
  943          /*					ПРОЦЕСС КОНТРОЛЯ				  */
  944          /*==       Температуры воды в баке охлаждения       ==*/
  945          /*====================================================*/
  946          ПРОЦ КонтрольТемпературыВодыБакаОхлаждения{
  947           ИЗ ПРОЦ Инициализация 	
  948          						ФП_T_Вбаке,	
  949                                  ФлагГотовТемпВодыБО;
  950          						
  951           СОСТ Начало{
  952              ЕСЛИ (ФП_T_Вбаке < 50) {
  953                   ЕСЛИ (SendMsgGUICode(ТЕМПЕРАТУРА_ВОДЫ_В_БАКЕ_ОХЛАЖДЕНИЯ_НИЗКАЯ)) {
  954          					ФлагГотовТемпВодыБО = ВНЕ_НОРМЫ;
  955          					В СОСТ НизкаяТемператураВоды;
  956          					}
  957              } ИНАЧЕ ЕСЛИ (ФП_T_Вбаке > 60) {
  958                        ЕСЛИ (SendMsgGUICode(ТЕМПЕРАТУРА_ВОДЫ_В_БАКЕ_ОХЛАЖДЕНИЯ_ВЫСОКАЯ)) {
  959          			   ФлагГотовТемпВодыБО = ВНЕ_НОРМЫ;
  960          			   В СОСТ ВысокаяТемператураВоды;
  961          			   }
  962              } ИНАЧЕ {
  963                          ЕСЛИ (SendMsgGUICode(ТЕМПЕРАТУРА_ВОДЫ_В_БАКЕ_ОХЛАЖДЕНИЯ_В_НОРМЕ)) {
  964          					ФлагГотовТемпВодыБО = НОРМА;
  965          				   В СОСТ ТемператураВнорме;
  966          				}
  967                   }
  968              ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
  969           }
  970          
  971           СОСТ НизкаяТемператураВоды{
  972                  ЕСЛИ (ФП_T_Вбаке > (50.0 + Т_ГИСТЕРЕЗИС_ВОДЫ_В_БАКЕ))  В СОСТ Начало;
  973           }
  974          
  975           СОСТ ВысокаяТемператураВоды{
  976                 ЕСЛИ (ФП_T_Вбаке < (60.0 - Т_ГИСТЕРЕЗИС_ВОДЫ_В_БАКЕ))  В СОСТ Начало;
  977           }
  978            СОСТ ТемператураВнорме{
  979                 ЕСЛИ ((ФП_T_Вбаке < (50.0 - Т_ГИСТЕРЕЗИС_ВОДЫ_В_БАКЕ)) && 
  980          	         (ФП_T_Вбаке > (60.0 + Т_ГИСТЕРЕЗИС_ВОДЫ_В_БАКЕ)))  В СОСТ Начало;
  981           } 
  982          СОСТ Задержка{
  983          
  984                ТАЙМАУТ ОДНА_МИНУТА В СОСТ Начало;
  985           }
  986           
  987          /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
  988           СОСТ НарушениеСвязи {
  989              В СОСТ Начало;
  990           }
  991          }   /*   Конец ПРОЦ КонтрольТемпературыВодыБакаОхлаждения */
  992          
  993          
  994          /*====================================================*/
  995          /*					ПРОЦЕСС КОНТРОЛЯ				  */
  996          /*==       Температуры воды в рубашке охлаждения    ==*/
  997          /*====================================================*/
  998          ПРОЦ КонтрольТемпературыРубашкиОхлаждения{
  999           ИЗ ПРОЦ Инициализация 	
 1000          						ФП_T_Врубашке,	
 1001                                  ФлагГотовTВодыРО;
 1002          						
 1003           СОСТ Начало{
 1004              ЕСЛИ (ФП_T_Врубашке < 40) {
 1005                   ЕСЛИ (SendMsgGUICode(ТЕМПЕРАТУРА_ВОДЫ_В_РУБАШКЕ_ОХЛАЖДЕНИЯ_НИЗКАЯ)) {
 1006          					ФлагГотовTВодыРО = ВНЕ_НОРМЫ;
 1007          					В СОСТ НизкаяТемператураВоды;
 1008          					}
 1009              } ИНАЧЕ ЕСЛИ (ФП_T_Врубашке > 85) {
 1010                        ЕСЛИ (SendMsgGUICode(ТЕМПЕРАТУРА_ВОДЫ_В_РУБАШКЕ_ОХЛАЖДЕНИЯ_ВЫСОКАЯ)) {
 1011          			   ФлагГотовTВодыРО = ВНЕ_НОРМЫ;
 1012          			   В СОСТ ВысокаяТемператураВоды;
 1013          			   }
 1014              } ИНАЧЕ {
 1015                          ЕСЛИ (SendMsgGUICode(ТЕМПЕРАТУРА_ВОДЫ_В_РУБАШКЕ_ОХЛАЖДЕНИЯ_В_НОРМЕ)) {
 1016          					ФлагГотовTВодыРО = НОРМА;
 1017          				   В СОСТ ТемператураВнорме;
 1018          				}
 1019                   }
 1020              ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
 1021           }
 1022          
 1023           СОСТ НизкаяТемператураВоды{
 1024                 
 1025          		ЕСЛИ (ФП_T_Врубашке > (40.0 + Т_ГИСТЕРЕЗИС_ВОДЫ_В_РУБАХЕ))  В СОСТ Начало;
 1026           }
 1027          
 1028           СОСТ ВысокаяТемператураВоды{
 1029                  ЕСЛИ (ФП_T_Врубашке < (85.0 - Т_ГИСТЕРЕЗИС_ВОДЫ_В_РУБАХЕ))  В СОСТ Начало;
 1030           }
 1031           
 1032          
 1033           СОСТ ТемператураВнорме{
 1034                  ЕСЛИ ((ФП_T_Врубашке < (40.0 - Т_ГИСТЕРЕЗИС_ВОДЫ_В_РУБАХЕ)) && 
 1035          	         (ФП_T_Врубашке > (85.0 + Т_ГИСТЕРЕЗИС_ВОДЫ_В_РУБАХЕ)))  В СОСТ Начало;
 1036           } 
 1037          СОСТ Задержка{
 1038                ТАЙМАУТ ОДНА_МИНУТА В СОСТ Начало;
 1039           }
 1040           
 1041          /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
 1042           СОСТ НарушениеСвязи {
 1043              В СОСТ Начало;
 1044           }
 1045          }   /*   Конец ПРОЦ КонтрольТемпературыВодыВрубашкеОхлаждения */
 1046          
 1047          
 1048          /*====================================================*/
 1049          /*					ПРОЦЕСС КОНТРОЛЯ				  */
 1050          /*== 		Контроль давления в баке компрессора ??? 	==*/
 1051          /*====================================================*/
 1052          ПРОЦ КонтрольДавленияВбакеКомпрессора{
 1053          ИЗ ПРОЦ Инициализация  	ФП_P_ВбакеКомпрессора,
 1054          					ФлагДавленияКомпрессора;
 1055          СОСТ Начало{
 1056             ЕСЛИ (ФП_P_ВбакеКомпрессора > ЗД_P_ВбакеКомпрессора) {
 1057                   ЕСЛИ (SendMsgGUICode(ДАВЛЕНИЕ_В_БАКЕ_КОМПРЕССОРА_В_НОРМЕ)) {
 1058          					ФлагДавленияКомпрессора = НОРМА;
 1059          					В СОСТ ДавлениеНормальное;
 1060          					}
 1061              
 1062              } ИНАЧЕ {
 1063                          ЕСЛИ (SendMsgGUICode(ДАВЛЕНИЕ_В_БАКЕ_КОМПРЕССОРА_НИЖЕ_НОРМЫ)) {
 1064          					ФлагДавленияКомпрессора = ВНЕ_НОРМЫ;
 1065          				   В СОСТ ДавлениеНизкое;
 1066          				}
 1067              }
 1068              ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
 1069           }
 1070          
 1071          СОСТ ДавлениеНормальное{
 1072                 ЕСЛИ (ФП_P_ВбакеКомпрессора < 9.5)  В СОСТ Начало;
 1073           } 
 1074          СОСТ ДавлениеНизкое{
 1075                 ЕСЛИ (ФП_P_ВбакеКомпрессора < 10.5)  В СОСТ Начало;
 1076           }  
 1077           
 1078          СОСТ Задержка{
 1079                ТАЙМАУТ ОДНА_МИНУТА В СОСТ Начало;
 1080           }
 1081          /* НЕНОРМАЛЬНЫЕ СИТУАЦИИ */
 1082           СОСТ НарушениеСвязи{
 1083               В СОСТ Начало;
 1084           }
 1085          }
 1086          
 1087          
 1088          /*=========================================*/
 1089          /*=                                       =*/
 1090          /*=     ПРОЦЕССЫ  УПРАВЛЕНИЯ ВАКУУМНЫМ    =*/
 1091          /*=          ОБОРУДОВАНИЕМ                =*/
 1092          /*=========================================*/
 1093          /*=======================================================*/
 1094          /*=====   Процесс подачи питания на вентилятор		=====*/
 1095          /*=======================================================*/
 1096          ПРОЦ ВКЛ_ПИТ_ВЕНТИЛЯТОР{
 1097           ИЗ ПРОЦ Инициализация 	К_ВЕНТИЛЯТОР,
 1098          						У_ВКЛ_ПИТ_ВЕНТИЛЯТОР,
 1099          						ОШИБКА_ФУНКЦ_ВЕНТИЛЯТОР;
 1100          					  
 1101           СОСТ Начало{
 1102            ОШИБКА_ФУНКЦ_ВЕНТИЛЯТОР = НЕТ;
 1103            У_ВКЛ_ПИТ_ВЕНТИЛЯТОР = ВКЛ;
 1104            ЕСЛИ (ПРОЦ ВЫК_ПИТ_ВЕНТИЛЯТОР В СОСТ АКТИВНОЕ) ОШИБКА ПРОЦ ВЫК_ПИТ_ВЕНТИЛЯТОР;
 1105            ИНАЧЕ В СЛЕДУЮЩЕЕ;      
 1106           }
 1107           
 1108           СОСТ КонтрольВключения{
 1109            ЕСЛИ (К_ВЕНТИЛЯТОР == ВКЛ) СТОП;
 1110            ТАЙМАУТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_ВЕНТИЛЯТОРА В СОСТ Ошибка;
 1111             }
 1112           /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
 1113           СОСТ Ошибка {
 1114                 ЕСЛИ (SendMsgGUICode(ПК_ГУИ_ОТКАЗ_ВКЛЮЧЕНИЯ_ВЕНТИЛЯТОРА))	ОШИБКА;
 1115                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
 1116           }
 1117            СОСТ НарушениеСвязи {
 1118          	   ОШИБКА;
 1119           }   
 1120          } /*конец процесса ВКЛ_ПИТ_ВЕНТИЛЯТОР  */
 1121          
 1122          /*=======================================================*/
 1123          /*=====   Процесс отключения питания вентилятора    =====*/
 1124          /*=======================================================*/
 1125          ПРОЦ ВЫК_ПИТ_ВЕНТИЛЯТОР{
 1126           ИЗ ПРОЦ Инициализация 	К_ВЕНТИЛЯТОР,
 1127          						У_ВКЛ_ПИТ_ВЕНТИЛЯТОР, 
 1128          						ОШИБКА_ФУНКЦ_ВЕНТИЛЯТОР;
 1129           СОСТ Начало{
 1130            ОШИБКА_ФУНКЦ_ВЕНТИЛЯТОР = НЕТ;
 1131            У_ВКЛ_ПИТ_ВЕНТИЛЯТОР = ВЫК;
 1132            ЕСЛИ (ПРОЦ ВКЛ_ПИТ_ВЕНТИЛЯТОР В СОСТ АКТИВНОЕ) ОШИБКА ПРОЦ ВКЛ_ПИТ_ВЕНТИЛЯТОР;
 1133            ИНАЧЕ В СЛЕДУЮЩЕЕ;      
 1134           }
 1135           
 1136           СОСТ КонтрольВыключения{
 1137            ЕСЛИ (К_ВЕНТИЛЯТОР == ВЫК) СТОП;
 1138            ТАЙМАУТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_ВЕНТИЛЯТОРА В СОСТ Ошибка;
 1139            }
 1140              /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
 1141           СОСТ Ошибка {
 1142                 ЕСЛИ (SendMsgGUICode(ПК_ГУИ_ОТКАЗ_ВЫКЛЮЧЕНИЯ_ВЕНТИЛЯТОРА))	ОШИБКА;
 1143                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
 1144           }
 1145            СОСТ НарушениеСвязи {
 1146          	   ОШИБКА;
 1147           }   
 1148          } /*конец процесса ВЫК_ПИТ_ВЕНТИЛЯТОРА  */					  
 1149          
 1150          
 1151          /*===========================================================*/
 1152          /*=====   Процесс открытия затвора вакуумного         =======*/
 1153          /*===========================================================*/
 1154          ПРОЦ ОТКР_ЗАТВОР_ВАК{
 1155           ИЗ ПРОЦ Инициализация 	К_ОТКР_ЗАТВОР_ВАК,
 1156          						К_ЗАКР_ЗАТВОР_ВАК,
 1157          						У_ОТКР_ЗАТВОР_ВАК,
 1158          						ОШИБКА_ФУНКЦ_ЗАТВОР_ВАК;
 1159           СОСТ Начало{
 1160            ОШИБКА_ФУНКЦ_ЗАТВОР_ВАК = НЕТ;
 1161            У_ОТКР_ЗАТВОР_ВАК = ОТКР;
 1162            ЕСЛИ (ПРОЦ ЗАКР_ЗАТВОР_ВАК В СОСТ АКТИВНОЕ) ОШИБКА ПРОЦ ЗАКР_ЗАТВОР_ВАК;
 1163            ЕСЛИ ((К_ОТКР_ЗАТВОР_ВАК == ВКЛ) && (К_ЗАКР_ЗАТВОР_ВАК = ВЫК)) СТОП;
 1164            ИНАЧЕ В СЛЕДУЮЩЕЕ;      
 1165           }
 1166          
 1167           СОСТ Контроль{  
 1168            ЕСЛИ ((К_ОТКР_ЗАТВОР_ВАК == ВКЛ) && (К_ЗАКР_ЗАТВОР_ВАК = ВЫК)) СТОП;
 1169            ТАЙМАУТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_ЗАТ_ВАК В СОСТ Ошибка;
 1170           } 
 1171           /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
 1172           СОСТ Ошибка {
 1173                 ЕСЛИ (SendMsgGUICode(ПК_ГУИ_ОТКАЗ_ОТКРЫТИЯ_ЗАТВОРА_ВАКУУМНОГО))	ОШИБКА;
 1174                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
 1175           }
 1176            СОСТ НарушениеСвязи {
 1177          	   ОШИБКА;
 1178           }
 1179          }   /*конец процесса ОТКР_ЗАТВОР_ВАК */
 1180          /*===========================================================*/
 1181          /*=====   Процесс закрытия затвора вакуумного         =======*/
 1182          /*===========================================================*/
 1183          ПРОЦ ЗАКР_ЗАТВОР_ВАК{
 1184           ИЗ ПРОЦ Инициализация 	К_ОТКР_ЗАТВОР_ВАК,
 1185          						К_ЗАКР_ЗАТВОР_ВАК,
 1186          						У_ОТКР_ЗАТВОР_ВАК,
 1187          						ОШИБКА_ФУНКЦ_ЗАТВОР_ВАК;
 1188          
 1189           СОСТ Начало{
 1190            ОШИБКА_ФУНКЦ_ЗАТВОР_ВАК = НЕТ;
 1191            У_ОТКР_ЗАТВОР_ВАК = ЗАКР;
 1192            ЕСЛИ (ПРОЦ ОТКР_ЗАТВОР_ВАК В СОСТ АКТИВНОЕ) ОШИБКА ПРОЦ ОТКР_ЗАТВОР_ВАК;
 1193            ЕСЛИ ((К_ОТКР_ЗАТВОР_ВАК == ВЫК) && (К_ЗАКР_ЗАТВОР_ВАК = ВКЛ)) СТОП;
 1194            ИНАЧЕ В СЛЕДУЮЩЕЕ;      
 1195           }
 1196           СОСТ Контроль{  
 1197          	ЕСЛИ ((К_ОТКР_ЗАТВОР_ВАК == ВЫК) && (К_ЗАКР_ЗАТВОР_ВАК = ВКЛ)) СТОП;
 1198          	ТАЙМАУТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_ЗАТ_ВАК В СОСТ Ошибка;
 1199            }
 1200           /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
 1201           СОСТ Ошибка {
 1202              ЕСЛИ (SendMsgGUICode(ПК_ГУИ_ОТКАЗ_ЗАКРЫТИЯ_ЗАТВОРА_ВАКУУМНОГО))	ОШИБКА;
 1203              ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
 1204           }
 1205            СОСТ НарушениеСвязи {
 1206          	   ОШИБКА;
 1207           }
 1208          } /*конец процесса ЗАКР_ЗАТВОР_ВАК */
 1209          
 1210          
 1211          
 1212          /*===========================================================*/
 1213          /*=====   Процесс открытия сапуна                    =======*/
 1214          /*===========================================================*/
 1215          ПРОЦ ОТКР_САПУН{
 1216           ИЗ ПРОЦ Инициализация 	К_САПУН, 
 1217          						У_ОТКР_САПУН,
 1218          						ОШИБКА_ФУНКЦ_САПУН; 	
 1219           СОСТ Начало{
 1220            ОШИБКА_ФУНКЦ_САПУН = НЕТ;
 1221            У_ОТКР_САПУН = ОТКР;
 1222            ЕСЛИ (ПРОЦ ЗАКР_САПУН В СОСТ АКТИВНОЕ) ОШИБКА ПРОЦ ЗАКР_САПУН;
 1223          /*  ЕСЛИ ((К_САПУН == ОТКР) && (ОШИБКА_ФУНКЦ_САПУН == НЕТ)) СТОП;  */
 1224            ЕСЛИ (К_САПУН == ОТКР)  СТОП;
 1225            ИНАЧЕ В СЛЕДУЮЩЕЕ;      
 1226           }
 1227          
 1228           СОСТ КонтрольКонцевика{  
 1229          /*  ЕСЛИ ((К_САПУН == ОТКР) && (ОШИБКА_ФУНКЦ_САПУН == НЕТ)) СТОП; */
 1230              ЕСЛИ (К_САПУН == ОТКР) СТОП;
 1231            ТАЙМАУТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_САПУНА В СОСТ Ошибка;  /* здесь надо выдавать код ошибки в ГУИ */
 1232           } 
 1233          /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
 1234           СОСТ Ошибка {
 1235                 ЕСЛИ (SendMsgGUICode(ПК_ГУИ_ОТКАЗ_ОТКРЫТИЯ_САПУНА))	ОШИБКА;
 1236                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
 1237           }
 1238            СОСТ НарушениеСвязи {
 1239          	   ОШИБКА;
 1240           }
 1241          }  /*конец процесса ОТКР_САПУН  */
 1242          
 1243          
 1244          
 1245          /*===========================================================*/
 1246          /*==!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! ==========================*/
 1247          /*=====   Процесс закрытия сапуна                    =======*/
 1248          /*===========================================================*/
 1249          ПРОЦ ЗАКР_САПУН{
 1250           ИЗ ПРОЦ Инициализация 	К_САПУН,
 1251                                	У_ОТКР_САПУН,
 1252          						ОШИБКА_ФУНКЦ_САПУН;
 1253          
 1254           СОСТ Начало{
 1255            ОШИБКА_ФУНКЦ_САПУН = НЕТ;
 1256            У_ОТКР_САПУН = ЗАКР;
 1257            ЕСЛИ (ПРОЦ ОТКР_САПУН В СОСТ АКТИВНОЕ) ОШИБКА ПРОЦ ОТКР_САПУН;
 1258            ЕСЛИ (К_САПУН == ЗАКР) СТОП;
 1259            ИНАЧЕ В СЛЕДУЮЩЕЕ;      
 1260           }
 1261          
 1262           СОСТ КонтрольКонцевика{  
 1263            ЕСЛИ (К_САПУН == ЗАКР) СТОП;
 1264            ТАЙМАУТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_САПУНА {
 1265            /*      ОШИБКА_ФУНКЦИОНИРОВАНИЯ = ВКЛ;  ??????? */
 1266          	В СОСТ Ошибка;
 1267            }
 1268           }
 1269           /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
 1270           СОСТ Ошибка {
 1271                 ЕСЛИ (SendMsgGUICode(ПК_ГУИ_ОТКАЗ_ЗАКРЫТИЯ_САПУНА))	ОШИБКА;
 1272                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
 1273           }
 1274            СОСТ НарушениеСвязи {
 1275          	   ОШИБКА;
 1276           }
 1277          } /*конец процесса ЗАКР_САПУН  */
 1278          
 1279          
 1280          
 1281          
 1282          /*================================================================*/
 1283          /*              Процесс включить питание вакуумного насоса        */
 1284          /*================================================================*/
 1285          ПРОЦ ВКЛ_ПИТ_ВАК_НАСОСА{
 1286           ИЗ ПРОЦ Инициализация 	К_ПИТ_ВАК_НАСОСА,
 1287          						У_ВКЛ_ПИТ_ВАК_НАСОСА,
 1288          						ОШИБКА_ФУНКЦ_ПИТ_ВАК_НАСОСА;
 1289          СОСТ Начало{
 1290            ОШИБКА_ФУНКЦ_ПИТ_ВАК_НАСОСА = НЕТ; 
 1291            У_ВКЛ_ПИТ_ВАК_НАСОСА = ВКЛ;
 1292            ЕСЛИ (ПРОЦ ВЫК_ПИТ_ВАК_НАСОСА В СОСТ АКТИВНОЕ) ОШИБКА ПРОЦ ВЫК_ПИТ_ВАК_НАСОСА;
 1293            ЕСЛИ (К_ПИТ_ВАК_НАСОСА == ВКЛ) СТОП;
 1294            ИНАЧЕ В СЛЕДУЮЩЕЕ;      
 1295           }
 1296          
 1297           СОСТ Контроль{  
 1298            ЕСЛИ (К_ПИТ_ВАК_НАСОСА == ВКЛ) СТОП;
 1299            ТАЙМАУТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_ВАК_НАСОСА 	В СОСТ Ошибка;
 1300          
 1301           } 
 1302                /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
 1303           СОСТ Ошибка {
 1304                 ЕСЛИ (SendMsgGUICode(ПК_ГУИ_ОТКАЗ_ВКЛЮЧЕНИЯ_ПИТАНИЯ_ВАКУУМНОГО_НАСОСА))	ОШИБКА;
 1305                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
 1306           }
 1307            СОСТ НарушениеСвязи {
 1308          	   ОШИБКА;
 1309           } 
 1310          } /*конец процесса ВКЛ_ПИТ_ВАК_НАСОСА  */
 1311          /*================================================================*/
 1312          /*              Процесс выключить питание вакуумного насоса                 */
 1313          /*================================================================*/
 1314          ПРОЦ ВЫК_ПИТ_ВАК_НАСОСА{
 1315           ИЗ ПРОЦ Инициализация 	К_ПИТ_ВАК_НАСОСА,
 1316          						У_ВКЛ_ПИТ_ВАК_НАСОСА,
 1317          						ОШИБКА_ФУНКЦ_ПИТ_ВАК_НАСОСА;
 1318           СОСТ Начало{
 1319            ОШИБКА_ФУНКЦ_ПИТ_ВАК_НАСОСА = НЕТ;
 1320            У_ВКЛ_ПИТ_ВАК_НАСОСА = ВЫК;
 1321            ЕСЛИ (ПРОЦ ВКЛ_ПИТ_ВАК_НАСОСА В СОСТ АКТИВНОЕ) ОШИБКА ПРОЦ ВКЛ_ПИТ_ВАК_НАСОСА;
 1322            ЕСЛИ (К_ПИТ_ВАК_НАСОСА == ВЫК) СТОП;
 1323            ИНАЧЕ В СЛЕДУЮЩЕЕ;      
 1324           }
 1325          
 1326           СОСТ Контроль{  
 1327            ЕСЛИ (К_ПИТ_ВАК_НАСОСА == ВЫК) СТОП;
 1328            ТАЙМАУТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_ВАК_НАСОСА 	В СОСТ Ошибка;
 1329           
 1330           } 
 1331                 /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
 1332           СОСТ Ошибка {
 1333                 ЕСЛИ (SendMsgGUICode(ПК_ГУИ_ОТКАЗ_ВЫКЛЮЧЕНИЯ_ПИТАНИЯ_ВАКУУМНОГО_НАСОСА))	ОШИБКА;
 1334                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
 1335           }
 1336            СОСТ НарушениеСвязи {
 1337          	   ОШИБКА;
 1338           } 
 1339          }  /*конец процесса ВЫК_ПИТ_ВАК_НАСОСА */
 1340          
 1341          /*================================================================*/
 1342          /*              Процесс Подать питание на регулятор температуры   */
 1343          /*================================================================*/
 1344          ПРОЦ ВКЛ_ПИТ_РЕГ_Т{
 1345           ИЗ ПРОЦ Инициализация 	У_ВКЛ_ПИТ_РЕГ_Т,
 1346          						К_ПИТ_РЕГ_Т,
 1347          						ОШИБКА_ФУНКЦ_ПИТ_РЕГ_Т;
 1348           
 1349           
 1350          СОСТ Начало{
 1351            ОШИБКА_ФУНКЦ_ПИТ_РЕГ_Т = НЕТ;
 1352            У_ВКЛ_ПИТ_РЕГ_Т = ВКЛ;
 1353            ЕСЛИ (ПРОЦ ВЫК_ПИТ_РЕГ_Т В СОСТ АКТИВНОЕ) ОШИБКА ПРОЦ ВЫК_ПИТ_РЕГ_Т;
 1354            ЕСЛИ (К_ПИТ_РЕГ_Т == ВКЛ) СТОП;
 1355            ИНАЧЕ В СЛЕДУЮЩЕЕ;      
 1356           }
 1357          
 1358           СОСТ Контроль{  
 1359            ЕСЛИ (К_ПИТ_РЕГ_Т == ВКЛ) СТОП;
 1360            ТАЙМАУТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_РЕГ_Т 	В СОСТ Ошибка;
 1361           } 
 1362                 /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
 1363           СОСТ Ошибка {
 1364                 ЕСЛИ (SendMsgGUICode(ПК_ГУИ_ОТКАЗ_ВКЛЮЧЕНИЯ_РЕГУЛЯТОРА_ТЕМПЕРАТУРЫ))	ОШИБКА;
 1365                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
 1366           }
 1367            СОСТ НарушениеСвязи {
 1368          	   ОШИБКА;
 1369           } 
 1370          
 1371          } /*конец процесса ВКЛ_ПИТ_РЕГ_Т */
 1372          
 1373          
 1374          
 1375          /*================================================================*/
 1376          /*        Процесс Снять питание с регулятора температуры          */
 1377          /*================================================================*/
 1378          ПРОЦ ВЫК_ПИТ_РЕГ_Т{
 1379           ИЗ ПРОЦ Инициализация 	У_ВКЛ_ПИТ_РЕГ_Т,
 1380          						К_ПИТ_РЕГ_Т,
 1381          						ОШИБКА_ФУНКЦ_ПИТ_РЕГ_Т;
 1382           
 1383           
 1384          СОСТ Начало{
 1385            ОШИБКА_ФУНКЦ_ПИТ_РЕГ_Т = НЕТ;
 1386            У_ВКЛ_ПИТ_РЕГ_Т = ВЫК;
 1387            ЕСЛИ (ПРОЦ ВКЛ_ПИТ_РЕГ_Т В СОСТ АКТИВНОЕ) ОШИБКА ПРОЦ ВКЛ_ПИТ_РЕГ_Т;
 1388            ЕСЛИ (К_ПИТ_РЕГ_Т == ВКЛ) СТОП;
 1389            ИНАЧЕ В СЛЕДУЮЩЕЕ;      
 1390           }
 1391          
 1392           СОСТ Контроль{  
 1393            ЕСЛИ (К_ПИТ_РЕГ_Т == ВКЛ) СТОП;
 1394            ТАЙМАУТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_РЕГ_Т В СОСТ Ошибка;
 1395          
 1396           } 
 1397                  /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
 1398           СОСТ Ошибка {
 1399                 ЕСЛИ (SendMsgGUICode(ПК_ГУИ_ОТКАЗ_ВЫКЛЮЧЕНИЯ_РЕГУЛЯТОРА_ТЕМПЕРАТУРЫ))	ОШИБКА;
 1400                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
 1401           }
 1402            СОСТ НарушениеСвязи {
 1403          	   ОШИБКА;
 1404           } 
 1405          
 1406          }  /*конец процесса ВЫК_ПИТ_РЕГ_Т */
 1407          /*================================================================*/
 1408          /*        Процесс Подать питание на регулятор уровня воды         */
 1409          /*================================================================*/
 1410          ПРОЦ ВКЛ_ПИТ_РЕГ_УР{
 1411           ИЗ ПРОЦ Инициализация 	У_ВКЛ_ПИТ_РЕГ_УР,
 1412          						К_ПИТ_РЕГ_УР,
 1413          						ОШИБКА_ФУНКЦ_ПИТ_РЕГ_УР;
 1414          
 1415          СОСТ Начало{
 1416            ОШИБКА_ФУНКЦ_ПИТ_РЕГ_УР = НЕТ;
 1417            У_ВКЛ_ПИТ_РЕГ_УР = ВКЛ;
 1418            ЕСЛИ (ПРОЦ ВЫК_ПИТ_РЕГ_УР В СОСТ АКТИВНОЕ) ОШИБКА ПРОЦ ВЫК_ПИТ_РЕГ_УР;
 1419            ЕСЛИ (К_ПИТ_РЕГ_УР == ВКЛ) СТОП;
 1420            ИНАЧЕ В СЛЕДУЮЩЕЕ;      
 1421           }
 1422          
 1423           СОСТ Контроль{  
 1424            ЕСЛИ (К_ПИТ_РЕГ_УР == ВКЛ) СТОП;
 1425            ТАЙМАУТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_РЕГ_УР В СОСТ Ошибка; 
 1426            } 
 1427                   /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
 1428           СОСТ Ошибка {
 1429                 ЕСЛИ (SendMsgGUICode(ПК_ГУИ_ОТКАЗ_ВКЛЮЧЕНИЯ_РЕГУЛЯТОРА_УРОВНЯ))	ОШИБКА;
 1430                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
 1431           }
 1432            СОСТ НарушениеСвязи {
 1433          	   ОШИБКА;
 1434           } 
 1435          }  /*конец процесса ВКЛ_ПИТ_РЕГ_УР */
 1436          
 1437          /*================================================================*/
 1438          /*        Процесс Снять питание с регулятора уровня воды          */
 1439          /*================================================================*/
 1440          ПРОЦ ВЫК_ПИТ_РЕГ_УР{
 1441           ИЗ ПРОЦ Инициализация 	У_ВКЛ_ПИТ_РЕГ_УР,
 1442          						К_ПИТ_РЕГ_УР,
 1443          						ОШИБКА_ФУНКЦ_ПИТ_РЕГ_УР;
 1444          
 1445          СОСТ Начало{
 1446            ОШИБКА_ФУНКЦ_ПИТ_РЕГ_УР = НЕТ;
 1447            У_ВКЛ_ПИТ_РЕГ_УР = ВЫК;
 1448            ЕСЛИ (ПРОЦ ВКЛ_ПИТ_РЕГ_УР В СОСТ АКТИВНОЕ) ОШИБКА ПРОЦ ВКЛ_ПИТ_РЕГ_УР;
 1449            ЕСЛИ (К_ПИТ_РЕГ_УР == ВЫК) СТОП;
 1450            ИНАЧЕ В СЛЕДУЮЩЕЕ;      
 1451           }
 1452          
 1453           СОСТ Контроль{  
 1454            ЕСЛИ (К_ПИТ_РЕГ_УР == ВЫК) СТОП;
 1455            ТАЙМАУТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_РЕГ_УР 	В СОСТ Ошибка; 
 1456           } 
 1457                    /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
 1458            СОСТ Ошибка {
 1459                 ЕСЛИ (SendMsgGUICode(ПК_ГУИ_ОТКАЗ_ВЫКЛЮЧЕНИЯ_РЕГУЛЯТОРА_УРОВНЯ))	ОШИБКА;
 1460                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
 1461           }
 1462            СОСТ НарушениеСвязи {
 1463          	   ОШИБКА;
 1464           } 
 1465          }  /*конец процесса ВЫК_ПИТ_РЕГ_УР */
 1466          
 1467          
 1468          /*================================================================*/
 1469          /*              Процесс Подать питание на насос охлаждения        */
 1470          /*================================================================*/
 1471          ПРОЦ ВКЛ_ПИТ_НАС_ОХЛ{
 1472           ИЗ ПРОЦ Инициализация 	У_ВКЛ_ПИТ_НАС_ОХЛ,
 1473          						К_НАСОС_ОХЛ,
 1474          						ФлагГотовУрВодыБО,
 1475          						ФлагГотовТемпВодыБО,
 1476          						ОШИБКА_ФУНКЦ_НАСОС_ОХЛ;
 1477          						
 1478           СОСТ Начало{
 1479            ЕСЛИ (ПРОЦ ВЫК_ПИТ_НАС_ОХЛ В СОСТ АКТИВНОЕ) ОШИБКА ПРОЦ ВЫК_ПИТ_НАС_ОХЛ;
 1480            ЕСЛИ (ФлагГотовУрВодыБО == НОРМА)  В СЛЕДУЮЩЕЕ;
 1481            ИНАЧЕ ОШИБКА;      
 1482           }
 1483          
 1484           СОСТ ВключениеПитания{
 1485            ОШИБКА_ФУНКЦ_НАСОС_ОХЛ = НЕТ;
 1486            У_ВКЛ_ПИТ_НАС_ОХЛ = ВКЛ;
 1487            ЕСЛИ (К_НАСОС_ОХЛ == ВКЛ) СТОП;
 1488            ИНАЧЕ В СЛЕДУЮЩЕЕ;      
 1489           }
 1490          
 1491           СОСТ Контроль{  
 1492            ЕСЛИ (К_НАСОС_ОХЛ == ВКЛ) СТОП;
 1493            ТАЙМАУТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_НАСОС_ОХЛ В СОСТ Ошибка; 
 1494           } 
 1495                     /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
 1496            СОСТ Ошибка {
 1497                 ЕСЛИ (SendMsgGUICode(ПК_ГУИ_ОТКАЗ_ВКЛЮЧЕНИЯ_НАСОСА_ОХЛАЖДЕНИЯ))	ОШИБКА;
 1498                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
 1499           }
 1500            СОСТ НарушениеСвязи {
 1501          	   ОШИБКА;
 1502           } 
 1503          } /*конец процесса ВКЛ_ПИТ_НАС_ОХЛАЖДЕНИЯ */
 1504          
 1505          
 1506          
 1507          /*================================================================*/
 1508          /*             Процесс Снять питание с насоса охлаждения          */
 1509          /*================================================================*/
 1510          ПРОЦ ВЫК_ПИТ_НАС_ОХЛ{
 1511           ИЗ ПРОЦ Инициализация 	У_ВКЛ_ПИТ_НАС_ОХЛ,
 1512          						К_НАСОС_ОХЛ,
 1513          						ОШИБКА_ФУНКЦ_НАСОС_ОХЛ;
 1514          
 1515           СОСТ Начало{
 1516            ОШИБКА_ФУНКЦ_НАСОС_ОХЛ = НЕТ;
 1517            У_ВКЛ_ПИТ_НАС_ОХЛ = ВЫК;
 1518            ЕСЛИ (ПРОЦ ВКЛ_ПИТ_НАС_ОХЛ В СОСТ АКТИВНОЕ) ОШИБКА ПРОЦ ВКЛ_ПИТ_НАС_ОХЛ;
 1519            ЕСЛИ (К_НАСОС_ОХЛ == ВЫК) СТОП;
 1520            ИНАЧЕ В СЛЕДУЮЩЕЕ;      
 1521           }
 1522          
 1523           СОСТ Контроль{  
 1524            ЕСЛИ (К_НАСОС_ОХЛ == ВЫК) СТОП;
 1525            ТАЙМАУТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_НАСОС_ОХЛ В СОСТ Ошибка; 
 1526           } 
 1527                      /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
 1528            СОСТ Ошибка {
 1529                 ЕСЛИ (SendMsgGUICode(ПК_ГУИ_ОТКАЗ_ВЫКЛЮЧЕНИЯ_НАСОСА_ОХЛАЖДЕНИЯ))	ОШИБКА;
 1530                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
 1531           }
 1532            СОСТ НарушениеСвязи {
 1533          	   ОШИБКА;
 1534           } 
 1535          
 1536          } /*конец процесса ВЫК_ПИТ_НАС_ОХЛАЖДЕНИЯ */
 1537          /*=========================================================++++++++++++======*/
 1538          /*==   Процесс  ВКЛЮЧИТЬ Устройство плавного пуска (запуск вакуумирования)   */
 1539          /*== это означает запуск вакуумного насоса на вакуумирование    			 */
 1540          /*==========================================================++++++++++++=====*/
 1541          
 1542          ПРОЦ ВКЛ_УСТР_ПЛАВ_ПУСКА{
 1543           ИЗ ПРОЦ Инициализация 	К_УСТР_ПЛАВ_ПУСКА,
 1544          						У_ВКЛ_УСТР_ПЛАВ_ПУСКА,
 1545          						ОШИБКА_ФУНКЦ_УСТР_ПЛАВ_ПУСКА;
 1546          						
 1547          						
 1548          						
 1549          
 1550           СОСТ Начало{
 1551            ОШИБКА_ФУНКЦ_УСТР_ПЛАВ_ПУСКА = НЕТ;
 1552            У_ВКЛ_УСТР_ПЛАВ_ПУСКА = ВКЛ;
 1553            ЕСЛИ (ПРОЦ ВЫК_УСТР_ПЛАВ_ПУСКА В СОСТ АКТИВНОЕ) ОШИБКА ПРОЦ ВЫК_УСТР_ПЛАВ_ПУСКА;
 1554            ЕСЛИ (К_УСТР_ПЛАВ_ПУСКА == ВКЛ) СТОП;
 1555            ИНАЧЕ В СЛЕДУЮЩЕЕ;      
 1556           }
 1557          
 1558           СОСТ Контроль{  
 1559            ЕСЛИ (К_УСТР_ПЛАВ_ПУСКА == ВКЛ) СТОП;
 1560            ТАЙМАУТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_УСТР_ПЛАВ_ПУСКА  	В СОСТ Ошибка;
 1561             
 1562           } 
 1563               /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
 1564           СОСТ Ошибка {
 1565                 ЕСЛИ (SendMsgGUICode(ПК_ГУИ_ОТКАЗ_ВКЛЮЧЕНИЯ_УСТР_ПЛАВ_ПУСКА))	ОШИБКА;
 1566                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
 1567           }
 1568            СОСТ НарушениеСвязи {
 1569          	   ОШИБКА;
 1570           } 
 1571          }  /*конец процесса ВКЛ_УСТР_ПЛАВ_ПУСКА  */
 1572          
 1573          /*===============================================================*/
 1574          /*==   Процесс  ВЫКЛЮЧИТЬ Устройство плавного пуска                  */
 1575          /*===============================================================*/
 1576          ПРОЦ ВЫК_УСТР_ПЛАВ_ПУСКА{
 1577           ИЗ ПРОЦ Инициализация 	К_УСТР_ПЛАВ_ПУСКА,
 1578          						У_ВКЛ_УСТР_ПЛАВ_ПУСКА,
 1579          						ОШИБКА_ФУНКЦ_УСТР_ПЛАВ_ПУСКА;
 1580          						
 1581           СОСТ Начало{					
 1582            ОШИБКА_ФУНКЦ_УСТР_ПЛАВ_ПУСКА = НЕТ;                 
 1583            У_ВКЛ_УСТР_ПЛАВ_ПУСКА = ВЫК;
 1584            ЕСЛИ (ПРОЦ ВКЛ_УСТР_ПЛАВ_ПУСКА В СОСТ АКТИВНОЕ) ОШИБКА ПРОЦ ВКЛ_УСТР_ПЛАВ_ПУСКА;
 1585            ЕСЛИ (К_УСТР_ПЛАВ_ПУСКА == ВЫК) СТОП;
 1586            ИНАЧЕ В СЛЕДУЮЩЕЕ;      
 1587           }
 1588          
 1589           СОСТ КонтрольВключения{  
 1590            ЕСЛИ (К_УСТР_ПЛАВ_ПУСКА == ВЫК) СТОП;
 1591            ТАЙМАУТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_УСТР_ПЛАВ_ПУСКА 	В СОСТ Ошибка;
 1592            
 1593           } 
 1594                 /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
 1595            СОСТ Ошибка {
 1596                 ЕСЛИ (SendMsgGUICode(ПК_ГУИ_ОТКАЗ_ВЫКЛЮЧЕНИЯ_УСТР_ПЛАВ_ПУСКА))	ОШИБКА;
 1597                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
 1598           }
 1599            СОСТ НарушениеСвязи {
 1600          	   ОШИБКА;
 1601           } 
 1602          } /*конец процесса ВЫК_УСТР_ПЛАВ_ПУСКА  */
 1603          
 1604          /*=======================================================================*/
 1605          /*              Процесс Включить насос вакуумный                         */
 1606          /*   Этапы включения вакуумного насоса:                                  */ 
 1607          /*   1. Проверяем допустимое давление в компрессоре. Норма - идем дальше */  
 1608          /*   2. Проверяем температуру и уровень воды в баке охлаждения           */ 
 1609          /*      Норма - идем дальше   											 */ 
 1610          /*   3. Включаем питание вентилятора                                     */ 
 1611          /*   4. Включаем питание насоса охлаждения                               */  
 1612          /*   5. Закрываем затвор вакуумный                                       */ 
 1613          /*   6. Открываем сапун                                                  */ 
 1614          /*   7. Контролируем температуру воды в рубашке, если норма              */
 1615          /*                                    - идем дальше                      */ 
 1616          /*   8. Включаем питание вакуумного насоса                               */ 
 1617          /*   9. Включаем устройство плавного пуска                               */ 
 1618          /*   10. Выдерживаем одну минуту и закрываем сапун                        */ 
 1619          /*   11. Если ФП_P_ВтрубеСидер >= ФП_P_Впатрубке - открываем затвор       */
 1620          /*       вакуумный, иначе - ошибка                                       */  
 1621          /*       Пошло вакуумирование - насос включен                            */  
 1622          /*=======================================================================*/
 1623          ПРОЦ ВКЛ_НАСОС_ВАКУУМНЫЙ{
 1624           ИЗ ПРОЦ Инициализация 	У_ВКЛ_ПИТ_НАС_ОХЛ,
 1625          						ФП_P_Впатрубке,		
 1626          						ФП_P_ВтрубеСидер,
 1627          						ФлагГотовTВодыРО,
 1628          						ФлагГотовТемпВодыБО,
 1629          						
 1630          						ФП_P_ВбакеКомпрессора,
 1631          						ФП_T_Вбаке,
 1632          						ФлагГотовУрВодыБО,
 1633          						ФлагДавленияКомпрессора;
 1634           ПЛАВ ЛП_Предыдущее ЛОКАЛ;
 1635           
 1636           СОСТ Начало{
 1637          	ЕСЛИ (ПРОЦ ВЫК_НАСОС_ВАКУУМНЫЙ В СОСТ АКТИВНОЕ) ОШИБКА ПРОЦ ВЫК_НАСОС_ВАКУУМНЫЙ;
 1638          	/* нельзя включать насос вакуумный, если давление в компрессоре < 5-10 атмосфер*/
 1639          		ЕСЛИ (ФлагДавленияКомпрессора != НОРМА) ОШИБКА;
 1640          		ИНАЧЕ В СЛЕДУЮЩЕЕ;
 1641          	}
 1642          	СОСТ КонтрольГотовностиУровняИтемпературы{
 1643          		ЕСЛИ ((ФП_T_Вбаке > Т_ПредельнаяВбакеОхлаждения)|| 
 1644          			(ФлагГотовУрВодыБО == ВНЕ_НОРМЫ)||
 1645          			(ФлагГотовТемпВодыБО == ВНЕ_НОРМЫ )) ОШИБКА;
 1646          			ИНАЧЕ 	{
 1647          				СТАРТ ПРОЦ ВКЛ_ПИТ_ВЕНТИЛЯТОР;
 1648          				В СЛЕДУЮЩЕЕ;
 1649          			}
 1650          	}
 1651          	
 1652          		
 1653          	СОСТ КонтрольВключенияВентилятора{
 1654          		ЕСЛИ ( ПРОЦ ВКЛ_ПИТ_ВЕНТИЛЯТОР В СОСТ ПАССИВНОЕ){ 
 1655          				ЕСЛИ (ПРОЦ  ВКЛ_ПИТ_ВЕНТИЛЯТОР В СОСТ ОШИБКА ) ОШИБКА;
 1656          				ИНАЧЕ {
 1657          					СТАРТ ПРОЦ ВКЛ_ПИТ_НАС_ОХЛ;
 1658          					В СЛЕДУЮЩЕЕ;
 1659          				}
 1660          		}
 1661          	}  
 1662          	СОСТ КонтрольВключенияПитанияНасосаОхлаждения{
 1663          		ЕСЛИ (ПРОЦ ВКЛ_ПИТ_НАС_ОХЛ В СОСТ ПАССИВНОЕ){ 
 1664          				ЕСЛИ (ПРОЦ  ВКЛ_ПИТ_НАС_ОХЛ В СОСТ ОШИБКА ) ОШИБКА;
 1665          				ИНАЧЕ {
 1666          					СТАРТ ПРОЦ ЗАКР_ЗАТВОР_ВАК ;
 1667          					В СЛЕДУЮЩЕЕ;
 1668          				}
 1669          		}
 1670          	}  
 1671          	СОСТ КонтрольЗакрытияЗатвораВакуумного{
 1672          		ЕСЛИ (ПРОЦ ЗАКР_ЗАТВОР_ВАК В СОСТ ПАССИВНОЕ){ 
 1673          			ЕСЛИ (ПРОЦ ЗАКР_ЗАТВОР_ВАК В СОСТ ОШИБКА ) ОШИБКА;
 1674          			ИНАЧЕ {
 1675          				СТАРТ ПРОЦ ОТКР_САПУН;
 1676          				В СЛЕДУЮЩЕЕ;
 1677          			}
 1678          		} 
 1679          	} 
 1680          	СОСТ КонтрольОткрытияСапуна{
 1681          		ЕСЛИ ( ПРОЦ ОТКР_САПУН В СОСТ ПАССИВНОЕ){ 
 1682          			ЕСЛИ (ПРОЦ ОТКР_САПУН В СОСТ ОШИБКА ) ОШИБКА;
 1683          			ИНАЧЕ В СЛЕДУЮЩЕЕ;
 1684          		} 
 1685          	} 	
 1686          	СОСТ КонтрольТемпературыРубашки{
 1687          		ЕСЛИ (ФлагГотовTВодыРО == НОРМА) В СЛЕДУЮЩЕЕ;
 1688          /*		ТАЙМАУТ ПЯТЬ_МИНУТ ОШИБКА;  */
 1689          		ИНАЧЕ ОШИБКА;
 1690          	}
 1691          	СОСТ ПодачаПитанияНаВакуумныйНасос{
 1692          		СТАРТ ПРОЦ ВКЛ_ПИТ_ВАК_НАСОСА;
 1693          		В СЛЕДУЮЩЕЕ;
 1694          	}	
 1695          	СОСТ КонтрольПитанияВакуумногоНасоса{
 1696          		ЕСЛИ ( ПРОЦ ВКЛ_ПИТ_ВАК_НАСОСА В СОСТ ПАССИВНОЕ){ 
 1697          			ЕСЛИ (ПРОЦ  ВКЛ_ПИТ_ВАК_НАСОСА В СОСТ ОШИБКА) ОШИБКА;
 1698          			ИНАЧЕ  В СЛЕДУЮЩЕЕ;
 1699          		} 
 1700          	}  
 1701          	СОСТ ВключениеУстройстваПлавногоПуска{
 1702          		СТАРТ ПРОЦ ВКЛ_УСТР_ПЛАВ_ПУСКА;
 1703          		В СЛЕДУЮЩЕЕ;
 1704          	}
 1705          	СОСТ КонтрольВлюченияПлавногоПуска{
 1706          		ЕСЛИ (ПРОЦ ВКЛ_УСТР_ПЛАВ_ПУСКА В СОСТ ПАССИВНОЕ){ 
 1707          			ЕСЛИ (ПРОЦ  ВКЛ_УСТР_ПЛАВ_ПУСКА В СОСТ ОШИБКА) ОШИБКА;
 1708          			ИНАЧЕ  В СЛЕДУЮЩЕЕ;
 1709          		} 
 1710          	}  	
 1711          	СОСТ ТаймаутПередЗакрытиемСапуна{  
 1712          		ТАЙМАУТ ОДНА_МИНУТА В СЛЕДУЮЩЕЕ; 
 1713          	}  
 1714          	
 1715          	СОСТ ЗакрытиеСапуна{  
 1716          		СТАРТ ПРОЦ ЗАКР_САПУН;
 1717          		В СЛЕДУЮЩЕЕ; 
 1718          	} 
 1719          	СОСТ КонтрольЗакрытияСапуна{
 1720          		ЕСЛИ ( ПРОЦ ЗАКР_САПУН В СОСТ ПАССИВНОЕ){ 
 1721          			ЕСЛИ (ПРОЦ ЗАКР_САПУН В СОСТ ОШИБКА ) ОШИБКА;
 1722          			ИНАЧЕ В СЛЕДУЮЩЕЕ;
 1723          		} 
 1724          	} 
 1725          	
 1726          	СОСТ ЗапоминаемДавлениеВпатрубке{
 1727          			ЛП_Предыдущее = ФП_P_Впатрубке;
 1728          			В СЛЕДУЮЩЕЕ;
 1729          	}
 1730          	СОСТ КонтрольДавления{  
 1731          		ЕСЛИ (ФП_P_ВтрубеСидер >= ФП_P_Впатрубке) {
 1732          			СТАРТ ПРОЦ ОТКР_ЗАТВОР_ВАК; 
 1733          			В СОСТ КонтрольОткрытияЗВ;
 1734          			}
 1735          		ИНАЧЕ В СЛЕДУЮЩЕЕ;
 1736          	} 	
 1737          	СОСТ ПаузаНаОткачкуВпатрубке{  
 1738          		ТАЙМАУТ ДВЕ_МИНУТЫ В СЛЕДУЮЩЕЕ; 
 1739          	}  
 1740          	СОСТ ПроверкаУменьшенияДавленияВпатрубке{  
 1741          		ЕСЛИ(ФП_P_Впатрубке < ЛП_Предыдущее) В СОСТ ЗапоминаемДавлениеВпатрубке;
 1742                  ИНАЧЕ В СОСТ Ошибка;		
 1743          	} 	
 1744          	СОСТ КонтрольОткрытияЗВ{
 1745          		ЕСЛИ ( ПРОЦ ОТКР_ЗАТВОР_ВАК В СОСТ ПАССИВНОЕ){ 
 1746          			ЕСЛИ (ПРОЦ ОТКР_ЗАТВОР_ВАК В СОСТ ОШИБКА ) ОШИБКА;
 1747          			ИНАЧЕ  СТОП;
 1748          		} 
 1749          	} 
 1750           СОСТ Ошибка {
 1751                 ЕСЛИ (SendMsgGUICode(ПК_ГУИ_ДАВЛЕНИЕ_В_ПАТРУБКЕ_НЕ_УМЕНЬШАЕТСЯ))	ОШИБКА;
 1752                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГУИ В СОСТ НарушениеСвязи;
 1753           }
 1754            СОСТ НарушениеСвязи {
 1755          	   ОШИБКА;
 1756           }    
 1757          }
 1758          /*================================================================*/
 1759          /*              Процесс Выключить насос вакуумный                 */
 1760          /*   Этапы выключения вакуумного насоса:                           */
 1761          /*    1. Закрывается затвор вакуумный                             */
 1762          /*    2. Открывается сапун                                        */
 1763          /*    3. Ничего не делаем 20 секунд                               */
 1764          /*    4. Выключаем устройство плавного пуска                      */
 1765          /*    5. Выключаем питание вакуумного насоса                      */
 1766          /*    6. Выключаем питание насоса охлаждения                      */
 1767          /*    7. Выключаем питание вентилятора                            */
 1768          /*================================================================*/
 1769          ПРОЦ ВЫК_НАСОС_ВАКУУМНЫЙ{
 1770           ИЗ ПРОЦ Инициализация 	У_ВКЛ_ПИТ_НАС_ОХЛ;
 1771           
 1772          	СОСТ Начало{
 1773           		СТАРТ ПРОЦ ЗАКР_ЗАТВОР_ВАК ;
 1774          		В СЛЕДУЮЩЕЕ;
 1775          	}  
 1776          	
 1777          	СОСТ КонтрольЗакрытияЗатвораВакуумного{
 1778          		ЕСЛИ (ПРОЦ ЗАКР_ЗАТВОР_ВАК В СОСТ ПАССИВНОЕ){ 
 1779          			ЕСЛИ (ПРОЦ ЗАКР_ЗАТВОР_ВАК В СОСТ ОШИБКА ) ОШИБКА;
 1780          			ИНАЧЕ {
 1781          			СТОП ПРОЦ КонтрольОткачкиВауумнойТрубыСидеростата;
 1782          				СТАРТ ПРОЦ ОТКР_САПУН;
 1783          				В СЛЕДУЮЩЕЕ;
 1784          			}
 1785          		} 
 1786          	} 
 1787          	СОСТ КонтрольОткрытияСапуна{
 1788          		ЕСЛИ ( ПРОЦ ОТКР_САПУН В СОСТ ПАССИВНОЕ){ 
 1789          			ЕСЛИ (ПРОЦ ОТКР_САПУН В СОСТ ОШИБКА ) ОШИБКА;
 1790          			ИНАЧЕ {
 1791          				
 1792          				В СЛЕДУЮЩЕЕ;
 1793          			}
 1794          		} 
 1795          	} 
 1796          	СОСТ ТаймаутПередВыключениемПитанияВакуумногоНасоса{  
 1797          		ТАЙМАУТ ДВАДЦАТЬ_СЕКУНД В СЛЕДУЮЩЕЕ; 
 1798          	}  
 1799          
 1800          	СОСТ ВыключаемУППВакуумногоНасоса{  
 1801          		СТАРТ ПРОЦ ВЫК_УСТР_ПЛАВ_ПУСКА; В СЛЕДУЮЩЕЕ; 
 1802          	}	
 1803          	СОСТ КонтрольВыключенияПитанияУППВакуумногоНасоса{
 1804          		ЕСЛИ ( ПРОЦ ВЫК_УСТР_ПЛАВ_ПУСКА В СОСТ ПАССИВНОЕ){ 
 1805          			ЕСЛИ (ПРОЦ  ВЫК_УСТР_ПЛАВ_ПУСКА В СОСТ ОШИБКА) ОШИБКА;
 1806          			ИНАЧЕ {
 1807          				СТАРТ ПРОЦ ВЫК_ПИТ_ВАК_НАСОСА;
 1808          				В СЛЕДУЮЩЕЕ;
 1809          			}
 1810          		} 
 1811          	}   
 1812          
 1813          	СОСТ КонтрольВыключенияПитанияВакуумногоНасоса{
 1814          		ЕСЛИ ( ПРОЦ ВЫК_ПИТ_ВАК_НАСОСА В СОСТ ПАССИВНОЕ){ 
 1815          			ЕСЛИ (ПРОЦ  ВЫК_ПИТ_ВАК_НАСОСА В СОСТ ОШИБКА) ОШИБКА;
 1816          			ИНАЧЕ {
 1817          				СТАРТ ПРОЦ ВЫК_ПИТ_НАС_ОХЛ;
 1818          				В СЛЕДУЮЩЕЕ;
 1819          			}
 1820          		} 
 1821          	}   	
 1822          	
 1823          	СОСТ КонтрольВыключенияНасосаОхлаждения{
 1824          		ЕСЛИ ( ПРОЦ ВЫК_ПИТ_НАС_ОХЛ В СОСТ ПАССИВНОЕ){ 
 1825          				ЕСЛИ (ПРОЦ  ВЫК_ПИТ_НАС_ОХЛ В СОСТ ОШИБКА ) ОШИБКА;
 1826          				ИНАЧЕ {
 1827          					СТАРТ ПРОЦ ВЫК_ПИТ_ВЕНТИЛЯТОР;
 1828          					В СЛЕДУЮЩЕЕ;
 1829          				}
 1830          		}
 1831          	}  
 1832          	
 1833          	СОСТ КонтрольВыключенияВентилятора{
 1834          		ЕСЛИ ( ПРОЦ ВЫК_ПИТ_ВЕНТИЛЯТОР В СОСТ ПАССИВНОЕ){ 
 1835          				ЕСЛИ (ПРОЦ  ВЫК_ПИТ_ВЕНТИЛЯТОР В СОСТ ОШИБКА ) ОШИБКА;
 1836          				ИНАЧЕ СТОП;
 1837          		}
 1838          	}   
 1839          } /*конец процесса ВЫК_НАСОС_ВАКУУМНЫЙ */
 1840          
 1841          
 1842          
 1843          /*====================================================================*/
 1844          /*              Процесс Вакуумирование                                */
 1845          /* Процесс запускает включение вакуумной подсистемы и смотрит         */
 1846          /* величину откачки и готовность вакуума. Если откачка в норме,       */
 1847          /* анализируется готовность вакуума и, как только вакуумирование      */
 1848          /*  достигнет нормы ( нужный вакуум есть) процесс                     */
 1849          /*  заканчивается без ошибки. Причем насос вакуумный продолжает       */
 1850          /* работать. Если вакуумирование  не пошло или                        */
 1851          /*  откачка не на уровне, данный процесс завершается с ошибкой  и     */
 1852          /* насос вакуумный выключается.                                       */
 1853          /*====================================================================*/
 1854          ПРОЦ ВКЛ_ВАКУУМИРОВАНИЕ_ТРУБЫ{
 1855           ИЗ ПРОЦ Инициализация 	ФлагГотовВакуумаВТ,
 1856          						ФлагОткачкиТрубыСидеростата,
 1857          						ФП_P_ВтрубеСидер,
 1858          						ФП_T_Врубашке,
 1859          						К_ВЕНТИЛЯТОР,
 1860          						К_НАСОС_ОХЛ;
 1861           ПЛАВ ЛП_Предыдущее ЛОКАЛ;
 1862           СОСТ Начало{
 1863             ЕСЛИ (ФлагГотовВакуумаВТ == НОРМА) СТОП;
 1864             ИНАЧЕ {  
 1865          	СТАРТ ПРОЦ ВКЛ_НАСОС_ВАКУУМНЫЙ;
 1866          	В СЛЕДУЮЩЕЕ;
 1867          	} 
 1868           }
 1869          	СОСТ КонтрольВключенияНасоса{
 1870          		ЕСЛИ ( ПРОЦ ВКЛ_НАСОС_ВАКУУМНЫЙ В СОСТ ПАССИВНОЕ){ 
 1871          			ЕСЛИ (ПРОЦ ВКЛ_НАСОС_ВАКУУМНЫЙ В СОСТ ОШИБКА ) {
 1872          				СТАРТ ПРОЦ ВЫК_НАСОС_ВАКУУМНЫЙ; 
 1873          				ОШИБКА;
 1874          			}
 1875          			ИНАЧЕ {
 1876          				СТАРТ ПРОЦ КонтрольОткачкиВауумнойТрубыСидеростата;	
 1877          				В СЛЕДУЮЩЕЕ;
 1878          			}
 1879          		} 
 1880          	} 
 1881          	
 1882          	СОСТ ЗапоминаемДавлениеВвакуумнойТрубе{
 1883          			ЛП_Предыдущее = ФП_P_ВтрубеСидер;
 1884          			В СЛЕДУЮЩЕЕ;
 1885          	}
 1886          		/* контроль перегрева рубашки, самопроизвольного выключения вентилятора и водяного насоса*/
 1887          	СОСТ КонтрольОборудования{
 1888          			ЕСЛИ ( (ФП_T_Врубашке <= 85) && (К_ВЕНТИЛЯТОР) && (К_НАСОС_ОХЛ) ) В СЛЕДУЮЩЕЕ;
 1889          			ИНАЧЕ {
 1890          				СТАРТ ПРОЦ ВЫК_НАСОС_ВАКУУМНЫЙ;
 1891          			ОШИБКА;
 1892          			}
 1893          	}		
 1894          	СОСТ КонтрольДавления{  
 1895          		ЕСЛИ (ФП_P_ВтрубеСидер <= 0.02) {
 1896          			СТАРТ ПРОЦ ВЫК_НАСОС_ВАКУУМНЫЙ; 
 1897          			СТОП;
 1898          			}
 1899          		ИНАЧЕ В СЛЕДУЮЩЕЕ;
 1900          	} 	
 1901          	СОСТ ПаузаНаОткачкуВвакуумнойТрубе{  
 1902          		ТАЙМАУТ ДВЕ_МИНУТЫ В СЛЕДУЮЩЕЕ; 
 1903          	}  
 1904          	СОСТ ПроверкаУменьшенияДавленияВпатрубке{  
 1905          		ЕСЛИ(ФП_P_ВтрубеСидер < ЛП_Предыдущее) В СОСТ ЗапоминаемДавлениеВвакуумнойТрубе;
 1906                  ИНАЧЕ ОШИБКА;		/* м.б. сообщение выдавать, что вакуумированию трубы - труба */
 1907          	} 	
 1908          } /*конец процесса ВКЛ_ВАКУУМИРОВАНИЕ_ТРУБЫ */
 1909          
 1910          
 1911          
 1912          
 1913          /*================================================================*/
 1914          /*             Процесс Вакуумирование в вакуумной трубе           */
 1915          /*  Процесс выключает вакуумирование в вакуумной трубе            */
 1916          /*  может быть этот процесс и не нужен                            */
 1917          /*================================================================*/
 1918          ПРОЦ ВЫК_ВАКУУМИРОВАНИЕ_ТРУБЫ{
 1919          	ИЗ ПРОЦ Инициализация ФлагГотовВакуумаВТ;
 1920          
 1921           СОСТ Начало{
 1922          	ЕСЛИ (ПРОЦ ВКЛ_ВАКУУМИРОВАНИЕ_ТРУБЫ В СОСТ АКТИВНОЕ) СТОП ПРОЦ ВКЛ_ВАКУУМИРОВАНИЕ_ТРУБЫ; 
 1923          	СТАРТ ПРОЦ ВЫК_НАСОС_ВАКУУМНЫЙ;
 1924          	СТОП;
 1925           }
 1926          } /*конец процесса ВЫК_ВАКУУМИРОВАНИЕ_ТРУБЫ */
 1927          
 1928          }  /* \Прогр */

%RCSL-I-SUMMARY, Completed with 0 error(s).
%RCSL-I-SUMMARY, Completed with 0 warning(s).

 %RCSL-I-SUMMARY, Completed with 0 error(s).