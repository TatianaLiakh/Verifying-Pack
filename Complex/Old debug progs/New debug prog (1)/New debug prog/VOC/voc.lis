    1           Прогр VOC 
    2          
    3           { 
    4          
    5          /*###########################################################*/
    6          /*ПРОГРАММА ИМИТАЦИИ УГЛОИЗМЕРИТЕЛЬНОЙ МАШИНЫ  НОНИУС*/
    7          /*###########################################################*/
    8          
    9          /*###########################################################*/
   10          /*#########                     #############################*/
   11          /*#########  ОПИСАНИЕ КОНСТАНТ  #############################*/
   12          /*#########                     #############################*/
   13          /*###########################################################*/
   14          
   15          ТАКТ     50;    /* такт равен 500 миллисекундам */
   16          
   17          КОНСТ ВКЛ                1;
   18          КОНСТ ВЫКЛ               0;
   19          /*===========================================================*/
   20          /*========= ДИАПАЗОН ИЗМЕНЕНИЯ ЗАДАНИЙ            ===========*/
   21          /*===========================================================*/
   22          КОНСТ МИНИМАЛЬНОЕ_ЗАДАНИЕ_R_КАРЕТКИ            0.0;   /* мм  */ 
   23          КОНСТ МАКСИМАЛЬНОЕ_ЗАДАНИЕ_R_КАРЕТКИ        200.0;    /* мм  */
   24          
   25          КОНСТ МИНИМАЛЬНОЕ_ЗАДАНИЕ_W_УгловойСкорости            0.0;   /* ??????  */ 
   26          КОНСТ МАКСИМАЛЬНОЕ_ЗАДАНИЕ_W_УгловойСкорости        200.0;    /* ?????  */ 
   27          
   28          
   29          КОНСТ R_ПО_УМОЛЧАНИЮ 0.0;
   30          КОНСТ W_ПО_УМОЛЧАНИЮ 0.0;
   31          КОНСТ R_ФП_ПО_УМОЛЧАНИЮ 0.0;
   32          КОНСТ ФП_W_ПО_УМОЛЧАНИЮ 0.0;
   33          
   34          КОНСТ ТАЙМАУТ_ВОЗД_ПОДУШКИ 10;
   35          КОНСТ ТАЙМАУТ_КЛАПАНОВ 10;
   36          
   37          
   38          /*===========================================================*/
   39          /*========= КОДЫ КОМАНД ПОСТУПАЮЩИХ ОТ GUI ==================*/
   40          /*===========================================================*/
   41          /*КОДЫ НАЧАЛЬНЫХ СООБЩЕНИЙ*/
   42          ПЕРЕЧИСЛЕНИЕ 
   43          {
   44          КОМ_ВХОДНАЯ_ТЕСТ_ДАВЛЕНИЕ_В_НОРМУ,
   45          КОМ_ВХОДНАЯ_ТЕСТ_ДАВЛЕНИЕ_В_НИЗКОЕ,
   46          КОМ_ВХОДНАЯ_ТЕСТ_ДАВЛЕНИЕ_В_АВАРИНОЕ,
   47          КОМ_ВХОДНАЯ_ТЕСТ_ОПОРА_ИСПРАВНА,
   48          КОМ_ВХОДНАЯ_ТЕСТ_ОПОРА_ОТКАЗ_ВКЛЮЧЕНИЯ,
   49          КОМ_ВХОДНАЯ_ТЕСТ_ОПОРА_ОТКАЗ_ВЫКЛЮЧЕНИЯ,
   50          КОМ_ВХОДНАЯ_ТЕСТ_КАРЕТКА_ИСПРАВНА,
   51          КОМ_ВХОДНАЯ_ТЕСТ_КАРЕТКА_ОТКАЗ_ВКЛЮЧЕНИЯ,
   52          КОМ_ВХОДНАЯ_ТЕСТ_КАРЕТКА_ОТКАЗ_ВЫКЛЮЧЕНИЯ,
   53          КОМ_ВХОДНАЯ_ТЕСТ_ШПИНДЕЛЬ_ИСПРАВЕН,
   54          КОМ_ВХОДНАЯ_ТЕСТ_ШПИНДЕЛЬ_ОТКАЗ_ВКЛЮЧЕНИЯ,
   55          КОМ_ВХОДНАЯ_ТЕСТ_ШПИНДЕЛЬ_ОТКАЗ_ВЫКЛЮЧЕНИЯ,
   56          КОМ_ВХОДНАЯ_ТЕСТ_СВЕТОДИОД_ИСПРАВЕН,
   57          КОМ_ВХОДНАЯ_ТЕСТ_СВЕТОДИОД_ОТКАЗ_ВКЛЮЧЕНИЯ,
   58          КОМ_ВХОДНАЯ_ТЕСТ_СВЕТОДИОД_ОТКАЗ_ВЫКЛЮЧЕНИЯ,
   59          КОМ_ВХОДНАЯ_ТЕСТ_КЛАПАН_АТМОСФЕРЫ_ИСПРАВЕН,
   60          КОМ_ВХОДНАЯ_ТЕСТ_КЛАПАН_АТМОСФЕРЫ_ОТКАЗ_ВКЛЮЧЕНИЯ,
   61          КОМ_ВХОДНАЯ_ТЕСТ_КЛАПАН_АТМОСФЕРЫ_ОТКАЗ_ВЫКЛЮЧЕНИЯ,
   62          КОМ_ВХОДНАЯ_ТЕСТ_КЛАПАН_ВАКУУМА_ИСПРАВЕН,
   63          КОМ_ВХОДНАЯ_ТЕСТ_КЛАПАН_ВАКУУМА_ОТКАЗ_ВКЛЮЧЕНИЯ,
   64          КОМ_ВХОДНАЯ_ТЕСТ_КЛАПАН_ВАКУУМА_ОТКАЗ_ВЫКЛЮЧЕНИЯ,
   65          
   66          КОМ_ВХОДНАЯ_ТЕСТ_КОНТРОЛЬНОЕ_СООБЩЕНИЕ
   67          };
   68          
   69          /*===========================================================*/
   70          /*========= КОДЫ КОМАНД ПОСТУПАЮЩИХ ОТ АУ  ==================*/
   71          /*===========================================================*/
   72          
   73          /*===========================================================*/
   74          /*========= КОДЫ СООБЩЕНИЙ ВЫХОДНЫХ ==============*/
   75          /*===========================================================*/
   76          ПЕРЕЧИСЛЕНИЕ {
   77          	КОМ_ВЫХОДНАЯ_ТЕСТ_ИЗМН_R_КАРЕТКИ = КОМ_ВХОДНАЯ_ТЕСТ_КОНТРОЛЬНОЕ_СООБЩЕНИЕ + 1, 
   78          	КОМ_ВЫХОДНАЯ_ТЕСТ_ИЗМН_W_КАРЕТКИ,  		
   79          	КОМ_ВЫХОДНАЯ_ТЕСТ_ИЗМН_R_ФП_КАРЕТКИ,
   80          	КОМ_ВЫХОДНАЯ_ТЕСТ_ИЗМН_W_ФП_КАРЕТКИ,
   81          	КОМ_ВЫХОДНАЯ_ТЕСТ_ДАВЛЕНИЕ_В_НОРМЕ,
   82          	КОМ_ВЫХОДНАЯ_ТЕСТ_ДАВЛЕНИЕ_НИЗКОЕ,
   83          	КОМ_ВЫХОДНАЯ_ТЕСТ_ДАВЕЛЕНИЕ_АВАРИЙНОЕ,
   84          	КОМ_ВЫХОДНАЯ_ОШИБКА_КОДА_КОМАНДЫ_ОТ_ГУИ,
   85          	КОМ_ВЫХОДНАЯ_ТЕСТ_ВОЗДУХ_ПОДАН_НА_ОПОРУ,
   86          	КОМ_ВЫХОДНАЯ_ТЕСТ_НА_ОПОРЕ_СТОЛА_АВАРИЙНОЕ_ДАВЛЕНИЕ,
   87          	КОМ_ВЫХОДНАЯ_ТЕСТ_ВЫКЛЮЧЕНА_ПОДАЧА_ВОЗДУХА_НА_ОПОРУ,
   88          	КОМ_ВЫХОДНАЯ_ТЕСТ_ВОЗДУХ_ПОДАН_НА_КАРЕТКУ,
   89          	КОМ_ВЫХОДНАЯ_ТЕСТ_НА_КАРЕТКЕ_АВАРИЙНОЕ_ДАВЛЕНИЕ,
   90          	КОМ_ВЫХОДНАЯ_ТЕСТ_ВЫКЛЮЧЕНА_ПОДАЧА_ВОЗДУХА_НА_КАРЕТКУ,
   91          	КОМ_ВЫХОДНАЯ_ТЕСТ_ВОЗДУХ_ПОДАН_НА_ШПИНДЕЛЬ,
   92          	КОМ_ВЫХОДНАЯ_ТЕСТ_ПРЕДУПРЕЖДЕНИЕ_ВОЗДУХ_ПОДАН_НА_ШПИНДЕЛЬ_НА_КАРЕТКЕ_НЕТ,
   93          	КОМ_ВЫХОДНАЯ_ТЕСТ_ПРЕДУПРЕЖДЕНИЕ_ВОЗДУХ_ПОДАН_НА_ШПИНДЕЛЬ_НА_ОПОРЕ_НЕТ,
   94          	КОМ_ВЫХОДНАЯ_ТЕСТ_НА_ШПИНДЕЛЕ_АВАРИЙНОЕ_ДАВЛЕНИЕ,
   95          	КОМ_ВЫХОДНАЯ_ТЕСТ_ВЫКЛЮЧЕНА_ПОДАЧА_ВОЗДУХА_НА_ШПИНДЕЛЬ,
   96          	КОМ_ВЫХОДНАЯ_ТЕСТ_ПИТАНИЕ_ПОДАНО_НА_ЛАЗЕР,
   97          	КОМ_ВЫХОДНАЯ_ТЕСТ_ПИТАНИЕ_НА_ЛАЗЕРЕ_НЕТ,
   98          	КОМ_ВЫХОДНАЯ_ТЕСТ_СВЕТОДИОД_ВКЛЮЧЕН,
   99          	КОМ_ВЫХОДНАЯ_ТЕСТ_СВЕТОДИОД_ВЫКЛЮЧЕН,
  100          	КОМ_ВЫХОДНАЯ_ТЕСТ_СВЕТОДИОД_ОТКАЗ_ВКЛЮЧЕНИЯ,
  101          	КОМ_ВЫХОДНАЯ_ТЕСТ_СВЕТОДИОД_ОТКАЗ_ВЫКЛЮЧЕНИЯ,
  102          	КОМ_ВЫХОДНАЯ_ТЕСТ_НАСОС_ВЫКЛЮЧЕН,
  103          	КОМ_ВЫХОДНАЯ_ТЕСТ_КЛАПАН_НАСОС_ВКЛЮЧЕН,
  104          	КОМ_ВЫХОДНАЯ_ТЕСТ_КЛАПАН_АТМОСФЕРЫ_ОТКРЫТ,
  105          	КОМ_ВЫХОДНАЯ_ТЕСТ_КЛАПАН_АТМОСФЕРЫ_ЗАКРЫТ,
  106          	КОМ_ВЫХОДНАЯ_ТЕСТ_КЛАПАН_ВАКУУМА_ОТКРЫТ,
  107          	КОМ_ВЫХОДНАЯ_ТЕСТ_КЛАПАН_ВАКУУМА_ЗАКРЫТ,
  108          	КОМ_ВЫХОДНАЯ_ТЕСТ_ОБА_КЛАПАНА_ОТКРЫТЫ_ДИСК_РАЗАЖАТ,
  109          	КОМ_ВЫХОДНАЯ_ТЕСТ_ВАКУУМ_ОТКРЫТ_АТМОСФЕРА_ЗАКРЫТ_ДИСК_ЗАЖАТ,
  110          	КОМ_ВЫХОДНАЯ_ТЕСТ_ВАКУУМ_ОТКРЫТ_АТМОСФЕРА_ЗАКРЫТ_ДИСК_РАЗЖАТ,
  111          	КОМ_ВЫХОДНАЯ_ТЕСТ_ВАКУУМ_ЗАКРЫТ_АТМОСФЕРА_ОТКРЫТ_ДИСК_РАЗАЖАТ,
  112          	КОМ_ВЫХОДНАЯ_ТЕСТ_ВАКУУМ_ЗАКРЫТ_АТМОСФЕРА_ЗАКРЫТ_ДИСК_ЗАЖАТ,
  113          	КОМ_ВЫХОДНАЯ_ТЕСТ_ВАКУУМ_ЗАКРЫТ_АТМОСФЕРА_ЗАКРЫТ_ДИСК_РАЗЖАТ,
  114          	КОМ_ВЫХОДНАЯ_ТЕСТ_КОНТРОЛЬНОЕ_СООБЩЕНИЕ 
  115           };
  116           
  117           /*ФЛАГИ СОСТОЯНИЙ*/
  118           
  119           ПЕРЕЧИСЛЕНИЕ 
  120           {
  121          	ДАВЛЕНИЕ_АВАРИЙНОЕ,
  122          	ДАВЛЕНИЕ_НИЗКОЕ,
  123          	ДАВЛЕНИЕ_В_НОРМЕ
  124           };
  125           
  126           ПЕРЕЧИСЛЕНИЕ 
  127          {
  128          	ИСПРАВНОСТЬ,
  129          	ОТКАЗ_ВКЛЮЧЕНИЯ,
  130          	ОТКАЗ_ВЫКЛЮЧЕНИЯ
  131          };
  132          /*=========================================================================*/
  133          /*========================== ФУНКЦИИ ======================================*/
  134          /*=========================================================================*/
  135          /*:::::::::Функции для работы  с ГУИ :::::::::::::::::::::   */
  136          
  137          /*чтение кода и параметра события от ПИВ из кольцевого буфера в память */
  138          ФУНКЦИЯ ЦЕЛ GetNextMsgGUI(ПУСТО);
  139          ФУНКЦИЯ ЦЕЛ  GetMsgGUICode        		(ПУСТО);  /*чтение из памяти кода события */
  140          ФУНКЦИЯ ПЛАВ GetFloatParamGUI     		(ПУСТО);  /*чтение из памяти параметра события */
  141          ФУНКЦИЯ ЦЕЛ  SendMsgLongParamGUI  		(ЦЕЛ, ДЦЕЛ);
  142          ФУНКЦИЯ ДЦЕЛ GetLongParamGUI      		(ПУСТО);  /*чтение с экрана гуи - исползуется */
  143          ФУНКЦИЯ ЦЕЛ  SendMsgGUICode       		(ЦЕЛ);
  144          ФУНКЦИЯ ЦЕЛ  SendMsgFloatParamGUI       (ЦЕЛ, ПЛАВ);
  145          
  146          
  147          ВХОД ВХОД_МОХА_1214_ДАВЛ_ВАКУУМ		  	0 0 8; 
  148          ВХОД ВХОД_МОХА_1212_ЛАЗЕР		  			0 1 8; 
  149          
  150          ВЫХОД  ВЫХОД_МОХА_1214_ДАВЛ_ВАКУУМ  			1 0 8; 
  151          ВЫХОД  ВЫХОД_МОХА_1212_ЛАЗЕР		  			1 1 8; 
  152          
  153          ПРОЦ Инициализация
  154          {
  155          /*===========================================================*/
  156          /*=========== ОПИСАНИЕ ПЕРЕМЕННЫХ ===========================*/
  157          /*===========================================================*/
  158          
  159          /*=========== МОХА 1214 (ДАВЛЕНИЕ И ВАКУУМ) =======*/
  160          /* ВЫХОДНЫЕ СИГНАЛЫ 1214 "ВОЗД_ПОД" -- воздушная подушка, "ЛУ" -- локальное управление */
  161          
  162          ЛОГ У_ВОЗД_ПОД_КАРЕТКИ			= {ВХОД_МОХА_1214_ДАВЛ_ВАКУУМ[1]} ДЛЯ ВСЕХ; 	/* К1 */
  163          ЛОГ У_ВОЗД_ПОД_ШПИНДЕЛЯ			= {ВХОД_МОХА_1214_ДАВЛ_ВАКУУМ[1]} ДЛЯ ВСЕХ;	/* К2 */
  164          ЛОГ У_ВОЗД_ПОД_СТОЛА			= {ВХОД_МОХА_1214_ДАВЛ_ВАКУУМ[1]} ДЛЯ ВСЕХ;	/* К3 */  /* ноги*/
  165          ЛОГ У_ЗАЖИМ_ДИСКА				= {ВХОД_МОХА_1214_ДАВЛ_ВАКУУМ[1]} ДЛЯ ВСЕХ;	/* К4 */
  166          ЛОГ У_ВКЛ_НАСОС					= {ВХОД_МОХА_1214_ДАВЛ_ВАКУУМ[1]} ДЛЯ ВСЕХ;	/* питание насоса */ 
  167          ЛОГ У_РАЗЖИМ_ДИСКА				= {ВХОД_МОХА_1214_ДАВЛ_ВАКУУМ[1]} ДЛЯ ВСЕХ;	/* К5 */ 
  168          
  169          /* ВЫХОДНЫЕ ДАВЛЕНИЕ И ВАКУУМ */  
  170          ЛОГ К_ВОЗД_ПОД_Р_НЕ_КРИТИЧЕСКОЕ		= {ВЫХОД_МОХА_1214_ДАВЛ_ВАКУУМ[1]} ДЛЯ ВСЕХ;	/*ВЫХОД МОХИ  	0*/  
  171          ЛОГ К_ВОЗД_ПОД_Р_РАБОЧЕЕ			= {ВЫХОД_МОХА_1214_ДАВЛ_ВАКУУМ[1]} ДЛЯ ВСЕХ;	/*ВЫХОД МОХИ  	1*/ 
  172          ЛОГ К_ДИСК_РАЗЖАТ					= {ВЫХОД_МОХА_1214_ДАВЛ_ВАКУУМ[1]} ДЛЯ ВСЕХ; /*ВЫХОД МОХИ  	2*/     /* тут если 0, то вакуум есть ТАК ?????*/  173          
  174          ЛОГ К_1214_ДИСТАНЦИОННОЕ			= {ВЫХОД_МОХА_1214_ДАВЛ_ВАКУУМ[1]} ДЛЯ ВСЕХ; /*ВЫХОД МОХИ  	3*/		/* true - от программы, означает, что в  175          се управление false на оборудовании*/
  176          
  177          
  178          /*=========== МОХА 1212 =======*/
  179          /* ВХОДНЫЕ СИГНАЛЫ 1212 "ВОЗД_ПОД" -- воздушная подушка, "ЛУ" -- локальное управление */
  180          ЛОГ У_ПИТАНИЕ_ЛАЗЕРА				= {ВХОД_МОХА_1212_ЛАЗЕР[1]} ДЛЯ ВСЕХ; /*ВХОД МОХИ  0*/
  181          ЛОГ У_ВКЛ_ЛАЗЕРА					= {ВХОД_МОХА_1212_ЛАЗЕР[1]} ДЛЯ ВСЕХ; /*ВХОД МОХИ  1*/
  182          ЛОГ У_ИНТЕНСИВНОСТЬ_ЛАЗЕРА			= {ВХОД_МОХА_1212_ЛАЗЕР[1]} ДЛЯ ВСЕХ;  /*ВХОД МОХИ 2*/	/*МОДУЛЯТОР_ЛАЗЕРА*/
  183          ЛОГ У_ВКЛ_СВЕТОДИОДА				= {ВХОД_МОХА_1212_ЛАЗЕР[1]} ДЛЯ ВСЕХ;  /*освещение диска*/
  184          ЛОГ У_ВЫКЛ_СВЕТОДИОДА				= {ВХОД_МОХА_1212_ЛАЗЕР[1]} ДЛЯ ВСЕХ; /*освещение диска*/
  185          
  186          
  187          /*-----от  ЖЕЛЕЗА --ЛАЗЕР---------*/	/* читаются входы с железа через МОХУ функцией inputf2  */
  188          ЛОГ К_1212_ДИСТАНЦИОННОЕ				= {ВХОД_МОХА_1212_ЛАЗЕР[1]} ДЛЯ ВСЕХ;	/*вход МОХИ  	0*/
  189          ЛОГ К_ИНТЕНСИВНОСТЬ_ЛАЗЕРА				= {ВХОД_МОХА_1212_ЛАЗЕР[1]} ДЛЯ ВСЕХ;	/*вход МОХИ  	1*/ /* Перебейнос думает о значении сигнала */
  190          
  191          /*===========================================================*/
  192          /*=========== ЯЧЕЙКИ ИНФОРМАЦИОННЫХ КАНАЛОВ =================*/
  193          /*===========================================================*/
  194          ЦЕЛ КодСобытия_от_ГУИ        ДЛЯ ВСЕХ;
  195          ЦЕЛ КодСобытия_к_ГУИ         ДЛЯ ВСЕХ;
  196          
  197          /*===========================================================*/
  198          /*=========== ЯЧЕЙКИ ФАКТИЧЕСКИХ ЗНАЧЕНИЙ ===================*/
  199          /*===========================================================*/
  200          ПЛАВ   	ЗД_R_КАРЕТКИ			ДЛЯ ВСЕХ;
  201          ПЛАВ 	ЗД_W_УгловойСкорости	ДЛЯ ВСЕХ;
  202          ПЛАВ   	ФП_R_КАРЕТКИ			ДЛЯ ВСЕХ;
  203          ПЛАВ 	ФП_W_ПРЕДМЕТНОГО_СТОЛИКА	ДЛЯ ВСЕХ;
  204          
  205          /*===Флаги сценариев работы===*/
  206          ЦЕЛ ФлагСостояниеДавления ДЛЯ ВСЕХ;
  207          ЦЕЛ ФлагРежимРаботыОпоры ДЛЯ ВСЕХ;
  208          ЦЕЛ ФлагРежимРаботыКаретки ДЛЯ ВСЕХ;
  209          ЦЕЛ ФлагРежимРаботыШпинделя ДЛЯ ВСЕХ;
  210          ЦЕЛ ФлагРаботыСветодиода ДЛЯ ВСЕХ;
  211          ЦЕЛ ФлагРежимКлапанаАтмосферы ДЛЯ ВСЕХ;
  212          ЦЕЛ ФлагРежимКлапанаВакуума ДЛЯ ВСЕХ;
  213          
  214          	 СОСТ Начало
  215          	 {	 
  216          
  217          		ФлагРежимРаботыОпоры = ИСПРАВНОСТЬ;
  218          		ФлагРежимРаботыКаретки = ИСПРАВНОСТЬ;
  219          		ФлагРежимРаботыШпинделя = ИСПРАВНОСТЬ;		
  220          		ФлагРаботыСветодиода = ИСПРАВНОСТЬ;
  221          		ФлагРежимКлапанаАтмосферы = ИСПРАВНОСТЬ;
  222          		ФлагРежимКлапанаВакуума = ИСПРАВНОСТЬ;
  223          		
  224          		ФлагСостояниеДавления = ДАВЛЕНИЕ_В_НОРМЕ;
  225          		
  226          		ЗД_R_КАРЕТКИ = R_ПО_УМОЛЧАНИЮ;
  227          		ЗД_W_УгловойСкорости = W_ПО_УМОЛЧАНИЮ;		
  228          		ФП_R_КАРЕТКИ	= R_ФП_ПО_УМОЛЧАНИЮ; 
  229          		ФП_W_ПРЕДМЕТНОГО_СТОЛИКА = 	ФП_W_ПО_УМОЛЧАНИЮ;
  230          		
  231          		SendMsgFloatParamGUI(КОМ_ВЫХОДНАЯ_ТЕСТ_ИЗМН_R_КАРЕТКИ, ЗД_R_КАРЕТКИ);
  232          		SendMsgFloatParamGUI(КОМ_ВЫХОДНАЯ_ТЕСТ_ИЗМН_W_КАРЕТКИ, ЗД_W_УгловойСкорости);
  233          		SendMsgFloatParamGUI(КОМ_ВЫХОДНАЯ_ТЕСТ_ИЗМН_R_ФП_КАРЕТКИ, ФП_R_КАРЕТКИ);
  234          		SendMsgFloatParamGUI(КОМ_ВЫХОДНАЯ_ТЕСТ_ИЗМН_W_ФП_КАРЕТКИ, ФП_W_ПРЕДМЕТНОГО_СТОЛИКА);
  235          		СТАРТ ПРОЦ ЧтениеКольцевогоБуфера;
  236          		СТАРТ ПРОЦ КОНТРОЛЬ_ДАВЛЕНИЯ_ВОЗД_ПОДУШКИ; 
  237          		СТАРТ ПРОЦ КонтрольПодачиВоздухаНаОпору; 
  238          		СТАРТ ПРОЦ КонтрольПодачиВоздухаНаКаретку; 
  239          		СТАРТ ПРОЦ КонтрольПодачиВоздухаНаШпиндель; 
  240          		СТАРТ ПРОЦ КонтрольКлапанаАтмосферы; 
  241          		СТАРТ ПРОЦ КонтрольРазжатияЗажатияДиска; 
  242          		СТАРТ ПРОЦ КонтрольКлапанаВакуума;
  243          		
  244          		
  245          		СТОП;		
  246          		
  247          		
  248          	 }
  249          }
  250          
  251          ПРОЦ ЧтениеКольцевогоБуфера
  252          {
  253          ИЗ ПРОЦ Инициализация КодСобытия_от_ГУИ,
  254          		ЗД_R_КАРЕТКИ,
  255          		ЗД_W_УгловойСкорости,
  256          		ФлагСостояниеДавления, 
  257          		ФлагРежимКлапанаАтмосферы , 
  258          		ФлагРежимКлапанаВакуума,
  259          		ФлагРежимРаботыКаретки,
  260          		ФлагРежимРаботыШпинделя,
  261          		ФлагРаботыСветодиода,
  262          		ФлагРежимРаботыОпоры;       
  263          ЦЕЛ КодСобытия_от_ГИO ЛОКАЛ;
  264          
  265          	СОСТ Начало
  266          	 {
  267          		/*  читаем код и параметр события из кольцевого буфера в структуру */
  268          		ЕСЛИ (GetNextMsgGUI()) 
  269          		{
  270          			КодСобытия_от_ГИO = GetMsgGUICode(); 
  271          			РАЗБОР (КодСобытия_от_ГИO) {
  272          				СЛУЧАЙ КОМ_ВХОДНАЯ_ТЕСТ_ДАВЛЕНИЕ_В_НОРМУ:
  273          					ФлагСостояниеДавления = ДАВЛЕНИЕ_В_НОРМЕ;
  274          					КОНЕЦ;
  275          				СЛУЧАЙ КОМ_ВХОДНАЯ_ТЕСТ_ДАВЛЕНИЕ_В_НИЗКОЕ:
  276          					ФлагСостояниеДавления = ДАВЛЕНИЕ_НИЗКОЕ;
  277          					КОНЕЦ;
  278          				СЛУЧАЙ КОМ_ВХОДНАЯ_ТЕСТ_ДАВЛЕНИЕ_В_АВАРИНОЕ:
  279          					ФлагСостояниеДавления = ДАВЛЕНИЕ_АВАРИЙНОЕ;
  280          					КОНЕЦ;
  281          				
  282          				СЛУЧАЙ КОМ_ВХОДНАЯ_ТЕСТ_ОПОРА_ИСПРАВНА:
  283          					ФлагРежимРаботыОпоры  = ИСПРАВНОСТЬ;
  284          					КОНЕЦ;
  285          				СЛУЧАЙ КОМ_ВХОДНАЯ_ТЕСТ_ОПОРА_ОТКАЗ_ВКЛЮЧЕНИЯ:
  286          					ФлагРежимРаботыОпоры  = ОТКАЗ_ВКЛЮЧЕНИЯ;
  287          					КОНЕЦ;
  288          				СЛУЧАЙ КОМ_ВХОДНАЯ_ТЕСТ_ОПОРА_ОТКАЗ_ВЫКЛЮЧЕНИЯ:
  289          					ФлагРежимРаботыОпоры  = ОТКАЗ_ВЫКЛЮЧЕНИЯ;
  290          					КОНЕЦ;
  291          				
  292          				СЛУЧАЙ КОМ_ВХОДНАЯ_ТЕСТ_КАРЕТКА_ИСПРАВНА:
  293          					ФлагРежимРаботыКаретки  = ИСПРАВНОСТЬ;
  294          					КОНЕЦ;
  295          				СЛУЧАЙ КОМ_ВХОДНАЯ_ТЕСТ_КАРЕТКА_ОТКАЗ_ВКЛЮЧЕНИЯ:
  296          					ФлагРежимРаботыКаретки  = ОТКАЗ_ВКЛЮЧЕНИЯ;
  297          					КОНЕЦ;
  298          				СЛУЧАЙ КОМ_ВХОДНАЯ_ТЕСТ_КАРЕТКА_ОТКАЗ_ВЫКЛЮЧЕНИЯ:
  299          					ФлагРежимРаботыКаретки  = ОТКАЗ_ВЫКЛЮЧЕНИЯ;
  300          					КОНЕЦ;
  301          					
  302          				СЛУЧАЙ КОМ_ВХОДНАЯ_ТЕСТ_ШПИНДЕЛЬ_ИСПРАВЕН:
  303          					ФлагРежимРаботыШпинделя   = ИСПРАВНОСТЬ;
  304          					КОНЕЦ;
  305          				СЛУЧАЙ КОМ_ВХОДНАЯ_ТЕСТ_ШПИНДЕЛЬ_ОТКАЗ_ВКЛЮЧЕНИЯ:
  306          					ФлагРежимРаботыШпинделя   = ОТКАЗ_ВКЛЮЧЕНИЯ;
  307          					КОНЕЦ;
  308          				СЛУЧАЙ КОМ_ВХОДНАЯ_ТЕСТ_ШПИНДЕЛЬ_ОТКАЗ_ВЫКЛЮЧЕНИЯ:
  309          					ФлагРежимРаботыШпинделя   = ОТКАЗ_ВЫКЛЮЧЕНИЯ;
  310          					КОНЕЦ;	
  311          					
  312          				СЛУЧАЙ КОМ_ВХОДНАЯ_ТЕСТ_СВЕТОДИОД_ИСПРАВЕН:
  313          					ФлагРаботыСветодиода    = ИСПРАВНОСТЬ;
  314          					КОНЕЦ;
  315          				СЛУЧАЙ КОМ_ВХОДНАЯ_ТЕСТ_СВЕТОДИОД_ОТКАЗ_ВКЛЮЧЕНИЯ:
  316          					ФлагРаботыСветодиода    = ОТКАЗ_ВКЛЮЧЕНИЯ;
  317          					КОНЕЦ;
  318          				СЛУЧАЙ КОМ_ВХОДНАЯ_ТЕСТ_СВЕТОДИОД_ОТКАЗ_ВЫКЛЮЧЕНИЯ:
  319          					ФлагРаботыСветодиода    = ОТКАЗ_ВЫКЛЮЧЕНИЯ;
  320          					КОНЕЦ;	
  321          					
  322          				СЛУЧАЙ КОМ_ВХОДНАЯ_ТЕСТ_КЛАПАН_АТМОСФЕРЫ_ИСПРАВЕН:
  323          					ФлагРежимКлапанаАтмосферы     = ИСПРАВНОСТЬ;
  324          					КОНЕЦ;
  325          				СЛУЧАЙ КОМ_ВХОДНАЯ_ТЕСТ_КЛАПАН_АТМОСФЕРЫ_ОТКАЗ_ВКЛЮЧЕНИЯ:
  326          					ФлагРежимКлапанаАтмосферы     = ОТКАЗ_ВКЛЮЧЕНИЯ;
  327          					КОНЕЦ;
  328          				СЛУЧАЙ КОМ_ВХОДНАЯ_ТЕСТ_КЛАПАН_АТМОСФЕРЫ_ОТКАЗ_ВЫКЛЮЧЕНИЯ:
  329          					ФлагРежимКлапанаАтмосферы     = ОТКАЗ_ВЫКЛЮЧЕНИЯ;
  330          					КОНЕЦ;	
  331          					
  332          				СЛУЧАЙ КОМ_ВХОДНАЯ_ТЕСТ_КЛАПАН_ВАКУУМА_ИСПРАВЕН:
  333          					ФлагРежимКлапанаВакуума      = ИСПРАВНОСТЬ;
  334          					КОНЕЦ;
  335          				СЛУЧАЙ КОМ_ВХОДНАЯ_ТЕСТ_КЛАПАН_ВАКУУМА_ОТКАЗ_ВКЛЮЧЕНИЯ:
  336          					ФлагРежимКлапанаВакуума      = ОТКАЗ_ВКЛЮЧЕНИЯ;
  337          					КОНЕЦ;
  338          				СЛУЧАЙ КОМ_ВХОДНАЯ_ТЕСТ_КЛАПАН_ВАКУУМА_ОТКАЗ_ВЫКЛЮЧЕНИЯ:
  339          					ФлагРежимКлапанаВакуума      = ОТКАЗ_ВЫКЛЮЧЕНИЯ;
  340          					КОНЕЦ;	
  341          									
  342          				УМОЛЧАНИЕ:
  343          					В СОСТ НекорректноеСобытие;
  344          				КОНЕЦ;
  345          				}
  346          		}
  347          	 }
  348          	 СОСТ НекорректноеСобытие
  349          	 {
  350          		SendMsgLongParamGUI(КОМ_ВЫХОДНАЯ_ОШИБКА_КОДА_КОМАНДЫ_ОТ_ГУИ, КодСобытия_от_ГУИ);
  351          		В СОСТ Начало;
  352          	 }
  353          }
  354          
  355          ПРОЦ КОНТРОЛЬ_ДАВЛЕНИЯ_ВОЗД_ПОДУШКИ
  356          {
  357          ИЗ ПРОЦ Инициализация ФлагСостояниеДавления,
  358          					К_ВОЗД_ПОД_Р_РАБОЧЕЕ,
  359          					К_ВОЗД_ПОД_Р_НЕ_КРИТИЧЕСКОЕ;
  360          	СОСТ Начало
  361          	{ 
  362          		ЕСЛИ (ФлагСостояниеДавления == ДАВЛЕНИЕ_В_НОРМЕ)
  363          		{
  364          			SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_ДАВЛЕНИЕ_В_НОРМЕ);
  365          			В СОСТ ДавлениеВНорме;
  366          		}
  367          		ИНАЧЕ ЕСЛИ (ФлагСостояниеДавления == ДАВЛЕНИЕ_НИЗКОЕ)
  368          		{
  369          			В СОСТ ДавлениеНизкое;	
  370          			SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_ДАВЛЕНИЕ_НИЗКОЕ);
  371          		}
  372          		ИНАЧЕ ЕСЛИ (ФлагСостояниеДавления == ДАВЛЕНИЕ_АВАРИЙНОЕ)
  373          		{
  374          			В СОСТ ДавлениеАварийное;
  375          			SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_ДАВЕЛЕНИЕ_АВАРИЙНОЕ);
  376          		}			
  377          	}
  378          	СОСТ ДавлениеВНорме
  379          	{
  380          		ЕСЛИ (ФлагСостояниеДавления == ДАВЛЕНИЕ_В_НОРМЕ) 
  381          		{
  382          			К_ВОЗД_ПОД_Р_РАБОЧЕЕ = ВКЛ;
  383          			К_ВОЗД_ПОД_Р_НЕ_КРИТИЧЕСКОЕ = ВКЛ;			
  384          		}
  385          		ИНАЧЕ В СОСТ Начало;
  386          	}
  387          	СОСТ ДавлениеНизкое
  388          	{
  389          		ЕСЛИ (ФлагСостояниеДавления == ДАВЛЕНИЕ_НИЗКОЕ)
  390          		{
  391          			К_ВОЗД_ПОД_Р_РАБОЧЕЕ = ВЫКЛ;
  392          			К_ВОЗД_ПОД_Р_НЕ_КРИТИЧЕСКОЕ = ВКЛ;
  393          		}
  394          		ИНАЧЕ В СОСТ Начало;
  395          	}
  396          	СОСТ ДавлениеАварийное
  397          	{
  398          		ЕСЛИ (ФлагСостояниеДавления == ДАВЛЕНИЕ_АВАРИЙНОЕ)
  399          		{
  400          			К_ВОЗД_ПОД_Р_РАБОЧЕЕ = ВЫКЛ;
  401          			К_ВОЗД_ПОД_Р_НЕ_КРИТИЧЕСКОЕ = ВЫКЛ;			
  402          		}
  403          		ИНАЧЕ В СОСТ Начало;
  404          	}
  405          
  406          }
  407          
  408          /*ОПОРА*/
  409          ПРОЦ КонтрольПодачиВоздухаНаОпору
  410          {
  411          ИЗ ПРОЦ Инициализация ФлагРежимРаботыОпоры,
  412          		У_ВОЗД_ПОД_СТОЛА; 		
  413          	СОСТ Начало
  414          	{
  415          		СТОП ПРОЦ ВКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ОПОРУ;
  416          		СТОП ПРОЦ ВЫКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ОПОРУ;
  417          		ЕСЛИ (ФлагРежимРаботыОпоры == ИСПРАВНОСТЬ) В СОСТ ЗапускИсправногоОборудования;
  418          		ИНАЧЕ В СОСТ ИмитацияНеисправностиОборудования;
  419          	}
  420          	СОСТ ЗапускИсправногоОборудования
  421          	{
  422          		ЕСЛИ (У_ВОЗД_ПОД_СТОЛА == ВКЛ) СТАРТ ПРОЦ ВКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ОПОРУ;
  423          		ИНАЧЕ ЕСЛИ (У_ВОЗД_ПОД_СТОЛА == ВЫКЛ) СТАРТ ПРОЦ ВЫКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ОПОРУ;
  424          		В СОСТ ИсправностьРаботы;
  425          	}
  426          	СОСТ ИсправностьРаботы
  427          	{
  428          		ЕСЛИ (ФлагРежимРаботыОпоры != ИСПРАВНОСТЬ) В СОСТ Начало;
  429          	}
  430          	СОСТ ИмитацияНеисправностиОборудования
  431          	{
  432          		ЕСЛИ (ФлагРежимРаботыОпоры == ОТКАЗ_ВКЛЮЧЕНИЯ)  СТАРТ ПРОЦ ВЫКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ОПОРУ;
  433          		ИНАЧЕ ЕСЛИ (ФлагРежимРаботыОпоры == ОТКАЗ_ВЫКЛЮЧЕНИЯ) СТАРТ ПРОЦ ВКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ОПОРУ;
  434          		В СОСТ Неисправность;
  435          	}
  436          	СОСТ Неисправность
  437          	{
  438          		ЕСЛИ (ФлагРежимРаботыОпоры != ОТКАЗ_ВКЛЮЧЕНИЯ
  439          			&& ФлагРежимРаботыОпоры != ОТКАЗ_ВЫКЛЮЧЕНИЯ) В СОСТ Начало;
  440          	}	
  441          }
  442          
  443          
  444          ПРОЦ ВКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ОПОРУ
  445          {
  446          	СОСТ Начало
  447          	{
  448          		ТАЙМАУТ ТАЙМАУТ_ВОЗД_ПОДУШКИ В СЛЕДУЮЩЕЕ;
  449          	}
  450          	СОСТ ОтправкаСообщения
  451          	{
  452          		SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_ВОЗДУХ_ПОДАН_НА_ОПОРУ);
  453          		В СЛЕДУЮЩЕЕ;
  454          	}
  455          	СОСТ РаботаВоздушнойПодушкиНаОпоре 
  456          	{
  457          		ЕСЛИ ( ПРОЦ КОНТРОЛЬ_ДАВЛЕНИЯ_ВОЗД_ПОДУШКИ В СОСТ ДавлениеАварийное)
  458          		{
  459          			SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_НА_ОПОРЕ_СТОЛА_АВАРИЙНОЕ_ДАВЛЕНИЕ);
  460          			В СОСТ ОжиданиеНормльногоДавления;
  461          		}
  462          		ИНАЧЕ ЗАЦИКЛИТЬ; 
  463          	}
  464          	СОСТ ОжиданиеНормльногоДавления
  465          	{
  466          	ЕСЛИ ( !(ПРОЦ КОНТРОЛЬ_ДАВЛЕНИЯ_ВОЗД_ПОДУШКИ В СОСТ ДавлениеАварийное))
  467          		В СОСТ Начало;
  468          	}
  469          }
  470          
  471          ПРОЦ ВЫКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ОПОРУ
  472          {
  473          	СОСТ Начало
  474          	{
  475          		ТАЙМАУТ ТАЙМАУТ_ВОЗД_ПОДУШКИ В СЛЕДУЮЩЕЕ;
  476          	}
  477          	СОСТ ОтправкаСообщения
  478          	{
  479          		SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_ВЫКЛЮЧЕНА_ПОДАЧА_ВОЗДУХА_НА_ОПОРУ);
  480          		В СЛЕДУЮЩЕЕ;
  481          	}
  482          	СОСТ ВоздушнойПодушкиНаОпореНет { ЗАЦИКЛИТЬ; }
  483          }
  484          
  485          /*КАРЕТКА*/
  486          ПРОЦ КонтрольПодачиВоздухаНаКаретку
  487          {
  488          ИЗ ПРОЦ Инициализация  ФлагРежимРаботыКаретки, У_ВОЗД_ПОД_КАРЕТКИ;
  489          	СОСТ Начало
  490          	{
  491          		СТОП ПРОЦ ВКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_КАРЕТКУ;
  492          		СТОП ПРОЦ ВЫКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_КАРЕТКУ;
  493          		ЕСЛИ (ФлагРежимРаботыКаретки== ИСПРАВНОСТЬ) В СОСТ ЗапускИсправногоОборудования;
  494          		ИНАЧЕ В СОСТ ИмитацияНеисправностиОборудования;
  495          	}
  496          	СОСТ ЗапускИсправногоОборудования
  497          	{
  498          		ЕСЛИ (У_ВОЗД_ПОД_КАРЕТКИ == ВКЛ) СТАРТ ПРОЦ ВКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_КАРЕТКУ;
  499          		ИНАЧЕ ЕСЛИ (У_ВОЗД_ПОД_КАРЕТКИ == ВЫКЛ) СТАРТ ПРОЦ ВЫКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_КАРЕТКУ;
  500          		В СОСТ ИсправностьРаботы;
  501          	}
  502          	СОСТ ИсправностьРаботы
  503          	{
  504          		ЕСЛИ (ФлагРежимРаботыКаретки != ИСПРАВНОСТЬ) В СОСТ Начало;
  505          	}
  506          	СОСТ ИмитацияНеисправностиОборудования
  507          	{
  508          		ЕСЛИ (ФлагРежимРаботыКаретки == ОТКАЗ_ВКЛЮЧЕНИЯ)  СТАРТ ПРОЦ ВЫКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_КАРЕТКУ;
  509          		ИНАЧЕ ЕСЛИ (ФлагРежимРаботыКаретки == ОТКАЗ_ВЫКЛЮЧЕНИЯ) СТАРТ ПРОЦ ВКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_КАРЕТКУ;
  510          		В СОСТ Неисправность;
  511          	}
  512          	СОСТ Неисправность
  513          	{
  514          		ЕСЛИ (ФлагРежимРаботыКаретки != ОТКАЗ_ВКЛЮЧЕНИЯ 
  515          			&& ФлагРежимРаботыКаретки != ОТКАЗ_ВЫКЛЮЧЕНИЯ) В СОСТ Начало;
  516          	}	
  517          }
  518          
  519          
  520          ПРОЦ ВКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_КАРЕТКУ
  521          {
  522          	СОСТ Начало
  523          	{
  524          		ТАЙМАУТ ТАЙМАУТ_ВОЗД_ПОДУШКИ В СЛЕДУЮЩЕЕ;
  525          	}
  526          	СОСТ ОтправкаСообщения
  527          	{
  528          		SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_ВОЗДУХ_ПОДАН_НА_КАРЕТКУ);
  529          		В СЛЕДУЮЩЕЕ;
  530          	}
  531          	СОСТ РаботаВоздушнойПодушкиНаКаретке 
  532          	{
  533          		ЕСЛИ ( ПРОЦ КОНТРОЛЬ_ДАВЛЕНИЯ_ВОЗД_ПОДУШКИ В СОСТ ДавлениеАварийное)
  534          		{
  535          			SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_НА_КАРЕТКЕ_АВАРИЙНОЕ_ДАВЛЕНИЕ);
  536          			В СОСТ ОжиданиеНормльногоДавления;
  537          		}
  538          		ИНАЧЕ ЗАЦИКЛИТЬ; 
  539          	}
  540          	СОСТ ОжиданиеНормльногоДавления
  541          	{
  542          	ЕСЛИ ( !(ПРОЦ КОНТРОЛЬ_ДАВЛЕНИЯ_ВОЗД_ПОДУШКИ В СОСТ ДавлениеАварийное))
  543          		В СОСТ Начало;
  544          	}
  545          }
  546          
  547          ПРОЦ ВЫКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_КАРЕТКУ
  548          {
  549          	СОСТ Начало
  550          	{
  551          		ТАЙМАУТ ТАЙМАУТ_ВОЗД_ПОДУШКИ В СЛЕДУЮЩЕЕ;
  552          	}
  553          	СОСТ ОтправкаСообщения
  554          	{
  555          		SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_ВЫКЛЮЧЕНА_ПОДАЧА_ВОЗДУХА_НА_КАРЕТКУ);
  556          		В СЛЕДУЮЩЕЕ;
  557          	}
  558          	СОСТ ВоздушнойПодушкиНаКареткеНет { ЗАЦИКЛИТЬ; }
  559          }
  560          
  561          /*ШПИНДЕЛЬ*/
  562          ПРОЦ КонтрольПодачиВоздухаНаШпиндель
  563          {
  564          ИЗ ПРОЦ Инициализация ФлагРежимРаботыШпинделя, У_ВОЗД_ПОД_КАРЕТКИ; 
  565          	СОСТ Начало
  566          	{
  567          		СТОП ПРОЦ ВКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ШПИНДЕЛЬ;
  568          		СТОП ПРОЦ ВЫКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ШПИНДЕЛЬ;
  569          		ЕСЛИ (ФлагРежимРаботыШпинделя== ИСПРАВНОСТЬ) В СОСТ ЗапускИсправногоОборудования;
  570          		ИНАЧЕ В СОСТ ИмитацияНеисправностиОборудования;
  571          	}
  572          	СОСТ ЗапускИсправногоОборудования
  573          	{
  574          		ЕСЛИ (У_ВОЗД_ПОД_КАРЕТКИ == ВКЛ) СТАРТ ПРОЦ ВКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ШПИНДЕЛЬ;
  575          		ИНАЧЕ ЕСЛИ (У_ВОЗД_ПОД_КАРЕТКИ == ВЫКЛ) СТАРТ ПРОЦ ВЫКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ШПИНДЕЛЬ;
  576          		В СОСТ ИсправностьРаботы;
  577          	}
  578          	СОСТ ИсправностьРаботы
  579          	{
  580          		ЕСЛИ (ФлагРежимРаботыШпинделя != ИСПРАВНОСТЬ) В СОСТ Начало;
  581          	}
  582          	СОСТ ИмитацияНеисправностиОборудования
  583          	{
  584          		ЕСЛИ (ФлагРежимРаботыШпинделя == ОТКАЗ_ВКЛЮЧЕНИЯ)  СТАРТ ПРОЦ ВЫКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ШПИНДЕЛЬ;
  585          		ИНАЧЕ ЕСЛИ (ФлагРежимРаботыШпинделя == ОТКАЗ_ВЫКЛЮЧЕНИЯ) СТАРТ ПРОЦ ВКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ШПИНДЕЛЬ;
  586          		В СОСТ Неисправность;
  587          	}
  588          	СОСТ Неисправность
  589          	{
  590          		ЕСЛИ (ФлагРежимРаботыШпинделя != ОТКАЗ_ВКЛЮЧЕНИЯ 
  591          			&& ФлагРежимРаботыШпинделя != ОТКАЗ_ВЫКЛЮЧЕНИЯ) В СОСТ Начало;
  592          	}	
  593          }
  594          
  595          ПРОЦ ВКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ШПИНДЕЛЬ
  596          {
  597          	СОСТ Начало
  598          	{
  599          		ТАЙМАУТ ТАЙМАУТ_ВОЗД_ПОДУШКИ В СЛЕДУЮЩЕЕ;
  600          	}
  601          	СОСТ ОтправкаСообщений
  602          	{
  603          		SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_ВОЗДУХ_ПОДАН_НА_ШПИНДЕЛЬ);
  604          		ЕСЛИ (ПРОЦ ВКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_КАРЕТКУ В СОСТ РаботаВоздушнойПодушкиНаКаретке)
  605          			SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_ПРЕДУПРЕЖДЕНИЕ_ВОЗДУХ_ПОДАН_НА_ШПИНДЕЛЬ_НА_КАРЕТКЕ_НЕТ);
  606          		ЕСЛИ (ПРОЦ ВКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ОПОРУ В СОСТ РаботаВоздушнойПодушкиНаОпоре)
  607          			SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_ПРЕДУПРЕЖДЕНИЕ_ВОЗДУХ_ПОДАН_НА_ШПИНДЕЛЬ_НА_ОПОРЕ_НЕТ);
  608          		В СЛЕДУЮЩЕЕ;
  609          	}
  610          	СОСТ РаботаВоздушнойПодушкиНаШпнделе
  611          	{
  612          		ЕСЛИ ( ПРОЦ КОНТРОЛЬ_ДАВЛЕНИЯ_ВОЗД_ПОДУШКИ В СОСТ ДавлениеАварийное)
  613          		{
  614          			SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_НА_ШПИНДЕЛЕ_АВАРИЙНОЕ_ДАВЛЕНИЕ);
  615          			В СОСТ ОжиданиеНормльногоДавления;
  616          		}
  617          		ИНАЧЕ ЗАЦИКЛИТЬ; 
  618          	}
  619          	СОСТ ОжиданиеНормльногоДавления
  620          	{
  621          	ЕСЛИ ( !(ПРОЦ КОНТРОЛЬ_ДАВЛЕНИЯ_ВОЗД_ПОДУШКИ В СОСТ ДавлениеАварийное))
  622          		В СОСТ Начало;
  623          	}
  624          }
  625          
  626          ПРОЦ ВЫКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ШПИНДЕЛЬ
  627          {
  628          	СОСТ Начало
  629          	{
  630          		ТАЙМАУТ ТАЙМАУТ_ВОЗД_ПОДУШКИ В СЛЕДУЮЩЕЕ;
  631          	}
  632          	СОСТ ОтправкаСообщения
  633          	{
  634          		SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_ВЫКЛЮЧЕНА_ПОДАЧА_ВОЗДУХА_НА_ШПИНДЕЛЬ);
  635          		В СЛЕДУЮЩЕЕ;
  636          	}
  637          	СОСТ ВоздушнойПодушкиНаШпинделеНет { ЗАЦИКЛИТЬ; }
  638          }
  639          
  640          /*РАБОТА С ПИТАНИЕМ ЛАЗЕРА*/
  641          ПРОЦ УправлениеПитаниемЛазера
  642          {
  643          ИЗ ПРОЦ Инициализация У_ПИТАНИЕ_ЛАЗЕРА; 
  644          	СОСТ Начало
  645          	{
  646          		ЕСЛИ (У_ПИТАНИЕ_ЛАЗЕРА == ВКЛ)
  647          			{ 
  648          				SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_ПИТАНИЕ_ПОДАНО_НА_ЛАЗЕР);
  649          				В СОСТ ПитаниеПоданоНаЛазер;
  650          			}
  651          		ИНАЧЕ 
  652          		{
  653          			SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_ПИТАНИЕ_НА_ЛАЗЕРЕ_НЕТ);
  654          			В СОСТ ПитанияНаЛазереНет;
  655          		}
  656          		
  657          	}
  658          	СОСТ ПитаниеПоданоНаЛазер
  659          	{
  660          		ЕСЛИ (У_ПИТАНИЕ_ЛАЗЕРА != ВКЛ) В СОСТ Начало;
  661          	}
  662          	СОСТ ПитанияНаЛазереНет
  663          	{
  664          		ЕСЛИ (У_ПИТАНИЕ_ЛАЗЕРА != ВЫКЛ) В СОСТ Начало;
  665          	}
  666          
  667          }
  668          
  669          ПРОЦ УПРАВЛЕНИЕ_СВЕТОДИОДОМ
  670          {
  671          ИЗ ПРОЦ Инициализация ФлагРаботыСветодиода,У_ВКЛ_СВЕТОДИОДА;
  672          	СОСТ Начало
  673          	{
  674          		ЕСЛИ (ФлагРаботыСветодиода == ИСПРАВНОСТЬ )
  675          			ЕСЛИ (У_ВКЛ_СВЕТОДИОДА == ВКЛ) 
  676          			{
  677          				SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_СВЕТОДИОД_ВКЛЮЧЕН);
  678          				В СОСТ СветодиодИсправенИВключен;
  679          			}
  680          			ИНАЧЕ  
  681          			{	
  682          				SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_СВЕТОДИОД_ВЫКЛЮЧЕН);
  683          				В СОСТ СветодиодИсправенИВыключен;
  684          			}
  685          		ИНАЧЕ ЕСЛИ (ФлагРаботыСветодиода == ОТКАЗ_ВКЛЮЧЕНИЯ ) 
  686          			{
  687          				SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_СВЕТОДИОД_ОТКАЗ_ВКЛЮЧЕНИЯ);
  688          				В СОСТ СветодиодНЕИсправенИВыключен;
  689          			}
  690          		ИНАЧЕ ЕСЛИ (ФлагРаботыСветодиода == ОТКАЗ_ВЫКЛЮЧЕНИЯ)
  691          		{
  692          			SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_СВЕТОДИОД_ОТКАЗ_ВЫКЛЮЧЕНИЯ);
  693          			В СОСТ СветодиодНЕИсправенИВключен;
  694          		}
  695          	}
  696          	СОСТ СветодиодИсправенИВключен 
  697          	{
  698          		ЕСЛИ (ФлагРаботыСветодиода != ИСПРАВНОСТЬ ||  У_ВКЛ_СВЕТОДИОДА != ВКЛ) В СОСТ Начало;
  699          	}
  700          	СОСТ СветодиодИсправенИВыключен
  701          	{
  702          		ЕСЛИ (ФлагРаботыСветодиода != ИСПРАВНОСТЬ ||  У_ВКЛ_СВЕТОДИОДА != ВЫКЛ) В СОСТ Начало;
  703          	}
  704          	СОСТ СветодиодНЕИсправенИВыключен
  705          	{
  706          		ЕСЛИ (ФлагРаботыСветодиода != ОТКАЗ_ВКЛЮЧЕНИЯ ) В СОСТ Начало;
  707          	}
  708          	СОСТ СветодиодНЕИсправенИВключен
  709          	{
  710          		ЕСЛИ (ФлагРаботыСветодиода != ОТКАЗ_ВЫКЛЮЧЕНИЯ ) В СОСТ Начало;
  711          	}
  712          	
  713          }
  714          
  715          
  716          ПРОЦ УПРАВЛЕНИЕ_НАСОСОМ
  717          {
  718          ИЗ ПРОЦ Инициализация У_ВКЛ_НАСОС;
  719          	СОСТ Начало
  720          	{
  721          		ЕСЛИ (У_ВКЛ_НАСОС == ВЫКЛ)
  722          		{
  723          			SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_НАСОС_ВЫКЛЮЧЕН);
  724          			В СОСТ НасосВыключен;
  725          		}
  726          		ИНАЧЕ ЕСЛИ (У_ВКЛ_НАСОС == ВКЛ)
  727          		{
  728          			SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_КЛАПАН_НАСОС_ВКЛЮЧЕН);
  729          			В СОСТ НасосВключен;
  730          		}	
  731          	}
  732          	СОСТ НасосВыключен
  733          	{
  734          		ЕСЛИ (У_ВКЛ_НАСОС != ВЫКЛ) В СОСТ Начало;
  735          	}
  736          	СОСТ НасосВключен
  737          	{
  738          		ЕСЛИ (У_ВКЛ_НАСОС != ВКЛ) В СОСТ Начало;
  739          	}
  740          }
  741          
  742          /*КЛАПАН АТМОСФЕРЫ*/
  743          ПРОЦ КонтрольКлапанаАтмосферы
  744          {
  745          ИЗ ПРОЦ Инициализация ФлагРежимКлапанаАтмосферы, У_РАЗЖИМ_ДИСКА;
  746          	СОСТ Начало
  747          	{
  748          		СТОП ПРОЦ ОТКРЫТИЕ_КЛАПАНА_АТМОСФЕРЫ;
  749          		СТОП ПРОЦ ЗАКРЫТИЕ_КЛАПАНА_АТМОСФЕРЫ;
  750          		ЕСЛИ (ФлагРежимКлапанаАтмосферы == ИСПРАВНОСТЬ) В СОСТ ЗапускИсправногоОборудования;
  751          		ИНАЧЕ В СОСТ ИмитацияНеисправностиОборудования;
  752          	}
  753          	СОСТ ЗапускИсправногоОборудования
  754          	{
  755          		ЕСЛИ (У_РАЗЖИМ_ДИСКА == ВКЛ) СТАРТ ПРОЦ ОТКРЫТИЕ_КЛАПАНА_АТМОСФЕРЫ;
  756          		ИНАЧЕ ЕСЛИ (У_РАЗЖИМ_ДИСКА == ВЫКЛ) СТАРТ ПРОЦ ЗАКРЫТИЕ_КЛАПАНА_АТМОСФЕРЫ;
  757          		В СОСТ ИсправностьРаботы;
  758          	}
  759          	СОСТ ИсправностьРаботы
  760          	{
  761          		ЕСЛИ (ФлагРежимКлапанаАтмосферы != ИСПРАВНОСТЬ) В СОСТ Начало;
  762          	}
  763          	СОСТ ИмитацияНеисправностиОборудования
  764          	{
  765          		ЕСЛИ (ФлагРежимКлапанаАтмосферы == ОТКАЗ_ВКЛЮЧЕНИЯ)  СТАРТ ПРОЦ ЗАКРЫТИЕ_КЛАПАНА_АТМОСФЕРЫ;
  766          		ИНАЧЕ ЕСЛИ (ФлагРежимКлапанаАтмосферы == ОТКАЗ_ВЫКЛЮЧЕНИЯ) СТАРТ ПРОЦ ОТКРЫТИЕ_КЛАПАНА_АТМОСФЕРЫ;
  767          		В СОСТ Неисправность;
  768          	}
  769          	СОСТ Неисправность
  770          	{
  771          		ЕСЛИ (ФлагРежимКлапанаАтмосферы != ОТКАЗ_ВКЛЮЧЕНИЯ 
  772          			&& ФлагРежимКлапанаАтмосферы != ОТКАЗ_ВЫКЛЮЧЕНИЯ) В СОСТ Начало;
  773          	}	
  774          }
  775          
  776          
  777          ПРОЦ ОТКРЫТИЕ_КЛАПАНА_АТМОСФЕРЫ
  778          {
  779          	СОСТ Начало
  780          	{
  781          		ТАЙМАУТ ТАЙМАУТ_КЛАПАНОВ В СЛЕДУЮЩЕЕ;
  782          	}
  783          	СОСТ ОтправкаСообщения
  784          	{
  785          		SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_КЛАПАН_АТМОСФЕРЫ_ОТКРЫТ);
  786          		В СЛЕДУЮЩЕЕ;
  787          	}
  788          	СОСТ КлапанАтмосферыОткрыт 
  789          	{
  790          		ЗАЦИКЛИТЬ; 
  791          	}
  792          }
  793          
  794          ПРОЦ ЗАКРЫТИЕ_КЛАПАНА_АТМОСФЕРЫ
  795          {
  796          	СОСТ Начало
  797          	{
  798          		ТАЙМАУТ ТАЙМАУТ_КЛАПАНОВ В СЛЕДУЮЩЕЕ;
  799          	}
  800          	СОСТ ОтправкаСообщения
  801          	{
  802          		SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_КЛАПАН_АТМОСФЕРЫ_ЗАКРЫТ);
  803          		В СЛЕДУЮЩЕЕ;
  804          	}
  805          	СОСТ КлапанЗакрыт 
  806          	{ 
  807          		ЗАЦИКЛИТЬ; 
  808          	}
  809          }
  810          
  811          /*Контроль отжатияя-разжатия диска*/
  812          ПРОЦ КонтрольРазжатияЗажатияДиска
  813          {
  814          ИЗ ПРОЦ Инициализация К_ДИСК_РАЗЖАТ;
  815          	СОСТ Начало
  816          	{
  817          		ЕСЛИ (ПРОЦ ОТКРЫТИЕ_КЛАПАНА_ВАКУУМА В СОСТ КлапанВакуумаОткрыт
  818          			&& ПРОЦ ОТКРЫТИЕ_КЛАПАНА_АТМОСФЕРЫ В СОСТ КлапанАтмосферыОткрыт)
  819          		{
  820          			К_ДИСК_РАЗЖАТ = ВКЛ;
  821          			SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_ОБА_КЛАПАНА_ОТКРЫТЫ_ДИСК_РАЗАЖАТ);
  822          			В СОСТ ДискРазжатКлапанаОткрыты;
  823          		}
  824          		ИНАЧЕ ЕСЛИ (ПРОЦ ОТКРЫТИЕ_КЛАПАНА_ВАКУУМА В СОСТ КлапанВакуумаОткрыт 
  825          					&& ПРОЦ ЗАКРЫТИЕ_КЛАПАНА_АТМОСФЕРЫ В СОСТ КлапанЗакрыт)
  826          		{
  827          			ЕСЛИ (! (ПРОЦ КОНТРОЛЬ_ДАВЛЕНИЯ_ВОЗД_ПОДУШКИ В СОСТ ДавлениеАварийное)
  828          					&& ПРОЦ ВКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ШПИНДЕЛЬ В СОСТ РаботаВоздушнойПодушкиНаШпнделе)
  829          					{
  830          						К_ДИСК_РАЗЖАТ = ВЫКЛ;
  831          						SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_ВАКУУМ_ОТКРЫТ_АТМОСФЕРА_ЗАКРЫТ_ДИСК_ЗАЖАТ);
  832          						В СОСТ ДискЗажатВакуумОткрытАтмсфераЗакрыт;
  833          					}
  834          			ИНАЧЕ ЕСЛИ (ПРОЦ КОНТРОЛЬ_ДАВЛЕНИЯ_ВОЗД_ПОДУШКИ В СОСТ ДавлениеАварийное
  835          						|| ПРОЦ ВЫКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ШПИНДЕЛЬ В СОСТ ВоздушнойПодушкиНаШпинделеНет)
  836          			{
  837          				К_ДИСК_РАЗЖАТ = ВКЛ;
  838          				SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_ВАКУУМ_ОТКРЫТ_АТМОСФЕРА_ЗАКРЫТ_ДИСК_РАЗЖАТ);
  839          				В СОСТ ДискРазажатВакуумОткрытАтмсфераЗакрыт;
  840          			}			
  841          		}
  842          		ИНАЧЕ ЕСЛИ (ПРОЦ ЗАКРЫТИЕ_КЛАПАНА_ВАКУУМА В СОСТ КлапанЗакрыт 
  843          					&& ПРОЦ ОТКРЫТИЕ_КЛАПАНА_АТМОСФЕРЫ В СОСТ КлапанАтмосферыОткрыт)
  844          		{
  845          			К_ДИСК_РАЗЖАТ = ВКЛ;
  846          			SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_ВАКУУМ_ЗАКРЫТ_АТМОСФЕРА_ОТКРЫТ_ДИСК_РАЗАЖАТ);
  847          			В СОСТ ДискРазжатАтмосфераОткрытВакуумЗакрыт;
  848          		}
  849          		ИНАЧЕ ЕСЛИ ( ПРОЦ ЗАКРЫТИЕ_КЛАПАНА_АТМОСФЕРЫ В СОСТ КлапанЗакрыт 
  850          					&& ПРОЦ ЗАКРЫТИЕ_КЛАПАНА_ВАКУУМА В СОСТ КлапанЗакрыт)
  851          		{
  852          			ЕСЛИ (! (ПРОЦ КОНТРОЛЬ_ДАВЛЕНИЯ_ВОЗД_ПОДУШКИ В СОСТ ДавлениеАварийное)
  853          					&& ПРОЦ ВКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ШПИНДЕЛЬ В СОСТ РаботаВоздушнойПодушкиНаШпнделе)
  854          			{
  855          						К_ДИСК_РАЗЖАТ = ВЫКЛ;
  856          						SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_ВАКУУМ_ЗАКРЫТ_АТМОСФЕРА_ЗАКРЫТ_ДИСК_ЗАЖАТ);
  857          						В СОСТ ДискЗажатВакуумЗакрытАтмсфераЗакрыт;
  858          			}
  859          			ИНАЧЕ ЕСЛИ (ПРОЦ КОНТРОЛЬ_ДАВЛЕНИЯ_ВОЗД_ПОДУШКИ В СОСТ ДавлениеАварийное
  860          						|| ПРОЦ ВЫКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ШПИНДЕЛЬ В СОСТ ВоздушнойПодушкиНаШпинделеНет)
  861          			{
  862          				К_ДИСК_РАЗЖАТ = ВКЛ;
  863          				SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_ВАКУУМ_ЗАКРЫТ_АТМОСФЕРА_ЗАКРЫТ_ДИСК_РАЗЖАТ);
  864          				В СОСТ ДискРазажатВакуумЗакрытАтмсфераЗакрыт;
  865          			}		
  866          		}
  867          		
  868          	}
  869          	СОСТ ДискРазжатКлапанаОткрыты
  870          	{
  871          		ЕСЛИ ( !( ПРОЦ ОТКРЫТИЕ_КЛАПАНА_ВАКУУМА В СОСТ КлапанВакуумаОткрыт)
  872          		||	 !(ПРОЦ ОТКРЫТИЕ_КЛАПАНА_АТМОСФЕРЫ В СОСТ КлапанАтмосферыОткрыт))
  873          		В СОСТ Начало;
  874          	}
  875          	СОСТ ДискРазжатАтмосфераОткрытВакуумЗакрыт
  876          	{
  877          		ЕСЛИ ( !(ПРОЦ ЗАКРЫТИЕ_КЛАПАНА_ВАКУУМА В СОСТ КлапанЗакрыт)
  878          		||	 !(ПРОЦ ОТКРЫТИЕ_КЛАПАНА_АТМОСФЕРЫ В СОСТ КлапанАтмосферыОткрыт))
  879          		В СОСТ Начало;
  880          	}
  881          	СОСТ ДискЗажатВакуумОткрытАтмсфераЗакрыт
  882          	{
  883          		ЕСЛИ ( !( ПРОЦ ОТКРЫТИЕ_КЛАПАНА_ВАКУУМА В СОСТ КлапанВакуумаОткрыт) 
  884          				|| ! (ПРОЦ ЗАКРЫТИЕ_КЛАПАНА_АТМОСФЕРЫ В СОСТ КлапанЗакрыт)
  885          				|| (ПРОЦ КОНТРОЛЬ_ДАВЛЕНИЯ_ВОЗД_ПОДУШКИ В СОСТ ДавлениеАварийное)
  886          				|| ПРОЦ ВКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ШПИНДЕЛЬ В СОСТ РаботаВоздушнойПодушкиНаШпнделе)
  887          				В СОСТ Начало;
  888          	}
  889          	СОСТ ДискРазажатВакуумОткрытАтмсфераЗакрыт
  890          	{
  891          		ЕСЛИ ( !( ПРОЦ ОТКРЫТИЕ_КЛАПАНА_ВАКУУМА В СОСТ КлапанВакуумаОткрыт) 
  892          				|| ! (ПРОЦ ЗАКРЫТИЕ_КЛАПАНА_АТМОСФЕРЫ В СОСТ КлапанЗакрыт)
  893          				|| !(ПРОЦ КОНТРОЛЬ_ДАВЛЕНИЯ_ВОЗД_ПОДУШКИ В СОСТ ДавлениеАварийное)
  894          				|| !(ПРОЦ ВКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ШПИНДЕЛЬ В СОСТ РаботаВоздушнойПодушкиНаШпнделе))
  895          				В СОСТ Начало;
  896          	}
  897          	СОСТ ДискЗажатВакуумЗакрытАтмсфераЗакрыт
  898          	{
  899          		ЕСЛИ (!(ПРОЦ ЗАКРЫТИЕ_КЛАПАНА_АТМОСФЕРЫ В СОСТ КлапанЗакрыт) 
  900          				|| !( ПРОЦ ЗАКРЫТИЕ_КЛАПАНА_ВАКУУМА В СОСТ КлапанЗакрыт)
  901          				|| !(ПРОЦ ВКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ШПИНДЕЛЬ В СОСТ РаботаВоздушнойПодушкиНаШпнделе))
  902          				В СОСТ Начало;
  903          	}
  904          	СОСТ ДискРазажатВакуумЗакрытАтмсфераЗакрыт
  905          	{
  906          			ЕСЛИ (!(ПРОЦ ЗАКРЫТИЕ_КЛАПАНА_АТМОСФЕРЫ В СОСТ КлапанЗакрыт) 
  907          				|| !( ПРОЦ ЗАКРЫТИЕ_КЛАПАНА_ВАКУУМА В СОСТ КлапанЗакрыт)
  908          				|| (ПРОЦ ВКЛЮЧЕНИЕ_ПОДАЧИ_ВОЗДУХА_НА_ШПИНДЕЛЬ В СОСТ РаботаВоздушнойПодушкиНаШпнделе))
  909          				В СОСТ Начало;
  910          	}
  911          }
  912          /*КЛАПАН ВАКУУМА*/
  913          ПРОЦ КонтрольКлапанаВакуума
  914          {
  915          ИЗ ПРОЦ Инициализация ФлагРежимКлапанаВакуума, У_РАЗЖИМ_ДИСКА;
  916          	СОСТ Начало
  917          	{
  918          		СТОП ПРОЦ ОТКРЫТИЕ_КЛАПАНА_ВАКУУМА;
  919          		СТОП ПРОЦ ЗАКРЫТИЕ_КЛАПАНА_ВАКУУМА;
  920          		ЕСЛИ (ФлагРежимКлапанаВакуума == ИСПРАВНОСТЬ) В СОСТ ЗапускИсправногоОборудования;
  921          		ИНАЧЕ В СОСТ ИмитацияНеисправностиОборудования;
  922          	}
  923          	СОСТ ЗапускИсправногоОборудования
  924          	{
  925          		ЕСЛИ (У_РАЗЖИМ_ДИСКА == ВКЛ) СТАРТ ПРОЦ ОТКРЫТИЕ_КЛАПАНА_ВАКУУМА;
  926          		ИНАЧЕ ЕСЛИ (У_РАЗЖИМ_ДИСКА == ВЫКЛ) СТАРТ ПРОЦ ЗАКРЫТИЕ_КЛАПАНА_ВАКУУМА;
  927          		В СОСТ ИсправностьРаботы;
  928          	}
  929          	СОСТ ИсправностьРаботы
  930          	{
  931          		ЕСЛИ (ФлагРежимКлапанаВакуума != ИСПРАВНОСТЬ) В СОСТ Начало;
  932          	}
  933          	СОСТ ИмитацияНеисправностиОборудования
  934          	{
  935          		ЕСЛИ (ФлагРежимКлапанаВакуума == ОТКАЗ_ВКЛЮЧЕНИЯ)  СТАРТ ПРОЦ ЗАКРЫТИЕ_КЛАПАНА_ВАКУУМА;
  936          		ИНАЧЕ ЕСЛИ (ФлагРежимКлапанаВакуума == ОТКАЗ_ВЫКЛЮЧЕНИЯ) СТАРТ ПРОЦ ОТКРЫТИЕ_КЛАПАНА_ВАКУУМА;
  937          		В СОСТ Неисправность;
  938          	}
  939          	СОСТ Неисправность
  940          	{
  941          		ЕСЛИ (ФлагРежимКлапанаВакуума != ОТКАЗ_ВКЛЮЧЕНИЯ 
  942          			&& ФлагРежимКлапанаВакуума != ОТКАЗ_ВЫКЛЮЧЕНИЯ) В СОСТ Начало;
  943          	}	
  944          }
  945          
  946          
  947          ПРОЦ ОТКРЫТИЕ_КЛАПАНА_ВАКУУМА
  948          {
  949          ИЗ ПРОЦ Инициализация К_ДИСК_РАЗЖАТ;
  950          	СОСТ Начало
  951          	{
  952          		ТАЙМАУТ ТАЙМАУТ_КЛАПАНОВ В СЛЕДУЮЩЕЕ;
  953          	}
  954          	СОСТ ОтправкаСообщения
  955          	{
  956          		SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_КЛАПАН_ВАКУУМА_ОТКРЫТ);
  957          		В СЛЕДУЮЩЕЕ;
  958          	}
  959          	СОСТ КлапанВакуумаОткрыт 
  960          	{
  961          		К_ДИСК_РАЗЖАТ = ВКЛ;
  962          		ЗАЦИКЛИТЬ; 
  963          	}
  964          }
  965          
  966          ПРОЦ ЗАКРЫТИЕ_КЛАПАНА_ВАКУУМА
  967          {
  968          ИЗ ПРОЦ Инициализация К_ДИСК_РАЗЖАТ;
  969          	СОСТ Начало
  970          	{
  971          		ТАЙМАУТ ТАЙМАУТ_КЛАПАНОВ В СЛЕДУЮЩЕЕ;
  972          	}
  973          	СОСТ ОтправкаСообщения
  974          	{
  975          		SendMsgGUICode(КОМ_ВЫХОДНАЯ_ТЕСТ_КЛАПАН_ВАКУУМА_ЗАКРЫТ);
  976          		В СЛЕДУЮЩЕЕ;
  977          	}
  978          	СОСТ КлапанЗакрыт 
  979          	{ 
  980          		К_ДИСК_РАЗЖАТ = ВКЛ;
  981          		ЗАЦИКЛИТЬ; 
  982          	}
  983          }
  984          
  985          }

%RCSL-I-SUMMARY, Completed with 0 error(s).
%RCSL-I-SUMMARY, Completed with 0 warning(s).

 %RCSL-I-SUMMARY, Completed with 0 error(s).