    1          /*===== ПРОГРАММА УПРАВЛЕНИЯ УГЛОИЗМЕРИТЕЛЬНОЙ МАШИНОЙ НОНИУС ====*/
    2          /*===== ДАТА СОЗДАНИЯ: 09 октября 2015 г ====*/
    3          /*===== АВТОРЫ:
    4          /*=====     Зюбин В. Е.
    5          /*=====		Лях Т. В.
    6          /*=====		Петухов А. Д.
    7          /*
    8                                                         _
    9             Ш   Ш   ШШШ   Ш   Ш  Ш    Ш  Ш   Ш   ШШШ   
   10             Ш   Ш  Ш   Ш  Ш   Ш  Ш    Ш  Ш   Ш  Ш   Ш  
   11             ШШШшш  Ш   Ш  ШШШШШ  Ш  Ш Ш   ШШШШ  Ш   
   12             Ш   Ш  Ш   Ш  Ш   Ш  Ш Ш  Ш      Ш  Ш   Ш  
   13             Ш   Ш   ШШШ   Ш   Ш  Ш    Ш  ШШШШ    ШШШ   
   14          АННОТАЦИЯ ПРОГРАММЫ:
   15          
   16          ИСТОРИЯ РЕДАКТИРОВАНИЯ ПРОГРАММЫ:
   17          09.10.15 Начало
   18          
   19          */
   20          
   21          Прогр Нониус {
   22          /*=========================================================================*/
   23          /*=========================================================================*/
   24          /*========================== КОНСТАНТЫ И СООБЩЕНИЯ ========================*/
   25          /*=========================================================================*/
   26          /*=========================================================================*/
   27          /*###########################################################*/
   28          /*#########                     #############################*/
   29          /*#########  ОПИСАНИЕ КОНСТАНТ  #############################*/
   30          /*#########                     #############################*/
   31          /*###########################################################*/
   32          ТАКТ     50;    /* такт равен 500 миллисекундам */
   33          КОНСТ ОДНА_СЕКУНДА               10;  /* Константа обеспечивающая паузу в 1 сек */
   34          /* вызов рефлексовской программ 10 раз в секунду  */
   35          /* если в программе определена константа 1 сек = 2. это говорит о том, что вызов программы */
   36          /* рефлексовской производиться будет 2 раза в секунду. */
   37          /* Если поставит 4, то четыре раза в секунду. Тогда счет секунд в рефлексе будет верным.*/
   38          КОНСТ ДВЕ_СЕКУНДЫ             2*ОДНА_СЕКУНДА;
   39          КОНСТ ТРИ_СЕКУНДЫ             3*ОДНА_СЕКУНДА;
   40          КОНСТ ПЯТЬ_СЕКУНД             5*ОДНА_СЕКУНДА;
   41          КОНСТ ДЕСЯТЬ_СЕКУНД          10*ОДНА_СЕКУНДА;
   42          КОНСТ ДВАДЦАТЬ_СЕКУНД        20*ОДНА_СЕКУНДА;
   43          КОНСТ ТРИДЦАТЬ_СЕКУНД        30*ОДНА_СЕКУНДА;
   44          КОНСТ ОДНА_МИНУТА            60*ОДНА_СЕКУНДА;
   45          КОНСТ ДВЕ_МИНУТЫ             2*ОДНА_МИНУТА;
   46          КОНСТ ПЯТЬ_МИНУТ             5*60*ОДНА_СЕКУНДА;
   47          КОНСТ ДЕСЯТЬ_МИНУТ			 10*ОДНА_МИНУТА;
   48          КОНСТ ПЯТНАДЦАТЬ_МИНУТ       15*ОДНА_МИНУТА;
   49          КОНСТ ТРИДЦАТЬ_МИНУТ         30*ОДНА_МИНУТА;
   50          
   51          КОНСТ ТАЙМАУТ_ВОЗД_ПОДУШКИ		ТРИ_СЕКУНДЫ /*ДВАДЦАТЬ_СЕКУНД*/ ;
   52          КОНСТ ТАЙМАУТ_НАСОСА_ВАКУУМНОГО	ДВАДЦАТЬ_СЕКУНД;
   53          КОНСТ ТАЙМАУТ_ЗАЖИМА_ДИСКА		ДВАДЦАТЬ_СЕКУНД;
   54          КОНСТ ТАЙМАУТ_РАЗЖИМА_ДИСКА		ДВАДЦАТЬ_СЕКУНД;
   55          
   56          КОНСТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_КЛАПАНА_КАРЕТКИ          	ТРИ_СЕКУНДЫ;   /*+ */
   57          КОНСТ ТАЙМАУТ_НА_СРАБАТЫВАНИЕ_КЛАПАНА_ШПИНДЕЛЯ_Д       	ТРИ_СЕКУНДЫ;   /*+*/
   58          
   59          КОНСТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО  ДЕСЯТЬ_СЕКУНД;
   60          
   61          КОНСТ ВКЛ                1;
   62          КОНСТ ВЫК               0;
   63          КОНСТ ВЫКЛ               0;
   64          КОНСТ ОТКР              1;
   65          КОНСТ ЗАКР          	0;
   66          КОНСТ ЕСТЬ               1;
   67          КОНСТ НЕТ                0;
   68          КОНСТ НИ_ДА_НИ_НЕТ       2;
   69          
   70          
   71          /*===========================================================*/
   72          /*========= ДИАПАЗОН ИЗМЕНЕНИЯ ЗАДАНИЙ            ===========*/
   73          /*===========================================================*/
   74          КОНСТ МИНИМАЛЬНОЕ_ЗАДАНИЕ_R_КАРЕТКИ            0.0;   /* мм  */ 
   75          КОНСТ МАКСИМАЛЬНОЕ_ЗАДАНИЕ_R_КАРЕТКИ        200.0;    /* мм  */
   76          
   77          КОНСТ МИНИМАЛЬНОЕ_ЗАДАНИЕ_W_ПРЕДМЕТНОГО_СТОЛИКА            0.0;   /* ??????  */ 
   78          КОНСТ МАКСИМАЛЬНОЕ_ЗАДАНИЕ_W_ПРЕДМЕТНОГО_СТОЛИКА        200.0;    /* ?????  */ 
   79          
   80          /*===========================================================*/
   81          /*===========================================================*/
   82          /*========= КОДЫ КОМАНД ПОСТУПАЮЩИЕ ОТ GUI ==================*/
   83          /*===========================================================*/
   84          /*===========================================================*/
   85          
   86          /*===========================================================*/
   87          /*========= РЕЖИМЫ РАБОТЫ			 ========================*/
   88          /*===========================================================*/
   89          ПЕРЕЧИСЛЕНИЕ {
   90              РЕЖИМ_ИНИЦИАЛИЗАЦИИ = 1,
   91              РЕЖИМ_РР,
   92              РЕЖИМ_ОТМЕНА        ,
   93              РЕЖИМ_КОНЕЦ_РАБОТЫ,  
   94          	КОНЕЦ_КОДОВ_РЕЖИМОВ       
   95          };
   96          
   97          /*=========================================================*/
   98          /*========= КОМАНДЫ ОТ ГИО (граф. интерф. оператора) ======*/
   99          /*=========================================================*/
  100          ПЕРЕЧИСЛЕНИЕ {
  101              ГИО2СУАБ_РЕЖИМ_ОТМЕНА = КОНЕЦ_КОДОВ_РЕЖИМОВ,
  102              ГИО2СУАБ_РЕЖИМ_КОНЕЦ_РАБОТЫ,  
  103          	ГИО2СУАБ_ЗАЖАТЬ_ДИСК , /* сквозная нумерация */
  104          	ГИО2СУАБ_РАЗЖАТЬ_ДИСК,
  105          	ГИО2СУАБ_КО_ИСПРАВНОСТЬ_ВОЗДУШНЫХ_ПОДУШЕК,
  106          	ГИО2СУАБ_ОТКАЗ_ВОЗДУШНЫХ_ПОДУШЕК,
  107          	ГИО2СУАБ_КАРЕТКУ_В_ПОЛОЖЕНИЕ_УСТАНОВКИ_ДИСКА,
  108             	ГИО2СУАБ_КАРЕТКУ_В_ЦЕНТР_ВРАЩЕНИЯ,
  109          	ГИО2СУАБ_КАРЕТКУ_В_ЗАДАННЫЙ_РАДИУС,
  110          	ГИО2СУАБ_СТОП_КАРЕТКИ,
  111          	ГИО2СУАБ_ВКЛ_АКТИВНОЕ_ПОЗИЦИОНИРОВАНИЕ_ПО_ВРАЩЕНИЮ,
  112          	ГИО2СУАБ_ВЫКЛ_АКТИВНОЕ_ПОЗИЦИОНИРОВАНИЕ_ПО_ВРАЩЕНИЮ,
  113          	ГИО2СУАБ_ВКЛ_ВРАЩЕНИЕ_ПРЕД_СТОЛИКА_В_ЗД_W,  
  114          	ГИО2СУАБ_СТОП_ВРАЩЕНИЯ_ПРЕДМЕТНОГО_СТОЛИКА,
  115          	ГИО2СУАБ_ВКЛ_ПОДСВЕТКУ_ДИСКА,  
  116          	ГИО2СУАБ_ВЫКЛ_ПОДСВЕТКУ_ДИСКА,
  117          	
  118          	ФИК2СУАБ_ЕСТЬ_СВЯЗЬ_С_МОХА1212,
  119          	ФИК2СУАБ_НЕТ_СВЯЗИ_С_МОХА1212,
  120          	ФИК2СУАБ_ЕСТЬ_СВЯЗЬ_С_МОХА1214,
  121          	ФИК2СУАБ_НЕТ_СВЯЗИ_С_МОХА1214,
  122          
  123          /*========= КОДЫ КОМАНД ИЗМЕНЕНИЯ ЗАДАНИЯ ===================*/
  124          	ГИО2СУАБ_ИЗМН_ЗД_R_КАРЕТКИ,
  125              ГИО2СУАБ_ИЗМН_ЗД_W_ПРЕДМЕТНОГО_СТОЛИКА,	
  126          	ГИО2СУАБ_КОНЕЦ_КОДОВ_ФИК	
  127          	
  128          };
  129          
  130          /*===========================================================*/
  131          /*=== КОДЫ СООБЩЕНИЙ ПРОЦЕССОВ ОТ СУАБ К ФИК                =*/
  132          /*===========================================================*/
  133          ПЕРЕЧИСЛЕНИЕ {
  134          	
  135          	СУАБ2ФИК_ДАВЛЕНИЕ_В_НОРМЕ = 0,
  136          	СУАБ2ФИК_ДАВЛЕНИЕ_НИЖЕ_НОРМЫ,
  137          	СУАБ2ФИК_ДАВЛЕНИЕ_АВАРИЙНОЕ,
  138          	
  139          	СУАБ2ФИК_ПРОВЕРЬ_ВОЗДУШНУЮ_ПОДУШКУ,
  140          	СУАБ2ФИК_БЛОКИРОВКА_КОМАНД_ПЕРЕМЕЩЕНИЯ,
  141          	СУАБ2ФИК_РАЗБЛОКИРОВКА_КОМАНД_ПЕРЕМЕЩЕНИЯ,
  142          	СУАБ2ФИК_ИЗМН_ЗД_R_КАРЕТКИ,
  143          	СУАБ2ФИК_ИЗМН_ЗД_W_ПРЕДМЕТНОГО_СТОЛИКА,
  144          
  145          	/* сообщения о положении технических средств */
  146          	СУАБ2ФИК_ДИСК_ЗАЖАТ,
  147          	СУАБ2ФИК_ДИСК_РАЗЖАТ,
  148          	СУАБ2ФИК_АВАРИЙНОЕ_РАЗЖАТИЕ_ДИСКА,
  149          	СУАБ2ФИК_ОТКАЗ_ЗАЖИМА_ДИСКА,
  150          	СУАБ2ФИК_ОТКАЗ_РАЗЖИМА_ДИСКА,
  151          	СУАБ2ФИК_ОСВЕЩЕНИЕ_ДИСКА_ВКЛЮЧЕНО,
  152          	СУАБ2ФИК_ОСВЕЩЕНИЕ_ДИСКА_ВЫКЛЮЧЕНО,
  153          	
  154          	
  155          	СУАБ2ФИК_ЕСТЬ_СВЯЗЬ_С_МОХА1212,
  156          	СУАБ2ФИК_НЕТ_СВЯЗИ_С_МОХА1212,
  157          	СУАБ2ФИК_ЕСТЬ_СВЯЗЬ_С_МОХА1214,
  158          	СУАБ2ФИК_НЕТ_СВЯЗИ_С_МОХА1214,
  159          	
  160          	СУАБ2ФИК_ЕСТЬ_ДИСТАНЦИОННОЕ_УПРАВЛЕНИЕ_1212,
  161          	СУАБ2ФИК_НЕТ_ДИСТАНЦИОННОГО_УПРАВЛЕНИЯ_1212,
  162          	СУАБ2ФИК_ЕСТЬ_ДИСТАНЦИОННОЕ_УПРАВЛЕНИЕ_1214,
  163          	СУАБ2ФИК_НЕТ_ДИСТАНЦИОННОГО_УПРАВЛЕНИЯ_1214,
  164          	СУАБ2ФИК_РЕЖИМ_ИНИЦИАЛИЗАЦИЯ,
  165          	СУАБ2ФИК_РЕЖИМ_РР,
  166          	СУАБ2ФИК_РЕЖИМ_ОТМЕНА,
  167          	СУАБ2ФИК_РЕЖИМ_КОНЕЦ_РАБОТЫ,
  168          	СУАБ2ФИК_УСТАНОВКА_ГОТОВА_К_ВЫКЛЮЧЕНИЮ,
  169          	СУАБ2ФИК_КОНЕЦ_КОДОВ_СПК 
  170          };	
  171          
  172          
  173          /*==========================================================*/
  174          /*====КОДЫ СООБЩЕНИЙ ОБ ИЗМЕНЕНИИ ФАКТИЧЕСКИХ ПАРАМЕТРОВ ========*/
  175          /*===========================================================*/
  176          ПЕРЕЧИСЛЕНИЕ {
  177          	СУАБ2ФИК_ИЗМН_ФП_R_КАРЕТКИ = СУАБ2ФИК_КОНЕЦ_КОДОВ_СПК + 1,
  178          	СУАБ2ФИК_ИЗМН_ФП_W_ПРЕДМЕТНОГО_СТОЛИКА,
  179          	КОМАНДЫ_ИЗМ_ФП = СУАБ2ФИК_ИЗМН_ФП_W_ПРЕДМЕТНОГО_СТОЛИКА 	
  180          };
  181          
  182          /*=====================================================*/
  183          /*=== КОДЫ СООБЩЕНИЙ ОБ ИЗМЕНЕНИИИ ЗАДАНИЙ  ===========*/
  184          /*=====================================================*/
  185          
  186          ПЕРЕЧИСЛЕНИЕ {
  187          	СУАБ2ФИК_ЗД_R_КАРЕТКИ_ВНЕ_ДИАПАЗОНА = КОМАНДЫ_ИЗМ_ФП + 1,
  188          	СУАБ2ФИК_ЗД_W_ПРЕДМЕТНОГО_СТОЛИКА_ВНЕ_ДИАПАЗОНА
  189          };
  190          
  191          ПЕРЕЧИСЛЕНИЕ {                    
  192             
  193          	
  194          	СУАБ2ФИК_ВКЛЮЧИТЕ_КОМПРЕССОР = СУАБ2ФИК_ЗД_W_ПРЕДМЕТНОГО_СТОЛИКА_ВНЕ_ДИАПАЗОНА +1
  195          
  196          };	
  197          
  198          
  199          /*===========================================================*/
  200          /*= КОДЫ КОМАНД ИЗМЕНЕНИЯ НАСТРОЕЧНЫХ ПАРАМЕТРОВ   ???????????==========*/
  201          /*===========================================================*/
  202          ПЕРЕЧИСЛЕНИЕ { 
  203          	ИЗМН_НП_1 = СУАБ2ФИК_ВКЛЮЧИТЕ_КОМПРЕССОР + 1,
  204          	ИЗМН_НП_N
  205          };
  206          /*===========================================================*/
  207          /*========= КОДЫ СООБЩЕНИЙ  О НЕВЕРНОЙ КОМАНДЕ ==============*/
  208          /*===========================================================*/
  209          
  210          
  211          ПЕРЕЧИСЛЕНИЕ {
  212              СУАБ2ФИК_ОШИБКА_КОДА_КОМАНДЫ_ОТ_ГИО = ИЗМН_НП_N + 1,
  213          	СУАБ2ФИК_ОШИБКА_ЗАПРЕЩЕННАЯ_КОМАНДА_РЕЖИМА_РР,
  214          	СУАБ2ФИК_ОШИБКА_ЗАПРЕЩЕННАЯ_КОМАНДА_РЕЖИМА_ИНИЦИАЛИЗАЦИИ	 
  215          	 
  216          }; 
  217          
  218          /*=========================================================================*/
  219          /*=========================================================================*/
  220          /*========================== ФУНКЦИИ ======================================*/
  221          /*=========================================================================*/
  222          /*=========================================================================*/
  223          /*:::::::::Функции для работы  с ГИО :::::::::::::::::::::   */
  224          
  225          /*чтение кода и параметра события от ПИВ из кольцевого буфера в память */
  226          ФУНКЦИЯ ЦЕЛ GetNextMsgGUI(ПУСТО);
  227          ФУНКЦИЯ ЦЕЛ  GetMsgGUICode        		(ПУСТО);  /*чтение из памяти кода события */
  228          ФУНКЦИЯ ПЛАВ GetFloatParamGUI     		(ПУСТО);  /*чтение из памяти параметра события */
  229          ФУНКЦИЯ ЦЕЛ  SendMsgLongParamGUI  		(ЦЕЛ, ДЦЕЛ);
  230          ФУНКЦИЯ ДЦЕЛ GetLongParamGUI      		(ПУСТО);  
  231          ФУНКЦИЯ ЦЕЛ  SendMsgGUICode       		(ЦЕЛ);
  232          ФУНКЦИЯ ЦЕЛ  SendMsgFloatParamGUI       (ЦЕЛ, ПЛАВ);
  233          
  234          /*=========================================================================*/
  235          /*=========================================================================*/
  236          /*========================== ПОРТЫ ВВОДА-ВЫВОДА ===========================*/
  237          /*=========================================================================*/
  238          /*=========================================================================*/
  239          ВХОД  ВХОД_МОХА_1214_ДАВЛ_ВАКУУМ  			0 0 8; 
  240          ВХОД  ВХОД_МОХА_1212_ЛАЗЕР		  			0 1 8; 
  241          ВЫХОД ВЫХОД_МОХА_1214_ДАВЛ_ВАКУУМ		  	1 0 8; 
  242          ВЫХОД ВЫХОД_МОХА_1212_ЛАЗЕР		  			1 1 8; 
  243          
  244          
  245          /*=========================================================================*/
  246          /*=========================================================================*/
  247          /*========================== ПРОЦЕССЫ =====================================*/
  248          /*=========================================================================*/
  249          /*=========================================================================*/
  250          /*
  251          / * Процесс Инициализация. Служит для
  252          /* развертывания программы. Этот процесс (описанный
  253          /* первым) - единственно активный процесс по запуску.
  254          /* Кроме этого, процесс Инициализация содержит описание 
  255          /* переменных для ссылок из других
  256          /* процессов. Это удобно: описания локализованы в одном
  257          /* месте.
  258          */
  259          ПРОЦ Инициализация{
  260          /*===========================================================*/
  261          /*=========== ОПИСАНИЕ ПЕРЕМЕННЫХ ===========================*/
  262          /*===========================================================*/
  263          
  264          /*=========== МОХА 1214 (ДАВЛЕНИЕ И ВАКУУМ) =======*/
  265          /* ВЫХОДНЫЕ СИГНАЛЫ 1214 "ВОЗД_ПОД" -- воздушная подушка, "ЛУ" -- локальное управление */
  266          ЛОГ У_ВОЗД_ПОД_КАРЕТКИ			= {ВЫХОД_МОХА_1214_ДАВЛ_ВАКУУМ[1]} ДЛЯ ВСЕХ; 	/* К1 */
  267          ЛОГ У_ВОЗД_ПОД_ШПИНДЕЛЯ			= {ВЫХОД_МОХА_1214_ДАВЛ_ВАКУУМ[1]} ДЛЯ ВСЕХ;	/* К2 */
  268          ЛОГ У_ВОЗД_ПОД_СТОЛА			= {ВЫХОД_МОХА_1214_ДАВЛ_ВАКУУМ[1]} ДЛЯ ВСЕХ;	/* К3 */  /* ноги*/
  269          ЛОГ У_ЗАЖИМ_ДИСКА				= {ВЫХОД_МОХА_1214_ДАВЛ_ВАКУУМ[1]} ДЛЯ ВСЕХ;	/* К4 */   /* клапан натекания вакуума*/
  270          ЛОГ У_ВКЛ_НАСОС					= {ВЫХОД_МОХА_1214_ДАВЛ_ВАКУУМ[1]} ДЛЯ ВСЕХ;	/* питание насоса */ 
  271          ЛОГ У_РАЗЖИМ_ДИСКА				= {ВЫХОД_МОХА_1214_ДАВЛ_ВАКУУМ[1]} ДЛЯ ВСЕХ;	/* К5 */  /* клапан атмосферы */  
  272          
  273          /* ВХОДНЫЕ ДАВЛЕНИЕ И ВАКУУМ */  
  274          ЛОГ К_ВОЗД_ПОД_Р_НЕ_КРИТИЧЕСКОЕ		= {ВХОД_МОХА_1214_ДАВЛ_ВАКУУМ[1]} ДЛЯ ВСЕХ;	/*вход МОХИ  	0*/  
  275          ЛОГ К_ВОЗД_ПОД_Р_РАБОЧЕЕ			= {ВХОД_МОХА_1214_ДАВЛ_ВАКУУМ[1]} ДЛЯ ВСЕХ;	/*вход МОХИ  	1*/ 
  276          ЛОГ К_ДИСК_РАЗЖАТ					= {ВХОД_МОХА_1214_ДАВЛ_ВАКУУМ[1]} ДЛЯ ВСЕХ; /*вход МОХИ  	2*/     /* если 0, то вакуум есть */ /* норма*/
  277          ЛОГ К_1214_ДИСТАНЦИОННОЕ			= {ВХОД_МОХА_1214_ДАВЛ_ВАКУУМ[1]} ДЛЯ ВСЕХ; /*вход МОХИ  	3*/		/* true - от программы, означает, что все  278           управление false на оборудовании*/
  279          /* ЛОГ К_ВОЗДУШНОЙ_ПОДУШКИ_ШПИНДЕЛЯ	= {ВХОД_МОХА_1214_ДАВЛ_ВАКУУМ[1]} ДЛЯ ВСЕХ; /*вход МОХИ  	4*/
  280          /* ЛОГ К_ДАВЛЕНИЕ_НА_КАРЕТКЕ			= {ВХОД_МОХА_1214_ДАВЛ_ВАКУУМ[1]} ДЛЯ ВСЕХ; /*вход МОХИ  	5*/
  281          
  282          
  283          /*=========== МОХА 1212 =======*/
  284          /* ВЫХОДНЫЕ СИГНАЛЫ 1212 "ВОЗД_ПОД" -- воздушная подушка, "ЛУ" -- локальное управление */
  285          ЛОГ У_ПИТАНИЕ_ЛАЗЕРА				= {ВЫХОД_МОХА_1212_ЛАЗЕР[1]} ДЛЯ ВСЕХ; /*выход МОХИ  0*/
  286          ЛОГ У_ВКЛ_ЛАЗЕРА					= {ВЫХОД_МОХА_1212_ЛАЗЕР[1]} ДЛЯ ВСЕХ; /*выход МОХИ  1*/
  287          ЛОГ У_ИНТЕНСИВНОСТЬ_ЛАЗЕРА			= {ВЫХОД_МОХА_1212_ЛАЗЕР[1]} ДЛЯ ВСЕХ;  /*выход МОХИ 2*/	/*МОДУЛЯТОР_ЛАЗЕРА*/
  288          ЛОГ У_ВКЛ_СВЕТОДИОДА				= {ВЫХОД_МОХА_1212_ЛАЗЕР[1]} ДЛЯ ВСЕХ;  /*освещение диска*/
  289          ЛОГ У_ВЫКЛ_СВЕТОДИОДА				= {ВЫХОД_МОХА_1212_ЛАЗЕР[1]} ДЛЯ ВСЕХ; /*освещение диска*/
  290          
  291          
  292          /*-----от  ЖЕЛЕЗА --ЛАЗЕР---------*/	/* читаются входы с железа через МОХУ функцией inputf2  */
  293          ЛОГ К_1212_ДИСТАНЦИОННОЕ				= {ВХОД_МОХА_1212_ЛАЗЕР[1]} ДЛЯ ВСЕХ;	/*вход МОХИ  	0*/
  294          ЛОГ К_ИНТЕНСИВНОСТЬ_ЛАЗЕРА				= {ВХОД_МОХА_1212_ЛАЗЕР[1]} ДЛЯ ВСЕХ;	/*вход МОХИ  	1*/ /* Перебейнос думает о значении сигнала */
  295          
  296          
  297          															/* записываются в МОХУ функцией outf15*/
  298          													
  299          															
  300          /*===========================================================*/
  301          /*=========== ЯЧЕЙКИ ОБЩЕГО УПРАВЛЕНИЯ ======================*/
  302          /*===========================================================*/
  303          ЦЕЛ ТекущийРежим          ДЛЯ ВСЕХ;
  304          
  305          
  306          
  307          /*===========================================================*/
  308          /*=========== ЯЧЕЙКИ ИНФОРМАЦИОННЫХ КАНАЛОВ =================*/
  309          /*===========================================================*/
  310          ЦЕЛ КодСобытия_от_ГИO        ДЛЯ ВСЕХ;
  311          ЦЕЛ КодСобытия_к_ГИO         ДЛЯ ВСЕХ;
  312          
  313          /*===========================================================*/
  314          /*=========== ЯЧЕЙКИ ФАКТИЧЕСКИХ ЗНАЧЕНИЙ ===================*/
  315          /*===========================================================*/
  316          ПЛАВ   	ЗД_R_КАРЕТКИ			ДЛЯ ВСЕХ;
  317          ПЛАВ 	ЗД_W_ПРЕДМЕТНОГО_СТОЛИКА	ДЛЯ ВСЕХ;
  318          
  319          ПЛАВ   	ФП_R_КАРЕТКИ			ДЛЯ ВСЕХ;
  320          ПЛАВ 	ФП_W_ПРЕДМЕТНОГО_СТОЛИКА	ДЛЯ ВСЕХ;
  321          
  322          ЛОГ ФлагКонтроляВоздушнойПодушки    ДЛЯ ВСЕХ;
  323          ЛОГ ФлагСвязиМоха1212			 	ДЛЯ ВСЕХ;
  324          ЛОГ ФлагСвязиМоха1214			 	ДЛЯ ВСЕХ;
  325          
  326           СОСТ Начало{
  327          	ФлагСвязиМоха1212 = НИ_ДА_НИ_НЕТ;
  328          	ФлагСвязиМоха1214 = НИ_ДА_НИ_НЕТ;
  329           
  330          	СТАРТ ПРОЦ ВКЛ_ВОЗД_ПОДУШКУ;
  331          	СТАРТ ПРОЦ ИНИЦИАЛИЗАЦИЯ_ЛАЗЕРА;
  332          	СТАРТ ПРОЦ ВКЛ_НАСОС;
  333          /*	СТАРТ ПРОЦ ИНИЦИАЛИЗАЦИЯ_ПРИВОДОВ;
  334          */
  335          	СТАРТ ПРОЦ Режим_ИНИЦИАЛИЗАЦИЯ;
  336          	ТекущийРежим = РЕЖИМ_ИНИЦИАЛИЗАЦИИ;
  337              В СЛЕДУЮЩЕЕ;
  338           }
  339           СОСТ КонтрольКонцаИнициализации{ 
  340          	ЕСЛИ (
  341          		(ПРОЦ ВКЛ_ВОЗД_ПОДУШКУ В СОСТ ПАССИВНОЕ) &&
  342          		(ПРОЦ ВКЛ_НАСОС В СОСТ ПАССИВНОЕ) &&
  343          		(ПРОЦ ИНИЦИАЛИЗАЦИЯ_ЛАЗЕРА В СОСТ ПАССИВНОЕ) &&
  344          		(ПРОЦ ИНИЦИАЛИЗАЦИЯ_ПРИВОДОВ В СОСТ ПАССИВНОЕ)) {
  345          		ЕСЛИ (
  346          			(ПРОЦ ВКЛ_ВОЗД_ПОДУШКУ В СОСТ СТОП) &&
  347          			(ПРОЦ ВКЛ_НАСОС В СОСТ СТОП) &&
  348          			(ПРОЦ ИНИЦИАЛИЗАЦИЯ_ЛАЗЕРА В СОСТ СТОП) &&
  349          			(ПРОЦ ИНИЦИАЛИЗАЦИЯ_ПРИВОДОВ В СОСТ СТОП)) {
  350          				ТекущийРежим = РЕЖИМ_РР;
  351          				СТОП ПРОЦ Режим_ИНИЦИАЛИЗАЦИЯ;
  352          
  353          				СТАРТ ПРОЦ Режим_РР;
  354          				СТАРТ ПРОЦ КонтрольВакуума;
  355          				СТАРТ ПРОЦ КонтрольДавления;
  356          				СТАРТ ПРОЦ КонтрольСвязи_сМОХА1212;
  357          				СТАРТ ПРОЦ КонтрольСвязи_сМОХА1214;
  358          				СТАРТ ПРОЦ КонтрольДистанционного1212;
  359          				СТАРТ ПРОЦ КонтрольДистанционного1214;
  360          				СТАРТ ПРОЦ КонтрольИзмененияЗаданий_ЗД_R_КАРЕТКИ;
  361          				СТАРТ ПРОЦ КонтрольИзмененияЗаданий_ЗД_W_ПРЕДМЕТНОГО_СТОЛИКА;
  362          				СТАРТ ПРОЦ КонтрольИзменения_ФП_R_КАРЕТКИ;
  363          				СТАРТ ПРОЦ КонтрольИзменения_ФП_W_ПРЕДМЕТНОГО_СТОЛИКА;
  364          				СТОП;
  365          	    } ИНАЧЕ {
  366          			ОШИБКА;		
  367          		}
  368          	}
  369           }
  370          
  371          } /* конец ПРОЦ Инициализация*/  
  372          
  373          
  374          /*==============================================*/
  375          /*==============================================*/
  376          /*=                                            =*/
  377          /*=         РЕЖИМ НАЧАЛЬНАЯ ИНИЦИАЛИЗАЦИЯ      =*/
  378          /*=                                            =*/
  379          /*==============================================*/
  380          /*==============================================*/
  381          ПРОЦ Режим_ИНИЦИАЛИЗАЦИЯ{
  382          ИЗ ПРОЦ Инициализация 	КодСобытия_от_ГИO,
  383          						ФлагКонтроляВоздушнойПодушки,
  384          						ТекущийРежим;
  385          
  386           СОСТ Начало{
  387              ТекущийРежим = РЕЖИМ_ИНИЦИАЛИЗАЦИИ;
  388          	СТАРТ ПРОЦ КонтрольРежимов;
  389              В СЛЕДУЮЩЕЕ;
  390           }
  391               /*  читаем код и параметр события из кольцевого буфера в структуру */
  392           СОСТ ЧтениеКольцевогоБуфера{
  393              ЕСЛИ (GetNextMsgGUI()) {
  394          		КодСобытия_от_ГИO = GetMsgGUICode(); 
  395          		РАЗБОР (КодСобытия_от_ГИO) {
  396          			СЛУЧАЙ ГИО2СУАБ_РЕЖИМ_ОТМЕНА:
  397          				СТАРТ ПРОЦ ОТМЕНА;
  398          				КОНЕЦ;			
  399          			СЛУЧАЙ ГИО2СУАБ_РЕЖИМ_КОНЕЦ_РАБОТЫ:
  400          				СТАРТ ПРОЦ КОНЕЦ_РАБОТЫ;
  401          				КОНЕЦ;
  402          			СЛУЧАЙ ГИО2СУАБ_КО_ИСПРАВНОСТЬ_ВОЗДУШНЫХ_ПОДУШЕК:
  403          				ФлагКонтроляВоздушнойПодушки = ВКЛ;
  404          				СТАРТ ПРОЦ РАЗБЛОКИРОВКА_КОМАНД_ПЕРЕМЕЩЕНИЯ;
  405          				КОНЕЦ;
  406          			СЛУЧАЙ ГИО2СУАБ_ОТКАЗ_ВОЗДУШНЫХ_ПОДУШЕК:
  407          				ФлагКонтроляВоздушнойПодушки = ВЫКЛ;
  408          				СТАРТ ПРОЦ БЛОКИРОВКА_КОМАНД_ПЕРЕМЕЩЕНИЯ;
  409          				КОНЕЦ;
  410          			УМОЛЧАНИЕ:
  411          				ЕСЛИ ((КодСобытия_от_ГИO >= ГИО2СУАБ_ЗАЖАТЬ_ДИСК) &&
  412          					(КодСобытия_от_ГИO <= ГИО2СУАБ_КОНЕЦ_КОДОВ_ФИК)) {
  413          						В СОСТ ЗапрещеннаяКоманда;
  414          					} ИНАЧЕ	В СОСТ НекорректноеСобытие;		
  415           
  416          			КОНЕЦ;  /* конец для УМОЛЧАНИЯ */
  417          		  
  418          		} /* конец разбора */
  419          	} /* конец ЕСЛИ */
  420          	
  421           }	
  422          /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
  423           СОСТ ЗапрещеннаяКоманда{
  424               ЕСЛИ (SendMsgLongParamGUI(СУАБ2ФИК_ОШИБКА_ЗАПРЕЩЕННАЯ_КОМАНДА_РЕЖИМА_ИНИЦИАЛИЗАЦИИ, КодСобытия_от_ГИO))
  425                 В СОСТ Начало;
  426               ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;
  427           }
  428           СОСТ НекорректноеСобытие {
  429              ЕСЛИ (SendMsgLongParamGUI(СУАБ2ФИК_ОШИБКА_КОДА_КОМАНДЫ_ОТ_ГИО, КодСобытия_от_ГИO))
  430                   СТОП;   
  431              ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;
  432           }					
  433           СОСТ НарушениеСвязи {
  434              В СОСТ ЧтениеКольцевогоБуфера;
  435           }
  436          } /* конец ПРОЦ Режим_ИНИЦИАЛИЗАЦИЯ   */	
  437          
  438          /*==============================================*/
  439          /*=         КОНТРОЛЬ РЕЖИМОВ                   =*/
  440          /*==============================================*/
  441          ПРОЦ КонтрольРежимов {
  442          ИЗ ПРОЦ Инициализация ТекущийРежим;
  443          ЦЕЛ ЛП_Предыдущее ЛОКАЛ;
  444          ЦЕЛ ЛП_Сообщение ЛОКАЛ;
  445          
  446          	СОСТ Начало {
  447          		ЛП_Предыдущее = (!ТекущийРежим);
  448          		В СЛЕДУЮЩЕЕ;
  449          	}
  450          	СОСТ КонтрольИзменения{
  451          		ЕСЛИ (ЛП_Предыдущее != ТекущийРежим) {
  452          			ЛП_Предыдущее = ТекущийРежим;
  453          			РАЗБОР (ЛП_Предыдущее) {
  454          				СЛУЧАЙ РЕЖИМ_ИНИЦИАЛИЗАЦИИ:
  455          					ЛП_Сообщение = СУАБ2ФИК_РЕЖИМ_ИНИЦИАЛИЗАЦИЯ;
  456          				КОНЕЦ;	
  457          				СЛУЧАЙ РЕЖИМ_РР:
  458          					ЛП_Сообщение = СУАБ2ФИК_РЕЖИМ_РР;
  459          				КОНЕЦ;	
  460          				СЛУЧАЙ РЕЖИМ_ОТМЕНА:
  461          					ЛП_Сообщение = СУАБ2ФИК_РЕЖИМ_ОТМЕНА;
  462          				КОНЕЦ;	
  463          				СЛУЧАЙ РЕЖИМ_КОНЕЦ_РАБОТЫ:
  464          					ЛП_Сообщение = СУАБ2ФИК_РЕЖИМ_КОНЕЦ_РАБОТЫ;
  465          				КОНЕЦ;	
  466          				УМОЛЧАНИЕ: 
  467          				КОНЕЦ;	
  468          			}
  469          			В СЛЕДУЮЩЕЕ;
  470          		}
  471          	}
  472           СОСТ СообщОбИзменении_Режима {
  473               ЕСЛИ (SendMsgGUICode(ЛП_Сообщение)) В СОСТ КонтрольИзменения;
  474               ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;
  475           }
  476          
  477           /*======= Ненормальные ситуации ===========*/
  478           СОСТ НарушениеСвязи{
  479               В СОСТ Начало;
  480           }
  481          }  /* конец ПРОЦ КонтрольРежимов   */
  482          /*==============================================*/
  483          /*==============================================*/
  484          /*=                                            =*/
  485          /*=         РЕЖИМ РР     					   =*/
  486          /*=                                            =*/
  487          /*==============================================*/
  488          /*==============================================*/
  489          ПРОЦ Режим_РР{
  490          ИЗ ПРОЦ Инициализация 	КодСобытия_от_ГИO,
  491          						ТекущийРежим;
  492          
  493           СОСТ Начало{
  494              ТекущийРежим = РЕЖИМ_РР;
  495              В СЛЕДУЮЩЕЕ;
  496           }
  497               /*  читаем код и параметр события из кольцевого буфера в структуру */
  498          
  499           СОСТ ЧтениеКольцевогоБуфера{
  500              ЕСЛИ (GetNextMsgGUI()) {
  501          		КодСобытия_от_ГИO = GetMsgGUICode(); 
  502          		РАЗБОР (КодСобытия_от_ГИO) {
  503          			СЛУЧАЙ ГИО2СУАБ_РЕЖИМ_ОТМЕНА:
  504          				СТАРТ ПРОЦ ОТМЕНА;
  505          				КОНЕЦ;			
  506          			СЛУЧАЙ ГИО2СУАБ_РЕЖИМ_КОНЕЦ_РАБОТЫ:
  507          				СТАРТ ПРОЦ КОНЕЦ_РАБОТЫ;
  508          				КОНЕЦ;
  509          			УМОЛЧАНИЕ:
  510          				ЕСЛИ ((КодСобытия_от_ГИO >= ГИО2СУАБ_ЗАЖАТЬ_ДИСК) &&
  511          					(КодСобытия_от_ГИO <= ГИО2СУАБ_КОНЕЦ_КОДОВ_ФИК)) {
  512          						СТАРТ ПРОЦ ОбработкаКомандОтГИО;
  513          						В СОСТ КонтрольВыполненияКомандОтГИО;
  514          				} ИНАЧЕ 		
  515          
  516          				В СОСТ НекорректноеСобытие;		
  517          				КОНЕЦ;  /* конец для УМОЛЧАНИЯ */
  518          		  
  519          		} /* конец разбора */
  520          	} /* конец ЕСЛИ */
  521           }
  522          
  523           
  524           СОСТ КонтрольВыполненияКомандОтГИО{
  525              ЕСЛИ(!(ПРОЦ ОбработкаКомандОтГИО В СОСТ АКТИВНОЕ))
  526              В СОСТ ЧтениеКольцевогоБуфера;
  527           }
  528           
  529           
  530          /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
  531           СОСТ ЗапрещеннаяКоманда{
  532               ЕСЛИ (SendMsgLongParamGUI(СУАБ2ФИК_ОШИБКА_ЗАПРЕЩЕННАЯ_КОМАНДА_РЕЖИМА_РР, КодСобытия_от_ГИO))
  533                 В СОСТ Начало;
  534               ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;
  535           }
  536           СОСТ НекорректноеСобытие {
  537              ЕСЛИ (SendMsgLongParamGUI(СУАБ2ФИК_ОШИБКА_КОДА_КОМАНДЫ_ОТ_ГИО, КодСобытия_от_ГИO))
  538                  В СОСТ Начало;   
  539              ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;
  540           }					
  541           СОСТ НарушениеСвязи {
  542              В СОСТ ЧтениеКольцевогоБуфера;
  543           }
  544          } /* конец ПРОЦ Режим_ИНИЦИАЛИЗАЦИЯ   */
  545          
  546          
  547          
  548          /*=========================================*/
  549          /*=                                       =*/
  550          /*=     ОБРАБОТКА КОМАНД УПРАВЛЕНИЯ       =*/
  551          /*=     ОТ ГИО                 			 =*/
  552          /*=========================================*/
  553          ПРОЦ ОбработкаКомандОтГИО{
  554          ИЗ ПРОЦ Инициализация
  555                                КодСобытия_от_ГИO,
  556          					  КодСобытия_к_ГИO,
  557          					  ЗД_R_КАРЕТКИ,
  558          					  ЗД_W_ПРЕДМЕТНОГО_СТОЛИКА,
  559          					  ФлагКонтроляВоздушнойПодушки,
  560          					  ФлагСвязиМоха1212,
  561            					  ФлагСвязиМоха1214;
  562          ПЛАВ ЛП_ЗД ЛОКАЛ;					  
  563          ЦЕЛ ЛП_КодСообщения ЛОКАЛ;
  564          
  565          /* СОБЫТИЯ УПРАВЛЕНИЯ ПРОЦЕССАМИ */
  566           СОСТ Анализ{
  567              В СЛЕДУЮЩЕЕ; 
  568              РАЗБОР (КодСобытия_от_ГИO) {
  569                 СЛУЧАЙ ГИО2СУАБ_ЗАЖАТЬ_ДИСК:
  570                    СТАРТ ПРОЦ ЗАЖАТЬ_ДИСК;
  571                    КОНЕЦ;
  572                 СЛУЧАЙ ГИО2СУАБ_РАЗЖАТЬ_ДИСК:
  573                    СТАРТ ПРОЦ РАЗЖАТЬ_ДИСК;
  574                    КОНЕЦ;
  575                 СЛУЧАЙ ГИО2СУАБ_ВКЛ_ПОДСВЕТКУ_ДИСКА:
  576                    СТАРТ ПРОЦ ВКЛ_ПОДСВЕТКУ_ДИСКА;
  577                    КОНЕЦ;		  
  578                 СЛУЧАЙ ГИО2СУАБ_ВЫКЛ_ПОДСВЕТКУ_ДИСКА:
  579                    СТАРТ ПРОЦ ВЫКЛ_ПОДСВЕТКУ_ДИСКА;
  580                    КОНЕЦ;		  
  581          		СЛУЧАЙ ГИО2СУАБ_КО_ИСПРАВНОСТЬ_ВОЗДУШНЫХ_ПОДУШЕК:
  582          			ФлагКонтроляВоздушнойПодушки = ВКЛ;
  583          			СТАРТ ПРОЦ РАЗБЛОКИРОВКА_КОМАНД_ПЕРЕМЕЩЕНИЯ;
  584          			КОНЕЦ;
  585          		СЛУЧАЙ ГИО2СУАБ_ОТКАЗ_ВОЗДУШНЫХ_ПОДУШЕК:
  586          			ФлагКонтроляВоздушнойПодушки = ВЫКЛ;
  587          			СТАРТ ПРОЦ БЛОКИРОВКА_КОМАНД_ПЕРЕМЕЩЕНИЯ;
  588          			КОНЕЦ;
  589                 СЛУЧАЙ ГИО2СУАБ_КАРЕТКУ_В_ПОЛОЖЕНИЕ_УСТАНОВКИ_ДИСКА:
  590                    СТАРТ ПРОЦ КАРЕТКУ_В_ПОЛОЖЕНИЕ_УСТАНОВКИ_ДИСКА;
  591                    КОНЕЦ;		  
  592                 СЛУЧАЙ ГИО2СУАБ_КАРЕТКУ_В_ЦЕНТР_ВРАЩЕНИЯ:
  593                    СТАРТ ПРОЦ КАРЕТКУ_В_ЦЕНТР_ВРАЩЕНИЯ;
  594                    КОНЕЦ;
  595                 СЛУЧАЙ ГИО2СУАБ_КАРЕТКУ_В_ЗАДАННЫЙ_РАДИУС:
  596                   СТАРТ ПРОЦ КАРЕТКУ_В_ЗАДАННЫЙ_РАДИУС;  
  597                    КОНЕЦ;
  598                 СЛУЧАЙ ГИО2СУАБ_СТОП_КАРЕТКИ:
  599                    СТАРТ ПРОЦ СТОП_КАРЕТКИ;  
  600                    КОНЕЦ;
  601                 СЛУЧАЙ ГИО2СУАБ_ВКЛ_АКТИВНОЕ_ПОЗИЦИОНИРОВАНИЕ_ПО_ВРАЩЕНИЮ:
  602                    СТАРТ ПРОЦ ВКЛ_АКТИВНОЕ_ПОЗИЦИОНИРОВАНИЕ_ПО_ВРАЩЕНИЮ;
  603                    КОНЕЦ;
  604                 СЛУЧАЙ ГИО2СУАБ_ВЫКЛ_АКТИВНОЕ_ПОЗИЦИОНИРОВАНИЕ_ПО_ВРАЩЕНИЮ:
  605                    СТАРТ ПРОЦ ВЫКЛ_АКТИВНОЕ_ПОЗИЦИОНИРОВАНИЕ_ПО_ВРАЩЕНИЮ;
  606                    КОНЕЦ;
  607                 СЛУЧАЙ ГИО2СУАБ_ВКЛ_ВРАЩЕНИЕ_ПРЕД_СТОЛИКА_В_ЗД_W:
  608                    СТАРТ ПРОЦ ВКЛ_ВРАЩЕНИЕ_ПРЕД_СТОЛИКА_В_ЗД_W;
  609                    КОНЕЦ;
  610                 СЛУЧАЙ ГИО2СУАБ_СТОП_ВРАЩЕНИЯ_ПРЕДМЕТНОГО_СТОЛИКА:
  611                    СТАРТ ПРОЦ СТОП_ВРАЩЕНИЯ_ПРЕДМЕТНОГО_СТОЛИКА;
  612                    КОНЕЦ;
  613                 СЛУЧАЙ ФИК2СУАБ_ЕСТЬ_СВЯЗЬ_С_МОХА1212:
  614                    ФлагСвязиМоха1212 = ВКЛ;
  615                    КОНЕЦ;
  616                 СЛУЧАЙ ФИК2СУАБ_НЕТ_СВЯЗИ_С_МОХА1212:
  617                    ФлагСвязиМоха1212 = ВЫКЛ;
  618                    КОНЕЦ;
  619                 СЛУЧАЙ ФИК2СУАБ_ЕСТЬ_СВЯЗЬ_С_МОХА1214:
  620                    ФлагСвязиМоха1214 = ВКЛ;
  621                    КОНЕЦ;
  622                 СЛУЧАЙ ФИК2СУАБ_НЕТ_СВЯЗИ_С_МОХА1214:
  623                    ФлагСвязиМоха1214 = ВЫКЛ;
  624                    КОНЕЦ;
  625                 СЛУЧАЙ ГИО2СУАБ_ИЗМН_ЗД_R_КАРЕТКИ:
  626                    ЛП_ЗД = GetFloatParamGUI();
  627                    ЕСЛИ ((ЛП_ЗД < МИНИМАЛЬНОЕ_ЗАДАНИЕ_R_КАРЕТКИ)
  628                            || (ЛП_ЗД > МАКСИМАЛЬНОЕ_ЗАДАНИЕ_R_КАРЕТКИ)) {
  629                         ЛП_КодСообщения = СУАБ2ФИК_ЗД_R_КАРЕТКИ_ВНЕ_ДИАПАЗОНА;
  630                         В СОСТ ЗД_ВнеДиапазона;
  631                    } ИНАЧЕ {
  632                         ЗД_R_КАРЕТКИ = ЛП_ЗД;
  633          /*			   КодСобытия_к_ГИO = СУАБ2ФИК_ИЗМН_ЗД_R_КАРЕТКИ;
  634          			   В СОСТ ПодтверждениеИзмененияЗД;   */
  635          			   СТОП;
  636                     }
  637                  КОНЕЦ;
  638          		  
  639                 СЛУЧАЙ ГИО2СУАБ_ИЗМН_ЗД_W_ПРЕДМЕТНОГО_СТОЛИКА:
  640                    ЛП_ЗД = GetFloatParamGUI();
  641                    ЕСЛИ ((ЛП_ЗД < МИНИМАЛЬНОЕ_ЗАДАНИЕ_W_ПРЕДМЕТНОГО_СТОЛИКА)
  642                            || (ЛП_ЗД > МАКСИМАЛЬНОЕ_ЗАДАНИЕ_W_ПРЕДМЕТНОГО_СТОЛИКА)) {
  643                         ЛП_КодСообщения = СУАБ2ФИК_ЗД_W_ПРЕДМЕТНОГО_СТОЛИКА_ВНЕ_ДИАПАЗОНА;
  644                         В СОСТ ЗД_ВнеДиапазона;
  645                    } ИНАЧЕ {
  646                         ЗД_W_ПРЕДМЕТНОГО_СТОЛИКА = ЛП_ЗД;
  647          /*			   КодСобытия_к_ГИO = СУАБ2ФИК_ИЗМН_ЗД_W_ПРЕДМЕТНОГО_СТОЛИКА;
  648          			   В СОСТ ПодтверждениеИзмененияЗД;  */
  649          			   СТОП;	
  650                    }
  651                  КОНЕЦ;
  652          
  653                 УМОЛЧАНИЕ:
  654                    В СОСТ НекорректноеСобытие; /* отменит СТОП и все будет хорошо */
  655                  КОНЕЦ;
  656              } /* конец разбора */
  657           }
  658           СОСТ ОстановПоЗапускуКоманды {
  659              СТОП;
  660           }
  661           /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
  662           СОСТ НекорректноеСобытие {
  663              ЕСЛИ (SendMsgLongParamGUI(СУАБ2ФИК_ОШИБКА_КОДА_КОМАНДЫ_ОТ_ГИО, КодСобытия_от_ГИO))
  664                   СТОП;
  665              ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;
  666           }
  667           СОСТ ЗД_ВнеДиапазона{
  668              ЕСЛИ (SendMsgGUICode(ЛП_КодСообщения)) СТОП;
  669               ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;
  670           }
  671           СОСТ ПодтверждениеИзмененияЗД{
  672           	 ЕСЛИ (SendMsgLongParamGUI(КодСобытия_к_ГИO, GetLongParamGUI())) СТОП;
  673              ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;
  674           } 
  675           СОСТ НарушениеСвязи {
  676              ОШИБКА;
  677           }
  678          } /* конец ПРОЦ ОбработкаКомандОтГИО   */
  679          
  680          
  681          /*================================================*/
  682          /*=  Контроль изменения заданий   R_КАРЕТКИ      =*/
  683          /*================================================*/
  684          ПРОЦ КонтрольИзмененияЗаданий_ЗД_R_КАРЕТКИ{
  685           ИЗ ПРОЦ Инициализация   ЗД_R_КАРЕТКИ;
  686           ПЛАВ ЛП_Предыдущее ЛОКАЛ;
  687           СОСТ Начало{
  688              ЛП_Предыдущее = (!ЗД_R_КАРЕТКИ);
  689              В СЛЕДУЮЩЕЕ;
  690           }
  691           СОСТ КонтрольИзменения{
  692              ЕСЛИ (ЛП_Предыдущее != ЗД_R_КАРЕТКИ) {
  693                   ЛП_Предыдущее = ЗД_R_КАРЕТКИ;
  694                   В СЛЕДУЮЩЕЕ;
  695              }
  696           }
  697           СОСТ СообщОбИзменении_ГИО{
  698               ЕСЛИ (SendMsgFloatParamGUI(СУАБ2ФИК_ИЗМН_ЗД_R_КАРЕТКИ, ЛП_Предыдущее)) В СОСТ КонтрольИзменения;
  699               ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;
  700           }
  701          
  702           /*======= Ненормальные ситуации ===========*/
  703           СОСТ НарушениеСвязи{
  704               В СОСТ КонтрольИзменения;
  705           }
  706          }  /* конец ПРОЦ КонтрольИзмененияЗаданий_ЗД_R_КАРЕТКИ   */
  707          
  708          /*================================================*/
  709          /*=  Контроль изменения заданий   ЗД_W_ПРЕДМЕТНОГО_СТОЛИКА      =*/
  710          /*================================================*/
  711          ПРОЦ КонтрольИзмененияЗаданий_ЗД_W_ПРЕДМЕТНОГО_СТОЛИКА{
  712           ИЗ ПРОЦ Инициализация   ЗД_W_ПРЕДМЕТНОГО_СТОЛИКА;
  713           ПЛАВ ЛП_Предыдущее ЛОКАЛ;
  714           СОСТ Начало{
  715              ЛП_Предыдущее = (!ЗД_W_ПРЕДМЕТНОГО_СТОЛИКА);
  716              В СЛЕДУЮЩЕЕ;
  717           }
  718           СОСТ КонтрольИзменения{
  719              ЕСЛИ (ЛП_Предыдущее != ЗД_W_ПРЕДМЕТНОГО_СТОЛИКА) {
  720                   ЛП_Предыдущее = ЗД_W_ПРЕДМЕТНОГО_СТОЛИКА;
  721                   В СЛЕДУЮЩЕЕ;
  722              }
  723           }
  724           СОСТ СообщОбИзменении_ГИО{
  725               ЕСЛИ (SendMsgFloatParamGUI(СУАБ2ФИК_ИЗМН_ЗД_W_ПРЕДМЕТНОГО_СТОЛИКА, ЛП_Предыдущее)) В СОСТ КонтрольИзменения;
  726               ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;
  727           }
  728          
  729           /*======= Ненормальные ситуации ===========*/
  730           СОСТ НарушениеСвязи{
  731               В СОСТ КонтрольИзменения;
  732           }
  733          }  /* конец ПРОЦ КонтрольИзмененияЗаданий ЗД_W_ПРЕДМЕТНОГО_СТОЛИКА   */
  734          	
  735          
  736          /*================================================*/
  737          /*=  Контроль изменения ФП   R_КАРЕТКИ      =*/
  738          /*================================================*/
  739          ПРОЦ КонтрольИзменения_ФП_R_КАРЕТКИ{
  740           ИЗ ПРОЦ Инициализация   ФП_R_КАРЕТКИ;
  741           ПЛАВ ЛП_Предыдущее ЛОКАЛ;
  742           СОСТ Начало{
  743              ЛП_Предыдущее = (!ФП_R_КАРЕТКИ);
  744              В СЛЕДУЮЩЕЕ;
  745           }
  746           СОСТ КонтрольИзменения{
  747              ЕСЛИ (ЛП_Предыдущее != ФП_R_КАРЕТКИ) {
  748                   ЛП_Предыдущее = ФП_R_КАРЕТКИ;
  749                   В СЛЕДУЮЩЕЕ;
  750              }
  751           }
  752           СОСТ СообщОбИзменении_ГИО{
  753               ЕСЛИ (SendMsgFloatParamGUI(СУАБ2ФИК_ИЗМН_ФП_R_КАРЕТКИ, ЛП_Предыдущее)) В СОСТ КонтрольИзменения;
  754               ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;
  755           }
  756          
  757           /*======= Ненормальные ситуации ===========*/
  758           СОСТ НарушениеСвязи{
  759               В СОСТ КонтрольИзменения;
  760           }
  761          }  /* конец ПРОЦ КонтрольИзмененияЗаданий_ФП_R_КАРЕТКИ   */
  762          
  763          /*================================================*/
  764          /*=  Контроль изменения ФП_W_ПРЕДМЕТНОГО_СТОЛИКА     =*/
  765          /*================================================*/
  766          ПРОЦ КонтрольИзменения_ФП_W_ПРЕДМЕТНОГО_СТОЛИКА{
  767           ИЗ ПРОЦ Инициализация   ФП_W_ПРЕДМЕТНОГО_СТОЛИКА;
  768           ПЛАВ ЛП_Предыдущее ЛОКАЛ;
  769           СОСТ Начало{
  770              ЛП_Предыдущее = (!ФП_W_ПРЕДМЕТНОГО_СТОЛИКА);
  771              В СЛЕДУЮЩЕЕ;
  772           }
  773           СОСТ КонтрольИзменения{
  774              ЕСЛИ (ЛП_Предыдущее != ФП_W_ПРЕДМЕТНОГО_СТОЛИКА) {
  775                   ЛП_Предыдущее = ФП_W_ПРЕДМЕТНОГО_СТОЛИКА;
  776                   В СЛЕДУЮЩЕЕ;
  777              }
  778           }
  779           СОСТ СообщОбИзменении_ГИО{
  780               ЕСЛИ (SendMsgFloatParamGUI(СУАБ2ФИК_ИЗМН_ФП_W_ПРЕДМЕТНОГО_СТОЛИКА, ЛП_Предыдущее)) В СОСТ КонтрольИзменения;
  781               ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;
  782           }
  783          
  784           /*======= Ненормальные ситуации ===========*/
  785           СОСТ НарушениеСвязи{
  786               В СОСТ КонтрольИзменения;
  787           }
  788          }  /* конец ПРОЦ КонтрольИзмененияЗаданий_ФП_W_ПРЕДМЕТНОГО_СТОЛИКА   */
  789          
  790          
  791          /*=================================================*/
  792          /*=                                               =*/
  793          /*=     Создание воздушной подушки установки      =*/
  794          /*=                                               =*/
  795          /*=================================================*/
  796          ПРОЦ ВКЛ_ВОЗД_ПОДУШКУ{
  797          ИЗ ПРОЦ Инициализация  	К_ВОЗД_ПОД_Р_РАБОЧЕЕ,
  798          						У_ВОЗД_ПОД_СТОЛА,
  799          						У_ВОЗД_ПОД_КАРЕТКИ,
  800          						У_ВОЗД_ПОД_ШПИНДЕЛЯ;
  801          	СОСТ Начало{
  802              	ЕСЛИ (К_ВОЗД_ПОД_Р_РАБОЧЕЕ) В СОСТ ПодачаВоздухаНаОпоруСтола;
  803          		ИНАЧЕ В СОСТ СообщениеВключитьКомпрессор; 
  804          	}
  805          	СОСТ СообщениеВключитьКомпрессор{
  806          		ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_ВКЛЮЧИТЕ_КОМПРЕССОР))	В СОСТ ОжиданиеДавления;
  807          		ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;
  808          	}
  809          	СОСТ ОжиданиеДавления{
  810          		ЕСЛИ (К_ВОЗД_ПОД_Р_РАБОЧЕЕ) В СЛЕДУЮЩЕЕ;	
  811          		ТАЙМАУТ ПЯТЬ_МИНУТ В СОСТ СообщениеВключитьКомпрессор;
  812          	}
  813          	СОСТ ПодачаВоздухаНаОпоруСтола{
  814          		У_ВОЗД_ПОД_СТОЛА = ВКЛ; В СЛЕДУЮЩЕЕ;
  815          	}
  816          	СОСТ ПаузаДляОпорыСтола{
  817          		ТАЙМАУТ ТАЙМАУТ_ВОЗД_ПОДУШКИ В СЛЕДУЮЩЕЕ;
  818          	}	
  819          	СОСТ ПодачаВоздухаНаКаретку{
  820          		У_ВОЗД_ПОД_КАРЕТКИ = ВКЛ; В СЛЕДУЮЩЕЕ;
  821          	}
  822          	СОСТ ПаузаДляКаретки{
  823          		ТАЙМАУТ ТАЙМАУТ_ВОЗД_ПОДУШКИ В СЛЕДУЮЩЕЕ;
  824          	}
  825          	СОСТ ПодачаВоздухаНаШпиндель{
  826          		У_ВОЗД_ПОД_ШПИНДЕЛЯ = ВКЛ; В СЛЕДУЮЩЕЕ;
  827          	}	
  828          	СОСТ ПаузаДляШпинделя{
  829          		ТАЙМАУТ ТАЙМАУТ_ВОЗД_ПОДУШКИ {
  830          			СТАРТ ПРОЦ ПроверкаИсправностиВоздушнойПодушки;
  831          			В СЛЕДУЮЩЕЕ;
  832          		}
  833          	} 
  834          	СОСТ АнализРезультатовПроверки{
  835          		ЕСЛИ (ПРОЦ ПроверкаИсправностиВоздушнойПодушки В СОСТ СТОП) СТОП;
  836          		ЕСЛИ (ПРОЦ ПроверкаИсправностиВоздушнойПодушки В СОСТ ОШИБКА) ОШИБКА;
  837          	}	
  838          	
  839          	/*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
  840          	СОСТ НарушениеСвязи {
  841          		В СОСТ Начало;	
  842          	}
  843          }  /* конец ПРОЦ ВКЛ_ВОЗД_ПОДУШКУ   */	
  844          
  845          /*=================================================*/
  846          /*=                                               =*/
  847          /*= Проверка оператором наличия воздушных подушек =*/
  848          /*=                                               =*/
  849          /*=================================================*/
  850          ПРОЦ ПроверкаИсправностиВоздушнойПодушки {
  851          ИЗ ПРОЦ Инициализация  	ФлагКонтроляВоздушнойПодушки;
  852          	СОСТ ОператоруПроконтролируйГотовностьВоздушныхПодушек{
  853          		ФлагКонтроляВоздушнойПодушки = НИ_ДА_НИ_НЕТ;
  854          		ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_ПРОВЕРЬ_ВОЗДУШНУЮ_ПОДУШКУ)) 	
  855          			В СЛЕДУЮЩЕЕ;
  856          		ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;
  857          	}
  858          	СОСТ АнализГотовностьВоздПодушек{	
  859          		ЕСЛИ (ФлагКонтроляВоздушнойПодушки == ВКЛ) СТОП;
  860          		ЕСЛИ (ФлагКонтроляВоздушнойПодушки == ВЫКЛ) ОШИБКА;
  861          	}	
  862          	СОСТ НарушениеСвязи {
  863          		ОШИБКА;	
  864          	}
  865          }	
  866          
  867          
  868          /*=================================================*/
  869          /*=                                               =*/
  870          /*=     Включени насоса вакуумной системы         =*/
  871          /*=                                               =*/
  872          /*=================================================*/
  873          ПРОЦ ВКЛ_НАСОС{
  874          ИЗ ПРОЦ Инициализация  	У_ЗАЖИМ_ДИСКА,
  875          						У_РАЗЖИМ_ДИСКА,
  876          						У_ВКЛ_НАСОС;
  877          
  878          	СОСТ ЗакрываемОбаКлапана{
  879          		У_ЗАЖИМ_ДИСКА = ВЫКЛ;	/* закрываем клапан натекания вакуума*/
  880          		У_РАЗЖИМ_ДИСКА = ВЫКЛ;	/* закрываем клапан атмосферы */
  881          		В СЛЕДУЮЩЕЕ;
  882          	}
  883          	СОСТ ПаузаДляЗакрываемОбоихКлапанов{
  884          		ТАЙМАУТ ДВЕ_СЕКУНДЫ В СЛЕДУЮЩЕЕ;
  885          	}	
  886          	СОСТ ВключениеНасоса{
  887          		У_ВКЛ_НАСОС = ВКЛ; В СЛЕДУЮЩЕЕ;
  888          	}
  889          
  890          	СОСТ ПаузаДляВключенияНасоса{
  891          		ТАЙМАУТ ТАЙМАУТ_НАСОСА_ВАКУУМНОГО СТОП;
  892          	}	
  893          }   /* конец ПРОЦ ВКЛ_НАСОС   */	
  894          
  895          /*================================================*/
  896          /*=                                              =*/
  897          /*=     Зажим диска        						 =*/
  898          /*=                                              =*/
  899          /*================================================*/
  900          ПРОЦ ЗАЖАТЬ_ДИСК{
  901          ИЗ ПРОЦ Инициализация  	У_ЗАЖИМ_ДИСКА,
  902          						У_РАЗЖИМ_ДИСКА,
  903          						К_ДИСК_РАЗЖАТ;  /* норма была*/
  904          						
  905          	СОСТ Начало{
  906          		ЕСЛИ (К_ДИСК_РАЗЖАТ == ВЫКЛ) СТАРТ ПРОЦ КонтрольВакуума; /* если уже зажат, то выдастся сообщение о зажатии */
  907          	    ЕСЛИ (ПРОЦ РАЗЖАТЬ_ДИСК В СОСТ АКТИВНОЕ)  ОШИБКА ПРОЦ РАЗЖАТЬ_ДИСК;
  908          		У_РАЗЖИМ_ДИСКА = ВЫКЛ;	/* закрываем клапан атмосферы */
  909          		В СЛЕДУЮЩЕЕ;
  910          	}
  911          	СОСТ ЖдемЗакрытияКлапанаАтмосферы{
  912          		ТАЙМАУТ ОДНА_СЕКУНДА В СЛЕДУЮЩЕЕ;
  913          	}
  914          	СОСТ ОткрКлапанНатеканияВакуума{
  915          		У_ЗАЖИМ_ДИСКА = ВКЛ;	/* открываем клапан натекания вакуума */
  916          		В СЛЕДУЮЩЕЕ;
  917          	}
  918          	СОСТ ЕстьЛиНормальноеДавление{	
  919          		ЕСЛИ (К_ДИСК_РАЗЖАТ == ВЫКЛ){
  920          			СТАРТ ПРОЦ КонтрольАварииВакуума;
  921          			СТОП;  /* прижали диск*/
  922          		}
  923          		ТАЙМАУТ ТАЙМАУТ_ЗАЖИМА_ДИСКА В СОСТ Ошибка; 					
  924          	}
  925          /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
  926          	СОСТ Ошибка {
  927          		ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_ОТКАЗ_ЗАЖИМА_ДИСКА))	ОШИБКА;
  928          		ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;
  929          	}
  930          	СОСТ НарушениеСвязи {
  931          	   ОШИБКА;
  932          	}
  933          }   /* конец ПРОЦ ЗАЖАТЬ_ДИСК   */	
  934          
  935          /*================================================*/
  936          /*=                                              =*/
  937          /*=     Зажим диска        						 =*/
  938          /*=                                              =*/
  939          /*================================================*/
  940          ПРОЦ РАЗЖАТЬ_ДИСК{
  941          ИЗ ПРОЦ Инициализация  	У_ЗАЖИМ_ДИСКА,
  942          						У_РАЗЖИМ_ДИСКА,
  943          						К_ДИСК_РАЗЖАТ;	/* норма была*/
  944          	СОСТ Начало{
  945          		ЕСЛИ (К_ДИСК_РАЗЖАТ == ВКЛ) СТАРТ ПРОЦ КонтрольВакуума; /* если уже зажат, то выдастся сообщение о разжатии */
  946          		ЕСЛИ (ПРОЦ ЗАЖАТЬ_ДИСК В СОСТ АКТИВНОЕ)  ОШИБКА ПРОЦ ЗАЖАТЬ_ДИСК;
  947          		СТАРТ ПРОЦ ОТМЕНА;   /* останавливаем движение и вращение*/
  948          		СТОП ПРОЦ КонтрольАварииВакуума;
  949          		В СЛЕДУЮЩЕЕ;
  950          	}
  951          	СОСТ КонтрольЗавершенияОтмены{
  952                ЕСЛИ (ПРОЦ ОТМЕНА В СОСТ ПАССИВНОЕ) {
  953                   ЕСЛИ (ПРОЦ ОТМЕНА В СОСТ ОШИБКА) ОШИБКА;
  954                   ИНАЧЕ В СЛЕДУЮЩЕЕ;
  955                }
  956          	}
  957          	СОСТ ЗакрываемНатекание{
  958          		У_ЗАЖИМ_ДИСКА = ВЫКЛ;	/* закрываем клапан натекания вакуума */	
  959          		В СЛЕДУЮЩЕЕ;
  960          	}
  961          	СОСТ ЖдемЗакрытияКлапанаНатекания{
  962          		ТАЙМАУТ ОДНА_СЕКУНДА В СЛЕДУЮЩЕЕ;
  963          	}	
  964          	СОСТ ОткрываемКлапанАтмосферы{
  965          		У_РАЗЖИМ_ДИСКА = ВКЛ;	/* открываем клапан атмосферы */
  966          		В СЛЕДУЮЩЕЕ;
  967          	}	
  968          	СОСТ НетЛиДавления{	
  969          		ЕСЛИ (К_ДИСК_РАЗЖАТ == ВКЛ) 	СТОП;  /* отжали диск*/
  970          		ТАЙМАУТ ТАЙМАУТ_РАЗЖИМА_ДИСКА В СОСТ Ошибка; 					
  971          	}
  972          
  973          /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
  974          	СОСТ Ошибка {
  975          		ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_ОТКАЗ_РАЗЖИМА_ДИСКА))	ОШИБКА;
  976          		ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;
  977          	}
  978          	СОСТ НарушениеСвязи {
  979          	   ОШИБКА;
  980          	}
  981          }   /* конец ПРОЦ РАЗЖАТЬ_ДИСК   */	
  982          
  983          /*================================================*/
  984          /*=                                              =*/
  985          /*=     ИНИЦИАЛИЗАЦИЯ_ЛАЗЕРА   					 =*/
  986          /*=                                              =*/
  987          /*================================================*/
  988          ПРОЦ ИНИЦИАЛИЗАЦИЯ_ЛАЗЕРА{
  989          ИЗ ПРОЦ Инициализация  	У_ПИТАНИЕ_ЛАЗЕРА;
  990          	СОСТ Начало{
  991          		ТАЙМАУТ ТРИДЦАТЬ_СЕКУНД В СЛЕДУЮЩЕЕ;
  992          	}	
  993          	СОСТ ВключаемЛазер{
  994          		У_ПИТАНИЕ_ЛАЗЕРА = ВКЛ;	
  995          		СТАРТ ПРОЦ КонтрольОсвещенияДиска;
  996          		СТОП;
  997          	}
  998          }   /* конец ПРОЦ ИНИЦИАЛИЗАЦИЯ_ЛАЗЕРА   */	
  999          
 1000          
 1001          
 1002          /*================================================*/
 1003          /*=                                              =*/
 1004          /*=     Включение  ЛАЗЕРА   					     =*/
 1005          /*=                                              =*/
 1006          /*================================================*/
 1007          ПРОЦ ВКЛ_ЛАЗЕРА{
 1008          ИЗ ПРОЦ Инициализация  	У_ВКЛ_ЛАЗЕРА,
 1009          						У_ИНТЕНСИВНОСТЬ_ЛАЗЕРА;
 1010          	СОСТ Начало{
 1011          		У_ВКЛ_ЛАЗЕРА = ВКЛ;	
 1012          		У_ИНТЕНСИВНОСТЬ_ЛАЗЕРА = ВКЛ;
 1013          		СТОП;
 1014          	}	
 1015          }   /* конец ПРОЦ ВКЛ_ЛАЗЕРА   */	
 1016          
 1017          /*================================================*/
 1018          /*=                                              =*/
 1019          /*=     Выключение ЛАЗЕРА   					     =*/
 1020          /*=                                              =*/
 1021          /*================================================*/
 1022          ПРОЦ ВЫКЛ_ЛАЗЕРА{
 1023          ИЗ ПРОЦ Инициализация  	У_ВКЛ_ЛАЗЕРА,
 1024          						У_ИНТЕНСИВНОСТЬ_ЛАЗЕРА;
 1025          	СОСТ Начало{
 1026          		У_ВКЛ_ЛАЗЕРА = ВЫКЛ;	
 1027          		У_ИНТЕНСИВНОСТЬ_ЛАЗЕРА = ВЫКЛ;
 1028          		СТОП;
 1029          	}	
 1030          }   /* конец ПРОЦ ВЫКЛ_ЛАЗЕРА   */	
 1031          
 1032          /*================================================*/
 1033          /*=                                              =*/
 1034          /*=     КОНТРОЛЬ_ЛАЗЕРА   					 =*/
 1035          /*=                                              =*/
 1036          /*================================================*/
 1037          ПРОЦ КонтрольОсвещенияДиска{
 1038          ИЗ ПРОЦ Инициализация  	У_ВКЛ_СВЕТОДИОДА,
 1039          						У_ВЫКЛ_СВЕТОДИОДА;
 1040           СОСТ Начало{
 1041          	В СОСТ ОсвещениеВыключено; /*по умолчанию */
 1042          	ЕСЛИ (У_ВКЛ_СВЕТОДИОДА == ВКЛ)  В СОСТ ОсвещениеВключено;
 1043           }	
 1044           СОСТ ОсвещениеВыключено{
 1045              ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_ОСВЕЩЕНИЕ_ДИСКА_ВЫКЛЮЧЕНО)) 	В СОСТ ОжиданиеВключения;
 1046              ИНАЧЕ В СОСТ Начало;
 1047           }	
 1048           СОСТ ОжиданиеВключения{
 1049          	ЕСЛИ (У_ВКЛ_СВЕТОДИОДА == ВКЛ) В СОСТ Начало;	
 1050           }
 1051           СОСТ ОсвещениеВключено{
 1052              ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_ОСВЕЩЕНИЕ_ДИСКА_ВКЛЮЧЕНО)) 	В СОСТ ОжиданиеВыключения;
 1053              ИНАЧЕ В СОСТ Начало;
 1054           }	
 1055           СОСТ ОжиданиеВыключения{
 1056          	ЕСЛИ (У_ВКЛ_СВЕТОДИОДА == ВЫКЛ) В СОСТ Начало;	
 1057           }
 1058          }   /* конец ПРОЦ "КонтрольДавления   */	
 1059          
 1060          
 1061          /*================================================*/
 1062          /*=                                              =*/
 1063          /*=     Включение освещения диска			     =*/
 1064          /*=                                              =*/
 1065          /*================================================*/
 1066          ПРОЦ ВКЛ_ПОДСВЕТКУ_ДИСКА{
 1067          ИЗ ПРОЦ Инициализация  	У_ВКЛ_СВЕТОДИОДА,
 1068          						У_ВЫКЛ_СВЕТОДИОДА;
 1069          	СОСТ Начало{
 1070          		ЕСЛИ (У_ВКЛ_СВЕТОДИОДА == ВКЛ) СТАРТ ПРОЦ КонтрольОсвещенияДиска;	
 1071          		У_ВКЛ_СВЕТОДИОДА = ВКЛ;	
 1072          		У_ВЫКЛ_СВЕТОДИОДА = ВЫКЛ;
 1073          		СТОП;
 1074          	}	
 1075          }   /* конец ПРОЦ ВКЛ_ПОДСВЕТКУ_ДИСКА   */	
 1076          
 1077          /*================================================*/
 1078          /*=                                              =*/
 1079          /*=     Выключение освещения диска			     =*/
 1080          /*=                                              =*/
 1081          /*================================================*/
 1082          ПРОЦ ВЫКЛ_ПОДСВЕТКУ_ДИСКА{
 1083          ИЗ ПРОЦ Инициализация  	У_ВКЛ_СВЕТОДИОДА,
 1084          						У_ВЫКЛ_СВЕТОДИОДА;
 1085          	СОСТ Начало{
 1086          		ЕСЛИ (У_ВКЛ_СВЕТОДИОДА == ВЫКЛ) СТАРТ ПРОЦ КонтрольОсвещенияДиска;	
 1087          		У_ВКЛ_СВЕТОДИОДА = ВЫКЛ;	
 1088          		У_ВЫКЛ_СВЕТОДИОДА = ВКЛ;
 1089          		СТОП;
 1090          	}	
 1091          }   /* конец ПРОЦ ВЫКЛ_ПОДСВЕТКУ_ДИСКА   */	
 1092          /*================================================*/
 1093          /*=                                              =*/
 1094          /*=     Инициализация приводов				     =*/
 1095          /*=                                              =*/
 1096          /*================================================*/
 1097          ПРОЦ ИНИЦИАЛИЗАЦИЯ_ПРИВОДОВ{
 1098          /* ИЗ ПРОЦ Инициализация  	;  */
 1099          	СОСТ Начало{
 1100          /*		?????????????		*/
 1101          		СТОП;
 1102          	}	
 1103          }   /* конец ПРОЦ ИНИЦИАЛИЗАЦИЯ_ПРИВОДОВ   */	
 1104          
 1105          /*================================================*/
 1106          /*=                                              =*/
 1107          /*=      контроль давления  				     =*/
 1108          /*=                                              =*/
 1109          /*================================================*/
 1110          ПРОЦ КонтрольДавления{
 1111           ИЗ ПРОЦ Инициализация 	К_ВОЗД_ПОД_Р_НЕ_КРИТИЧЕСКОЕ,		/*		было критическое		*/
 1112          						К_ВОЗД_ПОД_Р_РАБОЧЕЕ;  				/*		было норма		*/
 1113           СОСТ Начало{
 1114          	В СОСТ НормальноеДавление; /*по умолчанию */
 1115          	ЕСЛИ ((К_ВОЗД_ПОД_Р_НЕ_КРИТИЧЕСКОЕ == ВКЛ) &&
 1116          				(К_ВОЗД_ПОД_Р_РАБОЧЕЕ != ВКЛ)) В СОСТ НизкоеДавление;	/*		было критическое		*/
 1117          	ЕСЛИ (К_ВОЗД_ПОД_Р_НЕ_КРИТИЧЕСКОЕ == ВЫКЛ) В СОСТ Авария;		/*	давление ниже критического	-- авария */
 1118           }	
 1119           СОСТ НормальноеДавление{
 1120              ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_ДАВЛЕНИЕ_В_НОРМЕ)) 	В СОСТ ОжиданиеНеНормальногоДавления;
 1121              ИНАЧЕ В СОСТ Начало;
 1122           }	
 1123           СОСТ ОжиданиеНеНормальногоДавления{
 1124          	ЕСЛИ ((К_ВОЗД_ПОД_Р_НЕ_КРИТИЧЕСКОЕ == ВЫКЛ) ||
 1125          				(К_ВОЗД_ПОД_Р_РАБОЧЕЕ != ВКЛ)) В СОСТ Начало;	
 1126           }
 1127           СОСТ НизкоеДавление{
 1128              ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_ДАВЛЕНИЕ_НИЖЕ_НОРМЫ)) 	В СОСТ ОжиданиеНеНизкогоДавления;
 1129              ИНАЧЕ В СОСТ Начало;
 1130           }	
 1131           СОСТ ОжиданиеНеНизкогоДавления{
 1132          	ЕСЛИ ((К_ВОЗД_ПОД_Р_НЕ_КРИТИЧЕСКОЕ == ВЫКЛ) ||
 1133          				(К_ВОЗД_ПОД_Р_РАБОЧЕЕ == ВКЛ)) В СОСТ Начало;	
 1134          	ТАЙМАУТ ОДНА_МИНУТА В СОСТ Начало;			
 1135           }
 1136           СОСТ Авария{
 1137              ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_БЛОКИРОВКА_КОМАНД_ПЕРЕМЕЩЕНИЯ) &&
 1138          	       SendMsgGUICode(СУАБ2ФИК_ДАВЛЕНИЕ_АВАРИЙНОЕ)) {	
 1139          		В СОСТ ОжиданиеНеАварии;
 1140          	} ИНАЧЕ В СОСТ Начало;    
 1141           }	
 1142           СОСТ ОжиданиеНеАварии{
 1143          	ЕСЛИ (К_ВОЗД_ПОД_Р_НЕ_КРИТИЧЕСКОЕ == ВКЛ) {
 1144          		ЕСЛИ (ПРОЦ ПроверкаИсправностиВоздушнойПодушки В СОСТ ПАССИВНОЕ) 
 1145          			СТАРТ ПРОЦ ПроверкаИсправностиВоздушнойПодушки;
 1146          		В СОСТ Начало;	
 1147          	}	
 1148           }
 1149          }   /* конец ПРОЦ "КонтрольДавления   */	
 1150          
 1151          	
 1152          /*================================================*/
 1153          /*=                                              =*/
 1154          /*=      контроль давления  				     =*/
 1155          /*=                                              =*/
 1156          /*================================================*/
 1157          ПРОЦ КонтрольАварииДавления{
 1158           ИЗ ПРОЦ Инициализация 	К_ВОЗД_ПОД_Р_НЕ_КРИТИЧЕСКОЕ,		/*		было критическое		*/
 1159          						К_ВОЗД_ПОД_Р_РАБОЧЕЕ;  				/*		было норма		*/
 1160           СОСТ Начало{
 1161          	В СОСТ ОжиданиеНеНормальногоДавления; /*по умолчанию */
 1162          	ЕСЛИ ((К_ВОЗД_ПОД_Р_НЕ_КРИТИЧЕСКОЕ == ВКЛ) &&
 1163          				(К_ВОЗД_ПОД_Р_РАБОЧЕЕ != ВКЛ)) В СОСТ ОжиданиеНеНизкогоДавления;	/*		было критическое		*/
 1164          	ЕСЛИ (К_ВОЗД_ПОД_Р_НЕ_КРИТИЧЕСКОЕ == ВЫКЛ) В СОСТ Авария;		/*	давление ниже критического	-- авария */
 1165           }	
 1166            СОСТ ОжиданиеНеНормальногоДавления{
 1167          	ЕСЛИ ((К_ВОЗД_ПОД_Р_НЕ_КРИТИЧЕСКОЕ == ВЫКЛ) ||
 1168          				(К_ВОЗД_ПОД_Р_РАБОЧЕЕ != ВКЛ)) В СОСТ Начало;	
 1169           }
 1170           СОСТ ОжиданиеНеНизкогоДавления{
 1171          	ЕСЛИ ((К_ВОЗД_ПОД_Р_НЕ_КРИТИЧЕСКОЕ == ВЫКЛ) ||
 1172          				(К_ВОЗД_ПОД_Р_РАБОЧЕЕ == ВКЛ)) В СОСТ Начало;	
 1173          	ТАЙМАУТ ОДНА_МИНУТА В СОСТ Начало;			
 1174           }
 1175           СОСТ Авария{
 1176          	ЕСЛИ (ПРОЦ ОТМЕНА В СОСТ ПАССИВНОЕ) СТАРТ ПРОЦ ОТМЕНА; /* останов вращения/перемещения */
 1177              ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_ДАВЛЕНИЕ_АВАРИЙНОЕ)) {	
 1178          		В СОСТ ОжиданиеНеАварии;
 1179          	} ИНАЧЕ В СОСТ Начало;
 1180           }	
 1181           СОСТ ОжиданиеНеАварии{
 1182          	ЕСЛИ (К_ВОЗД_ПОД_Р_НЕ_КРИТИЧЕСКОЕ == ВКЛ) В СОСТ Начало;	
 1183           }
 1184          }   /* конец ПРОЦ "КонтрольДавления   */	
 1185          
 1186          /*================================================*/
 1187          /*=                                              =*/
 1188          /*=      контроль вакуума  	    			     =*/
 1189          /*=                                              =*/
 1190          /*================================================*/
 1191          ПРОЦ КонтрольВакуума{		
 1192           ИЗ ПРОЦ Инициализация 	К_ДИСК_РАЗЖАТ;  				/*		было норма		*/
 1193          	СОСТ Начало{
 1194                ЕСЛИ (К_ДИСК_РАЗЖАТ == ВЫКЛ) В СОСТ ВакуумНорма;      /* есть давление*/
 1195                ИНАЧЕ                В СОСТ НедостаточныйВакуум;
 1196          	}
 1197           СОСТ ВакуумНорма{
 1198                ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_ДИСК_ЗАЖАТ)) 	В СОСТ ОжиданиеНедостаточногоВакуума;
 1199                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;
 1200           }
 1201           СОСТ НедостаточныйВакуум{
 1202                ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_ДИСК_РАЗЖАТ)) 	В СОСТ ОжиданиеНормальногоВакуума;
 1203                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;
 1204           }
 1205          
 1206           СОСТ ОжиданиеНедостаточногоВакуума{
 1207                ЕСЛИ (К_ДИСК_РАЗЖАТ == ВКЛ) В СОСТ НедостаточныйВакуум;
 1208           }
 1209           СОСТ ОжиданиеНормальногоВакуума {
 1210                ЕСЛИ (К_ДИСК_РАЗЖАТ == ВЫКЛ) В СОСТ ВакуумНорма;
 1211           } 
 1212          /*= НЕНОРМАЛЬНЫЕ СИТУАЦИИ: ================*/
 1213           СОСТ НарушениеСвязи {
 1214              В СОСТ Начало;
 1215           } 
 1216          }   /* конец ПРОЦ "КонтрольВакуума   */	
 1217          
 1218          /*================================================*/
 1219          /*=                                              =*/
 1220          /*=      контроль вакуума  	    			     =*/
 1221          /*=                                              =*/
 1222          /*================================================*/
 1223          ПРОЦ КонтрольАварииВакуума{		
 1224           ИЗ ПРОЦ Инициализация 	К_ДИСК_РАЗЖАТ;  				/*		было норма		*/
 1225          	СОСТ Начало{
 1226                ЕСЛИ (К_ДИСК_РАЗЖАТ == ВЫКЛ) В СОСТ КонтрольАварииВакуума;    /* есть вакуум*/
 1227                ИНАЧЕ В СЛЕДУЮЩЕЕ;
 1228          	}
 1229           
 1230           СОСТ АварияВакуума{
 1231                ЕСЛИ (ПРОЦ ОТМЕНА В СОСТ ПАССИВНОЕ) СТАРТ ПРОЦ ОТМЕНА; /* останов вращения/перемещения */
 1232                ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_АВАРИЙНОЕ_РАЗЖАТИЕ_ДИСКА)) 	ОШИБКА;
 1233                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО ОШИБКА;
 1234           }
 1235          
 1236           СОСТ КонтрольАварииВакуума{
 1237                ЕСЛИ (К_ДИСК_РАЗЖАТ == ВКЛ) В СОСТ АварияВакуума;
 1238           }
 1239          }   /* конец ПРОЦ "КонтрольАварииВакуума   */	
 1240          
 1241          
 1242          /*================================================*/
 1243          /*=                                              =*/
 1244          /*=      КонтрольСвязи_сМОХА1212  			     =*/
 1245          /*=     МОХА отвечает за лазер                   =*/
 1246          /*================================================*/
 1247          ПРОЦ КонтрольСвязи_сМОХА1212{
 1248           ИЗ ПРОЦ Инициализация 	ФлагСвязиМоха1212;	
 1249          	СОСТ Начало{
 1250          		ЕСЛИ (ФлагСвязиМоха1212 == ВКЛ) В СОСТ ЕстьСвязьМоха1212;
 1251          		ЕСЛИ (ФлагСвязиМоха1212 == ВЫКЛ) В СОСТ НетСвязиМоха1212;	
 1252          	}
 1253          	СОСТ ЕстьСвязьМоха1212{
 1254                ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_ЕСТЬ_СВЯЗЬ_С_МОХА1212)) 	В СОСТ ОжиданиеРазрываСвязи;
 1255                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;		
 1256          	}
 1257          	СОСТ НетСвязиМоха1212{
 1258          	  ЕСЛИ (ПРОЦ ОТМЕНА В СОСТ ПАССИВНОЕ) СТАРТ ПРОЦ ОТМЕНА;      /* останов вращения/перемещения */	
 1259                ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_НЕТ_СВЯЗИ_С_МОХА1212)) 	В СОСТ ОжиданиеВосстановленияСвязи;
 1260                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;		
 1261          	}	
 1262           СОСТ ОжиданиеРазрываСвязи{
 1263                ЕСЛИ (ФлагСвязиМоха1212 == ВЫКЛ) В СОСТ НетСвязиМоха1212;
 1264           }	
 1265           СОСТ ОжиданиеВосстановленияСвязи{
 1266                ЕСЛИ (ФлагСвязиМоха1212 == ВКЛ) В СОСТ ЕстьСвязьМоха1212;
 1267           } 
 1268           СОСТ НарушениеСвязи {
 1269              В СОСТ Начало;
 1270           } 	
 1271          }   /* конец ПРОЦ КонтрольСвязи_сМОХА1212   */	
 1272          /*================================================*/
 1273          /*=                                              =*/
 1274          /*=      КонтрольСвязи_сМОХА1214  			     =*/
 1275          /*=     отвечает за давление и вакуум            =*/
 1276          /*================================================*/
 1277          ПРОЦ КонтрольСвязи_сМОХА1214{
 1278           ИЗ ПРОЦ Инициализация 	ФлагСвязиМоха1214;  				
 1279          	СОСТ Начало{
 1280          		ЕСЛИ (ФлагСвязиМоха1214 == ВКЛ) В СОСТ ЕстьСвязьМоха1214;
 1281          		ЕСЛИ (ФлагСвязиМоха1214 == ВЫКЛ) В СОСТ НетСвязиМоха1214;	
 1282          	}
 1283          	СОСТ ЕстьСвязьМоха1214{
 1284                ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_ЕСТЬ_СВЯЗЬ_С_МОХА1214)) 	В СОСТ ОжиданиеРазрываСвязи;
 1285                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;		
 1286          	}
 1287          	СОСТ НетСвязиМоха1214{
 1288          	  ЕСЛИ (ПРОЦ ОТМЕНА В СОСТ ПАССИВНОЕ) СТАРТ ПРОЦ ОТМЕНА;      /* останов вращения/перемещения */	
 1289                ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_НЕТ_СВЯЗИ_С_МОХА1214)) 	В СОСТ ОжиданиеВосстановленияСвязи;
 1290                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;		
 1291          	}	
 1292           СОСТ ОжиданиеРазрываСвязи{
 1293                ЕСЛИ (ФлагСвязиМоха1214 == ВЫКЛ) В СОСТ НетСвязиМоха1214;
 1294           }	
 1295           СОСТ ОжиданиеВосстановленияСвязи{
 1296                ЕСЛИ (ФлагСвязиМоха1214 == ВКЛ) В СОСТ ЕстьСвязьМоха1214;
 1297           } 
 1298           СОСТ НарушениеСвязи {
 1299              В СОСТ Начало;
 1300           } 		
 1301          }   /* конец ПРОЦ КонтрольСвязи_сМОХА1214   */	
 1302          /*================================================*/
 1303          /*=                                              =*/
 1304          /*=      КонтрольДистанционного  			     =*/
 1305          /*=     управления  1212 (через программу)       =*/
 1306          /*================================================*/
 1307          ПРОЦ КонтрольДистанционного1212{
 1308           ИЗ ПРОЦ Инициализация 	К_1212_ДИСТАНЦИОННОЕ;  				
 1309          	СОСТ Начало{
 1310          		ЕСЛИ (К_1212_ДИСТАНЦИОННОЕ) В СОСТ ЕстьДист1212;
 1311          		ИНАЧЕ В СОСТ НетДист1212;
 1312          	}	
 1313          	СОСТ ЕстьДист1212{
 1314                ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_ЕСТЬ_ДИСТАНЦИОННОЕ_УПРАВЛЕНИЕ_1212)) 	В СОСТ ОжиданиеНедистанционного;
 1315                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;		
 1316          	}
 1317          	СОСТ НетДист1212{
 1318          	  ЕСЛИ (ПРОЦ ОТМЕНА В СОСТ ПАССИВНОЕ) СТАРТ ПРОЦ ОТМЕНА;      /* останов вращения/перемещения */	
 1319                ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_НЕТ_ДИСТАНЦИОННОГО_УПРАВЛЕНИЯ_1212)) 	В СОСТ ОжиданиеДистанционного;
 1320                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;		
 1321          	}	
 1322           СОСТ ОжиданиеНедистанционного{
 1323                ЕСЛИ (К_1212_ДИСТАНЦИОННОЕ == ВЫКЛ) В СОСТ НетДист1212;
 1324           }	
 1325           СОСТ ОжиданиеДистанционного{
 1326                ЕСЛИ (К_1212_ДИСТАНЦИОННОЕ == ВКЛ) В СОСТ ЕстьДист1212;
 1327           } 
 1328           СОСТ НарушениеСвязи {
 1329              В СОСТ Начало;
 1330           } 
 1331          }   /* конец ПРОЦ КонтрольДистанционного1212   */	
 1332          
 1333          
 1334          /*================================================*/
 1335          /*=                                              =*/
 1336          /*=      КонтрольДистанционного  			     =*/
 1337          /*=     управления  1214 (через программу)       =*/
 1338          /*================================================*/
 1339          ПРОЦ КонтрольДистанционного1214{
 1340           ИЗ ПРОЦ Инициализация 	К_1214_ДИСТАНЦИОННОЕ; 
 1341          	СОСТ Начало{
 1342          		ЕСЛИ (К_1214_ДИСТАНЦИОННОЕ) В СОСТ ЕстьДист1214;
 1343          		ИНАЧЕ В СОСТ НетДист1214;
 1344          	}	
 1345          	СОСТ ЕстьДист1214{
 1346                ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_ЕСТЬ_ДИСТАНЦИОННОЕ_УПРАВЛЕНИЕ_1214)) 	В СОСТ ОжиданиеНедистанционного;
 1347                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;		
 1348          	}
 1349          	СОСТ НетДист1214{
 1350          	  ЕСЛИ (ПРОЦ ОТМЕНА В СОСТ ПАССИВНОЕ) СТАРТ ПРОЦ ОТМЕНА;      /* останов вращения/перемещения */	
 1351                ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_НЕТ_ДИСТАНЦИОННОГО_УПРАВЛЕНИЯ_1214)) 	В СОСТ ОжиданиеДистанционного;
 1352                ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ НарушениеСвязи;		
 1353          	}	
 1354           СОСТ ОжиданиеНедистанционного{
 1355                ЕСЛИ (К_1214_ДИСТАНЦИОННОЕ == ВЫКЛ) В СОСТ НетДист1214;
 1356           }	
 1357           СОСТ ОжиданиеДистанционного{
 1358                ЕСЛИ (К_1214_ДИСТАНЦИОННОЕ == ВКЛ) В СОСТ ЕстьДист1214;
 1359           } 
 1360            СОСТ НарушениеСвязи {
 1361              В СОСТ Начало;
 1362           } 
 1363          }   /* конец ПРОЦ КонтрольДистанционного1214   */
 1364          
 1365          /*================================================*/
 1366          /*=                                              =*/
 1367          /*=      РАЗБЛОКИРОВКА_КОМАНД_ПЕРЕМЕЩЕНИЯ		     =*/
 1368          /*=   на ГПИ и ОСТАНОВ перемещений 			     =*/
 1369          /*================================================*/
 1370          ПРОЦ РАЗБЛОКИРОВКА_КОМАНД_ПЕРЕМЕЩЕНИЯ{
 1371          	СОСТ Начало{
 1372          		СТАРТ ПРОЦ ОТМЕНА;
 1373          		В СЛЕДУЮЩЕЕ;
 1374          	}	
 1375          СОСТ СообщениеГИО{
 1376              ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_РАЗБЛОКИРОВКА_КОМАНД_ПЕРЕМЕЩЕНИЯ)) В СЛЕДУЮЩЕЕ;
 1377               ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ Конец;
 1378           }
 1379          
 1380           СОСТ Конец{
 1381              СТОП;
 1382           }
 1383          
 1384          }/*================================================*/
 1385          /*=                                              =*/
 1386          /*=      БЛОКИРОВКА_КОМАНД_ПЕРЕМЕЩЕНИЯ		     =*/
 1387          /*=   на ГПИ и ОСТАНОВ перемещений 			     =*/
 1388          /*================================================*/
 1389          ПРОЦ БЛОКИРОВКА_КОМАНД_ПЕРЕМЕЩЕНИЯ{
 1390          	СОСТ Начало{
 1391          		СТАРТ ПРОЦ ОТМЕНА;
 1392          		В СЛЕДУЮЩЕЕ;
 1393          	}	
 1394          СОСТ СообщениеГИО{
 1395              ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_БЛОКИРОВКА_КОМАНД_ПЕРЕМЕЩЕНИЯ)) В СЛЕДУЮЩЕЕ;
 1396               ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ Конец;
 1397           }
 1398          
 1399           СОСТ Конец{
 1400              СТОП;
 1401           }
 1402          }
 1403          /*================================================*/
 1404          /*=                                              =*/
 1405          /*=      ОТМЕНА 							     =*/
 1406          /*=   останов вращения/перемещения 			     =*/
 1407          /*================================================*/
 1408          ПРОЦ ОТМЕНА{
 1409          /* ИЗ ПРОЦ Инициализация 	;  	*/			
 1410          	СОСТ Начало{
 1411          /*		?????????????		*/
 1412          		СТОП;
 1413          	}	
 1414          }   /* конец ПРОЦ ОТМЕНА   */
 1415          
 1416          /*================================================*/
 1417          /*=                                              =*/
 1418          /*=      КОНЕЦ_РАБОТЫ						     =*/
 1419          /*=     									     =*/
 1420          /*================================================*/
 1421          ПРОЦ КОНЕЦ_РАБОТЫ{
 1422          ИЗ ПРОЦ Инициализация ТекущийРежим;
 1423          	СОСТ Начало{
 1424          		ТекущийРежим = РЕЖИМ_КОНЕЦ_РАБОТЫ;
 1425          		СТОП ПРОЦ Режим_РР;
 1426          			
 1427          		СТАРТ ПРОЦ ВЫКЛ_ЛАЗЕРА;
 1428          		СТАРТ ПРОЦ ВЫКЛ_ПОДСВЕТКУ_ДИСКА;
 1429          		СТАРТ ПРОЦ КАРЕТКУ_В_ПОЛОЖЕНИЕ_УСТАНОВКИ_ДИСКА;
 1430          		СТАРТ ПРОЦ СТОП_ВРАЩЕНИЯ_ПРЕДМЕТНОГО_СТОЛИКА;
 1431          
 1432          /*		ВЫКЛ_АКТИВНОЕ_ПОЗИЦИОНИРОВАНИЕ_ПО_ВРАЩЕНИЮ   ???????	*/
 1433          		
 1434          			
 1435          		СТОП ПРОЦ КонтрольСвязи_сМОХА1212;
 1436          		СТОП ПРОЦ КонтрольСвязи_сМОХА1214;
 1437          		СТОП ПРОЦ КонтрольДистанционного1212;
 1438          		СТОП ПРОЦ КонтрольДистанционного1214;
 1439          		СТОП ПРОЦ КонтрольИзмененияЗаданий_ЗД_R_КАРЕТКИ;
 1440          		СТОП ПРОЦ КонтрольИзмененияЗаданий_ЗД_W_ПРЕДМЕТНОГО_СТОЛИКА;
 1441          		СТОП ПРОЦ КонтрольИзменения_ФП_R_КАРЕТКИ;
 1442          		СТОП ПРОЦ КонтрольИзменения_ФП_W_ПРЕДМЕТНОГО_СТОЛИКА;
 1443          		
 1444          		В СЛЕДУЮЩЕЕ;
 1445          	}
 1446           СОСТ ПроверкаПриходаВИсходное{
 1447              ЕСЛИ (
 1448          	
 1449                  !( ПРОЦ ВЫКЛ_ЛАЗЕРА     В СОСТ АКТИВНОЕ) &&
 1450          		!( ПРОЦ ВЫКЛ_ПОДСВЕТКУ_ДИСКА   В СОСТ АКТИВНОЕ)  &&
 1451          		!( ПРОЦ КАРЕТКУ_В_ПОЛОЖЕНИЕ_УСТАНОВКИ_ДИСКА     В СОСТ АКТИВНОЕ) &&
 1452          		!( ПРОЦ СТОП_ВРАЩЕНИЯ_ПРЕДМЕТНОГО_СТОЛИКА   В СОСТ АКТИВНОЕ)  
 1453                    ) В СЛЕДУЮЩЕЕ;
 1454           }
 1455          
 1456           СОСТ СообщениеГИО{
 1457              ЕСЛИ (SendMsgGUICode(СУАБ2ФИК_УСТАНОВКА_ГОТОВА_К_ВЫКЛЮЧЕНИЮ)) В СЛЕДУЮЩЕЕ;
 1458               ТАЙМАУТ ТАЙМАУТ_НА_СВЯЗЬ_С_ГИО В СОСТ Конец;
 1459           }
 1460          
 1461           СОСТ Конец{
 1462              СТОП;
 1463           }
 1464          
 1465          	
 1466          }   /* конец ПРОЦ КОНЕЦ_РАБОТЫ   */
 1467          
 1468          /*==============================================================*/
 1469          /*=                                                            =*/
 1470          /*=      Перевести каретку в центр вращения					    =*/
 1471          /*=     									                   =*/
 1472          /*==============================================================*/
 1473          ПРОЦ КАРЕТКУ_В_ЦЕНТР_ВРАЩЕНИЯ{
 1474           ИЗ ПРОЦ Инициализация 	ЗД_R_КАРЕТКИ,
 1475          						ФП_R_КАРЕТКИ;  				
 1476          	СОСТ Начало{
 1477          /*		?????????????		*/
 1478          		СТОП;
 1479          	}	
 1480          }   /* конец ПРОЦ КАРЕТКУ_В_ЦЕНТР_ВРАЩЕНИЯ   */
 1481          
 1482          /*===========================================================*/
 1483          /*=                                                         =*/
 1484          /*=      Перевести каретку в ЗАДАННЫЙ РАДИУС			    =*/
 1485          /*=     									                =*/
 1486          /*===========================================================*/
 1487          ПРОЦ КАРЕТКУ_В_ЗАДАННЫЙ_РАДИУС{
 1488           ИЗ ПРОЦ Инициализация 	ЗД_R_КАРЕТКИ,
 1489          						ФП_R_КАРЕТКИ;  				
 1490          	СОСТ Начало{
 1491          /*		?????????????		*/
 1492          		СТОП;
 1493          	}	
 1494          }   /* конец ПРОЦ КАРЕТКУ_В_ЗАДАННЫЙ_РАДИУС   */
 1495          
 1496          /*===========================================================*/
 1497          /*=                                                         =*/
 1498          /*=      Перевести каретку в ЗАДАННЫЙ РАДИУС			    =*/
 1499          /*=     									                =*/
 1500          /*===========================================================*/
 1501          ПРОЦ СТОП_КАРЕТКИ{
 1502           ИЗ ПРОЦ Инициализация 	ЗД_R_КАРЕТКИ,
 1503          						ФП_R_КАРЕТКИ;  				
 1504          	СОСТ Начало{
 1505          /*		?????????????		*/
 1506          		СТОП;
 1507          	}	
 1508          }   /* конец ПРОЦ СТОП_КАРЕТКИ   */
 1509          
 1510          
 1511          /*==============================================================*/
 1512          /*=                                                            =*/
 1513          /*=      Перевести каретку в положение установки диска         =*/
 1514          /*=     									                   =*/
 1515          /*==============================================================*/
 1516          ПРОЦ КАРЕТКУ_В_ПОЛОЖЕНИЕ_УСТАНОВКИ_ДИСКА{
 1517           ИЗ ПРОЦ Инициализация 	ЗД_R_КАРЕТКИ,
 1518          						ФП_R_КАРЕТКИ;  				
 1519          	СОСТ Начало{
 1520          /*		?????????????		*/
 1521          		СТОП;
 1522          	}	
 1523          }   /* конец ПРОЦ КАРЕТКУ_В_ПОЛОЖЕНИЕ_УСТАНОВКИ_ДИСКА   */
 1524          
 1525          /*==============================================================*/
 1526          /*=                                                            =*/
 1527          /*=      Включить активное позиционирование по вращению        =*/
 1528          /*=     									                   =*/
 1529          /*==============================================================*/
 1530          ПРОЦ ВКЛ_АКТИВНОЕ_ПОЗИЦИОНИРОВАНИЕ_ПО_ВРАЩЕНИЮ{
 1531           ИЗ ПРОЦ Инициализация 	К_1214_ДИСТАНЦИОННОЕ;  				
 1532          	СОСТ Начало{
 1533          /*		?????????????	Команда F????	*/
 1534          		СТОП;
 1535          	}	
 1536          }   /* конец ПРОЦ ВКЛ_АКТИВНОЕ_ПОЗИЦИОНИРОВАНИЕ_ПО_ВРАЩЕНИЮ   */
 1537          
 1538          /*==============================================================*/
 1539          /*=                                                            =*/
 1540          /*=      Выключить активное позиционирование по вращению        =*/
 1541          /*=     									                   =*/
 1542          /*==============================================================*/
 1543          ПРОЦ ВЫКЛ_АКТИВНОЕ_ПОЗИЦИОНИРОВАНИЕ_ПО_ВРАЩЕНИЮ{
 1544           ИЗ ПРОЦ Инициализация 	К_1214_ДИСТАНЦИОННОЕ;  				
 1545          	СОСТ Начало{
 1546          /*		?????????????		*/
 1547          		СТОП;
 1548          	}	
 1549          }   /* конец ПРОЦ "ВЫКЛ_АКТИВНОЕ_ПОЗИЦИОНИРОВАНИЕ_ПО_ВРАЩЕНИЮ   */
 1550          
 1551          /*==============================================================*/
 1552          /*=                                                            =*/
 1553          /*=      Включить вращение предметного столика        =*/
 1554          /*=     									                   =*/
 1555          /*==============================================================*/
 1556          ПРОЦ ВКЛ_ВРАЩЕНИЕ_ПРЕД_СТОЛИКА_В_ЗД_W{
 1557           ИЗ ПРОЦ Инициализация 	ЗД_W_ПРЕДМЕТНОГО_СТОЛИКА,
 1558          						ФП_W_ПРЕДМЕТНОГО_СТОЛИКА;  				
 1559          	СОСТ Начало{
 1560          /*		?????????????		*/
 1561          		СТОП;
 1562          	}	
 1563          }   /* конец ПРОЦ ВКЛ_ВРАЩЕНИЕ_ПРЕД_СТОЛИКА_В_ЗД_W   */
 1564          
 1565          /*==============================================================*/
 1566          /*=                                                            =*/
 1567          /*=      Выключить вращение предметного столика        =*/
 1568          /*=     									                   =*/
 1569          /*==============================================================*/
 1570          ПРОЦ СТОП_ВРАЩЕНИЯ_ПРЕДМЕТНОГО_СТОЛИКА{
 1571           ИЗ ПРОЦ Инициализация 	ЗД_W_ПРЕДМЕТНОГО_СТОЛИКА,
 1572          						ФП_W_ПРЕДМЕТНОГО_СТОЛИКА;  				
 1573          	СОСТ Начало{
 1574          /*		?????????????		*/
 1575          		СТОП;
 1576          	}	
 1577          }   /* конец ПРОЦ СТОП_ВРАЩЕНИЯ_ПРЕДМЕТНОГО_СТОЛИКА   */
 1578          
 1579          } /* конец программы */
%RCSL-I-SUMMARY, Completed with 0 error(s).
%RCSL-I-SUMMARY, Completed with 0 warning(s).

 %RCSL-I-SUMMARY, Completed with 0 error(s).