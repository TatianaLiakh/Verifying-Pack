Прогр АЛГОРИТМ {
/* Стенд #1 Автоматизированная электросушилка
Внимание! Период активизации гиперпроцесса равен 100 миллисекундам */

ТАКТ 50;
КОНСТ ВКЛ                1;
КОНСТ ВЫКЛ               0;

/*Коды сообщений от оператора */ 
ПЕРЕЧИСЛЕНИЕ {
	КОМ2АУ_В_РУЧНОЕ_УПРАВЛЕНИЕ,
	КОМ2АУ_ОТКЛЮЧИТЬ_РУЧНОЕ_УПРАВЛЕНИЕ,
	КОМ2АУ_ВКЛЮЧИТЬ_СУШИЛКУ,
	КОМ2АУ_ВЫКЛЮЧИТЬ_СУШИЛКУ
};

/*Коды сообщений к оператору */ 
ПЕРЕЧИСЛЕНИЕ 
{
	АУ2ГУИ_ЕСТЬ_СУШИЛКА_В_РУЧНОЕ_УПРАВЛЕНИЕ,
	АУ2ГУИ_ЕСТЬ_ОТКЛЮЧИТЬ_РУЧНОЕ_УПРАВЛЕНИЕ,
	АУ2ГУИ_СУШИЛКА_ВЫКЛЮЧЕНА,
	АУ2ГУИ_СУШИЛКА_ВКЛЮЧЕНА
};

/*сделать возможность включения заголовков*/
ФУНКЦИЯ ЦЕЛ GetNextMsgGUI(ПУСТО);

ФУНКЦИЯ ЦЕЛ  GetMsgGUICode        (ПУСТО);  /*чтение из памяти кода события */
ФУНКЦИЯ ПЛАВ GetFloatParamGUI     (ПУСТО);  /*чтение из памяти параметра события  используется */
/* ФУНКЦИЯ КЦЕЛ GetShortParamGUI     (ПУСТО); */
ФУНКЦИЯ ЦЕЛ  GetIntParamGUI       (ПУСТО);  /*чтение с экрана гуи - не исползуется */
ФУНКЦИЯ ДЦЕЛ GetLongParamGUI      (ПУСТО);  /*чтение с экрана гуи - исползуется */

ФУНКЦИЯ ЦЕЛ  SendMsgGUICode       (ЦЕЛ);
ФУНКЦИЯ ЦЕЛ  SendMsgFloatParamGUI (ЦЕЛ, ПЛАВ);
ФУНКЦИЯ ЦЕЛ  SendMsgLongParamGUI  (ЦЕЛ, ДЦЕЛ);

ВХОД  ЛОГ_ВХОДЫ1  0 0 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
ВХОД  ЛОГ_ВХОДЫ2  0 1 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
ВЫХОД ЛОГ_ВЫХОДЫ1 1 0 8;
ВЫХОД ЛОГ_ВЫХОДЫ2 1 1 8;

ПРОЦ Инициализация
{
/* ВХОДНЫЕ СИГНАЛЫ: */
ЦЕЛ ЦелоеЗначение = {ЛОГ_ВХОДЫ1[5]} ДЛЯ ВСЕХ;
 ЛОГ К_РУКИ_ПОД_СУШИЛКОЙ    = {ЛОГ_ВХОДЫ1[1]} ДЛЯ ВСЕХ;
 
 /*Флаги*/
	ЛОГ ФлагРучноеУправление ДЛЯ ВСЕХ;


/* ВЫХОДНЫЕ СИГНАЛЫ (т.к. привязаны к модулю выходов): */ 
 ЛОГ У_ВКЛ_СУШИЛКУ = {ЛОГ_ВЫХОДЫ1[1]} ДЛЯ ВСЕХ;
 
 
 /*ПЛАВ Температура = {ЛОГ_ВХОДЫ2  []} ДЛЯ ВСЕХ; */ 

/*########  СОСТОЯНИЯ ПРОЦЕССА  #########*/
 СОСТ Начало{  /* NB: 1-е f-сост. 1-го проц. - активно по включению питания */
	СТАРТ ПРОЦ ЧтениеКольцевогоБуфера;
	В СОСТ Работа;   
 }
 СОСТ Работа
 {
   ЕСЛИ (К_РУКИ_ПОД_СУШИЛКОЙ == ВКЛ  && ФлагРучноеУправление == ВЫКЛ) 
   { 
		SendMsgGUICode(АУ2ГУИ_СУШИЛКА_ВЫКЛЮЧЕНА);
     У_ВКЛ_СУШИЛКУ = ВКЛ;
     В СЛЕДУЮЩЕЕ;
	 }
	 ИНАЧЕ ЕСЛИ (К_РУКИ_ПОД_СУШИЛКОЙ == ВЫКЛ  && ФлагРучноеУправление == ВЫКЛ)
		У_ВКЛ_СУШИЛКУ = ВЫКЛ;
 }
 СОСТ Сушка{  
  ЕСЛИ (ФлагРучноеУправление == ВЫКЛ && К_РУКИ_ПОД_СУШИЛКОЙ == ВКЛ) В СОСТ Сушка;
  ТАЙМАУТ 12 В СОСТ Работа; 
 }
} /* \ПРОЦ */

/*==============================================*/
/*==============================================*/
/*=                                            =*/
/*=      ПРОЦЕСС ЧтениеКольцевогоБуфера        =*/
/*=                                            =*/
/*==============================================*/
/*==============================================*/
ПРОЦ ЧтениеКольцевогоБуфера{  
ИЗ ПРОЦ Инициализация ФлагРучноеУправление, У_ВКЛ_СУШИЛКУ; 
/* */
ЦЕЛ КодСообщенияОтГуи ЛОКАЛ;
 СОСТ Начало{
	SendMsgGUICode(АУ2ГУИ_ЕСТЬ_СУШИЛКА_В_РУЧНОЕ_УПРАВЛЕНИЕ);
    /*  читаем код и параметр события из кольцевого буфера в структуру */
    ЕСЛИ (GetNextMsgGUI()) 
	{
		КодСообщенияОтГуи = GetMsgGUICode();
		ЕСЛИ (КодСообщенияОтГуи == КОМ2АУ_В_РУЧНОЕ_УПРАВЛЕНИЕ)
		{
			ФлагРучноеУправление = ВКЛ;
			SendMsgGUICode(АУ2ГУИ_ЕСТЬ_СУШИЛКА_В_РУЧНОЕ_УПРАВЛЕНИЕ);
		}
		ИНАЧЕ	ЕСЛИ (КодСообщенияОтГуи == КОМ2АУ_ОТКЛЮЧИТЬ_РУЧНОЕ_УПРАВЛЕНИЕ)
		{
			ФлагРучноеУправление = ВКЛ;
			SendMsgGUICode(АУ2ГУИ_ЕСТЬ_ОТКЛЮЧИТЬ_РУЧНОЕ_УПРАВЛЕНИЕ);
		}
		ИНАЧЕ ЕСЛИ (КодСообщенияОтГуи == КОМ2АУ_ВКЛЮЧИТЬ_СУШИЛКУ && ФлагРучноеУправление == ВКЛ)
		{
			У_ВКЛ_СУШИЛКУ = ВКЛ;
			SendMsgGUICode(АУ2ГУИ_СУШИЛКА_ВКЛЮЧЕНА);
		}
		ИНАЧЕ ЕСЛИ (КодСообщенияОтГуи == КОМ2АУ_ВЫКЛЮЧИТЬ_СУШИЛКУ && ФлагРучноеУправление == ВКЛ)
		{
			У_ВКЛ_СУШИЛКУ = ВЫКЛ;
			SendMsgGUICode(АУ2ГУИ_СУШИЛКА_ВЫКЛЮЧЕНА);			
		}
	}
	ЗАЦИКЛИТЬ;
}
}
	

}  /* \Прогр */



