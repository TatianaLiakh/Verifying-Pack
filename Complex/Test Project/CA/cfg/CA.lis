    1          Прогр АЛГОРИТМ {
    2          /* Стенд #1 Автоматизированная электросушилка
    3          Внимание! Период активизации гиперпроцесса равен 100 миллисекундам */
    4          
    5          ТАКТ 50;
    6          КОНСТ ВКЛ                1;
    7          КОНСТ ВЫКЛ               0;
    8          
    9          /*Коды сообщений от оператора */ 
   10          ПЕРЕЧИСЛЕНИЕ {
   11          	АУ2ГУИ_В_РУЧНОЕ_УПРАВЛЕНИЕ,
   12          	АУ2ГУИ_ОТКЛЮЧИТЬ_РУЧНОЕ_УПРАВЛЕНИЕ,
   13          	АУ2ГУИ_ВКЛЮЧИТЬ_СУШИЛКУ,
   14          	АУ2ГУИ_ВЫКЛЮЧИТЬ_СУШИЛКУ
   15          };
   16          
   17          /*Коды сообщений к оператору */ 
   18          ПЕРЕЧИСЛЕНИЕ 
   19          {
   20          	КОМ2АУ_ЕСТЬ_СУШИЛКА_В_РУЧНОЕ_УПРАВЛЕНИЕ,
   21          	КОМ2АУ_ЕСТЬ_ОТКЛЮЧИТЬ_РУЧНОЕ_УПРАВЛЕНИЕ,
   22          	КОМ2АУ_СУШИЛКА_ВЫКЛЮЧЕНА,
   23          	КОМ2АУ_СУШИЛКА_ВКЛЮЧЕНА
   24          };
   25          
   26          /*сделать возможность включения заголовков*/
   27          ФУНКЦИЯ ЦЕЛ GetNextMsgGUI(ПУСТО);
   28          
   29          ФУНКЦИЯ ЦЕЛ  GetMsgGUICode        (ПУСТО);  /*чтение из памяти кода события */
   30          ФУНКЦИЯ ПЛАВ GetFloatParamGUI     (ПУСТО);  /*чтение из памяти параметра события  используется */
   31          /* ФУНКЦИЯ КЦЕЛ GetShortParamGUI     (ПУСТО); */
   32          ФУНКЦИЯ ЦЕЛ  GetIntParamGUI       (ПУСТО);  /*чтение с экрана гуи - не исползуется */
   33          ФУНКЦИЯ ДЦЕЛ GetLongParamGUI      (ПУСТО);  /*чтение с экрана гуи - исползуется */
   34          
   35          ФУНКЦИЯ ЦЕЛ  SendMsgGUICode       (ЦЕЛ);
   36          ФУНКЦИЯ ЦЕЛ  SendMsgFloatParamGUI (ЦЕЛ, ПЛАВ);
   37          ФУНКЦИЯ ЦЕЛ  SendMsgLongParamGUI  (ЦЕЛ, ДЦЕЛ);
   38          
   39          ВХОД  ЛОГ_ВХОДЫ1  0 0 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
   40          ВХОД  ЛОГ_ВХОДЫ2  0 1 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
   41          ВЫХОД ЛОГ_ВЫХОДЫ1 1 0 8;
   42          ВЫХОД ЛОГ_ВЫХОДЫ2 1 1 8;
   43          
   44          ПРОЦ Инициализация
   45          {
   46          /* ВХОДНЫЕ СИГНАЛЫ: */
   47          ЦЕЛ ЦелоеЗначение = {ЛОГ_ВХОДЫ1[5]} ДЛЯ ВСЕХ;
   48           ЛОГ К_РУКИ_ПОД_СУШИЛКОЙ    = {ЛОГ_ВХОДЫ1[1]} ДЛЯ ВСЕХ;
   49           
   50           /*Флаги*/
   51          	ЛОГ ФлагРучноеУправление ДЛЯ ВСЕХ;
   52          
   53          
   54          /* ВЫХОДНЫЕ СИГНАЛЫ (т.к. привязаны к модулю выходов): */ 
   55           ЛОГ У_ВКЛ_СУШИЛКУ = {ЛОГ_ВЫХОДЫ1[1]} ДЛЯ ВСЕХ;
   56           
   57           
   58           /*ПЛАВ Температура = {ЛОГ_ВХОДЫ2  []} ДЛЯ ВСЕХ; */ 
   59          
   60          /*########  СОСТОЯНИЯ ПРОЦЕССА  #########*/
   61           СОСТ Начало{  /* NB: 1-е f-сост. 1-го проц. - активно по включению питания */
   62          	СТАРТ ПРОЦ ЧтениеКольцевогоБуфера;
   63          	В СОСТ Работа;   
   64           }
   65           СОСТ Работа
   66           {
   67             ЕСЛИ (К_РУКИ_ПОД_СУШИЛКОЙ == ВКЛ  && ФлагРучноеУправление == ВЫКЛ) 
   68             { 
   69               У_ВКЛ_СУШИЛКУ = ВКЛ;
   70               В СЛЕДУЮЩЕЕ;
   71          	 }
   72          	 ИНАЧЕ ЕСЛИ (К_РУКИ_ПОД_СУШИЛКОЙ == ВЫКЛ  && ФлагРучноеУправление == ВЫКЛ)
   73          		У_ВКЛ_СУШИЛКУ = ВЫКЛ;
   74           }
   75           СОСТ Сушка{  
   76            ЕСЛИ (ФлагРучноеУправление == ВЫКЛ && К_РУКИ_ПОД_СУШИЛКОЙ == ВКЛ) В СОСТ Сушка;
   77            ТАЙМАУТ 12 В СОСТ Работа; 
   78           }
   79          } /* \ПРОЦ */
   80          
   81          /*==============================================*/
   82          /*==============================================*/
   83          /*=                                            =*/
   84          /*=      ПРОЦЕСС ЧтениеКольцевогоБуфера        =*/
   85          /*=                                            =*/
   86          /*==============================================*/
   87          /*==============================================*/
   88          ПРОЦ ЧтениеКольцевогоБуфера{  
   89          ИЗ ПРОЦ Инициализация ФлагРучноеУправление, У_ВКЛ_СУШИЛКУ; 
   90          /* */
   91          ЦЕЛ КодСообщенияОтГуи ЛОКАЛ;
   92           СОСТ Начало{
   93              /*  читаем код и параметр события из кольцевого буфера в структуру */
   94              ЕСЛИ (GetNextMsgGUI()) 
   95          	{
   96          		КодСообщенияОтГуи = GetMsgGUICode();
   97          		ЕСЛИ (КодСообщенияОтГуи == АУ2ГУИ_В_РУЧНОЕ_УПРАВЛЕНИЕ)
   98          		{
   99          			ФлагРучноеУправление = ВКЛ;
  100          			SendMsgGUICode(КОМ2АУ_ЕСТЬ_СУШИЛКА_В_РУЧНОЕ_УПРАВЛЕНИЕ);
  101          		}
  102          		ИНАЧЕ	ЕСЛИ (КодСообщенияОтГуи == АУ2ГУИ_ОТКЛЮЧИТЬ_РУЧНОЕ_УПРАВЛЕНИЕ)
  103          		{
  104          			ФлагРучноеУправление = ВКЛ;
  105          			SendMsgGUICode(КОМ2АУ_ЕСТЬ_ОТКЛЮЧИТЬ_РУЧНОЕ_УПРАВЛЕНИЕ);
  106          		}
  107          		ИНАЧЕ ЕСЛИ (КодСообщенияОтГуи == АУ2ГУИ_ВКЛЮЧИТЬ_СУШИЛКУ && ФлагРучноеУправление == ВКЛ)
  108          		{
  109          			У_ВКЛ_СУШИЛКУ = ВКЛ;
  110          			SendMsgGUICode(КОМ2АУ_СУШИЛКА_ВКЛЮЧЕНА);
  111          		}
  112          		ИНАЧЕ ЕСЛИ (КодСообщенияОтГуи == АУ2ГУИ_ВЫКЛЮЧИТЬ_СУШИЛКУ && ФлагРучноеУправление == ВКЛ)
  113          		{
  114          			У_ВКЛ_СУШИЛКУ = ВЫКЛ;
  115          			SendMsgGUICode(КОМ2АУ_СУШИЛКА_ВЫКЛЮЧЕНА);			
  116          		}
  117          	}
  118          	ЗАЦИКЛИТЬ;
  119          }
  120          }
  121          	
  122          
  123          }  /* \Прогр */

%RCSL-I-SUMMARY, Completed with 0 error(s).
%RCSL-I-SUMMARY, Completed with 0 warning(s).

 %RCSL-I-SUMMARY, Completed with 0 error(s).