    1           Прогр ЭлектросушилкаИмитатор {
    2          /* Стенд #1 Автоматизированная электросушилка
    3          Внимание! Период активизации гиперпроцесса равен 100 миллисекундам */
    4          
    5          КОНСТ ВКЛ                1;
    6          КОНСТ ВЫКЛ               0;
    7          КОНСТ ЗадержкаОбъекта		10;
    8          КОНСТ ЗадержкаДатчика		10;
    9          
   10          /*Набор команд для ВОУ*/
   11           ПЕРЕЧИСЛЕНИЕ
   12          {
   13          	БУС2ВОУ_ПОМЕСТИТЬ_РУКИ,
   14          	БУС2ВОУ_УБРАТЬ_РУКИ,
   15          	БУС2ВОУ_СЛОМАТЬ_СУШИЛКУ,
   16          	БУС2ВОУ_СУШИЛКА_РАБОТАЕТ
   17          };
   18           
   19          ФУНКЦИЯ ЦЕЛ GetMessageFromScenariousBlock(ПУСТО);
   20          ФУНКЦИЯ ЦЕЛ GetMessageCodeFromScenariousBlock(ПУСТО);
   21          ФУНКЦИЯ ПЛАВ Random(ПУСТО);
   22          
   23          ВХОД  ЛОГ_ВХОДЫ1  0 0 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
   24          ВХОД  ЛОГ_ВХОДЫ2  0 1 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
   25          ВЫХОД ЛОГ_ВЫХОДЫ1 1 0 8;
   26          ВЫХОД ЛОГ_ВЫХОДЫ2 1 1 8;
   27          
   28          ПРОЦ Инициализация{
   29          
   30          ЛОГ К_РУКИ_ПОД_СУШИЛКОЙ    = {ЛОГ_ВЫХОДЫ1[1]} ДЛЯ ВСЕХ;
   31          ЛОГ У_ВКЛ_СУШИЛКУ = {ЛОГ_ВХОДЫ1[1]} ДЛЯ ВСЕХ;
   32          ЛОГ ФлагИсправностьСушилки ДЛЯ ВСЕХ;
   33          
   34          
   35          /*########  СОСТОЯНИЯ ПРОЦЕССА  #########*/
   36           СОСТ Начало{  /* NB: 1-е f-сост. 1-го проц. - активно по включению питания */
   37          	ФлагИсправностьСушилки = ВКЛ;
   38          	СТАРТ ПРОЦ ЧтениеСценариев;
   39          	В СОСТ Работа; 
   40           }
   41           
   42           СОСТ Работа
   43          	{
   44          		ЕСЛИ (ФлагИсправностьСушилки == ВКЛ)
   45          		{
   46          			СТОП ПРОЦ НеисправнаяРабота;
   47          			СТАРТ ПРОЦ ИсправнаяРабота;
   48          		}
   49          		ИНАЧЕ  
   50          		{
   51          			СТОП ПРОЦ ИсправнаяРабота;
   52          			СТАРТ ПРОЦ НеисправнаяРабота;
   53          		}
   54          		ЗАЦИКЛИТЬ;
   55          	}
   56          
   57          } /* \ПРОЦ */
   58          
   59          ПРОЦ ИсправнаяРабота
   60          {
   61          	ИЗ ПРОЦ Инициализация У_ВКЛ_СУШИЛКУ;
   62          
   63          	СОСТ Начало
   64          	{
   65          		ЕСЛИ (У_ВКЛ_СУШИЛКУ == ВКЛ) В СОСТ ВключениеОбъекта;
   66          		ИНАЧЕ В СОСТ ОтключениеОбъекта;
   67          	}
   68          	СОСТ ВключениеОбъекта
   69          	{
   70          		ТАЙМАУТ ЗадержкаОбъекта В СОСТ РаботаетСушилка;
   71          	}
   72          	СОСТ ОтключениеОбъекта 
   73          	{
   74          		ТАЙМАУТ ЗадержкаОбъекта В СОСТ СушилкаОтключена;
   75          	}
   76          	СОСТ РаботаетСушилка
   77          	{
   78          		ЕСЛИ (У_ВКЛ_СУШИЛКУ != ВКЛ) В СОСТ Начало;
   79          	}
   80          	СОСТ СушилкаОтключена
   81          	{
   82          		ЕСЛИ (У_ВКЛ_СУШИЛКУ != ВЫКЛ) В СОСТ Начало;
   83          	}
   84          }
   85          
   86          ПРОЦ НеисправнаяРабота
   87          {
   88          	ИЗ ПРОЦ Инициализация У_ВКЛ_СУШИЛКУ;
   89          	СОСТ Начало
   90          	{
   91          		ЕСЛИ (У_ВКЛ_СУШИЛКУ == ВЫКЛ) В СОСТ ВключениеОбъекта;
   92          		ИНАЧЕ В СОСТ ОтключениеОбъекта;
   93          	}
   94          	СОСТ ВключениеОбъекта
   95          	{
   96          		ТАЙМАУТ ЗадержкаОбъекта В СОСТ РаботаетСушилка;
   97          	}
   98          	СОСТ ОтключениеОбъекта 
   99          	{
  100          		ТАЙМАУТ ЗадержкаОбъекта В СОСТ СушилкаОтключена;
  101          	}
  102          	СОСТ РаботаетСушилка
  103          	{
  104          		ЕСЛИ (У_ВКЛ_СУШИЛКУ != ВЫКЛ) В СОСТ Начало;
  105          	}
  106          	СОСТ СушилкаОтключена
  107          	{
  108          		ЕСЛИ (У_ВКЛ_СУШИЛКУ != ВКЛ) В СОСТ Начало;
  109          	}
  110          }
  111          
  112          
  113          ПРОЦ ЧтениеСценариев
  114          {
  115          ИЗ ПРОЦ Инициализация К_РУКИ_ПОД_СУШИЛКОЙ, ФлагИсправностьСушилки;
  116          	ЦЕЛ КодКоманды ЛОКАЛ;
  117          	СОСТ Начало
  118          	{
  119          		 ЕСЛИ (GetMessageFromScenariousBlock()) 
  120          		{
  121          			КодКоманды = GetMessageCodeFromScenariousBlock();
  122          			ЕСЛИ  ( КодКоманды == БУС2ВОУ_ПОМЕСТИТЬ_РУКИ ) СТАРТ ПРОЦ ПоместитьРуки;
  123          			ИНАЧЕ ЕСЛИ ( КодКоманды ==  БУС2ВОУ_УБРАТЬ_РУКИ) 
  124          			{
  125          				СТОП ПРОЦ ПоместитьРуки;
  126          				К_РУКИ_ПОД_СУШИЛКОЙ = ВЫКЛ;
  127          			}
  128          			ИНАЧЕ ЕСЛИ ( КодКоманды ==  БУС2ВОУ_СЛОМАТЬ_СУШИЛКУ) ФлагИсправностьСушилки = ВЫКЛ;
  129          			ИНАЧЕ ЕСЛИ ( КодКоманды ==  БУС2ВОУ_СУШИЛКА_РАБОТАЕТ) ФлагИсправностьСушилки = ВКЛ;
  130          			ЗАЦИКЛИТЬ;
  131          		}
  132          	}
  133          } 
  134          
  135          
  136          ПРОЦ ПоместитьРуки
  137          {
  138          ИЗ ПРОЦ Инициализация К_РУКИ_ПОД_СУШИЛКОЙ, ФлагИсправностьСушилки;
  139          ПЛАВ Монетка ЛОКАЛ;
  140          	СОСТ Выбор
  141          	{
  142          		В СОСТ РукиПодСушилку;
  143          	
  144          	}
  145          	СОСТ РукиПодСушилку
  146          	{
  147          		К_РУКИ_ПОД_СУШИЛКОЙ = ВКЛ; 
  148          		ТАЙМАУТ ЗадержкаДатчика В СОСТ Выбор;
  149          	}
  150          	СОСТ РукиУбрал
  151          	{
  152          		К_РУКИ_ПОД_СУШИЛКОЙ = ВЫКЛ;
  153          		ТАЙМАУТ ЗадержкаДатчика В СОСТ Выбор;
  154          	}
  155          }
  156          
  157          }  /* \Прогр */

%RCSL-I-SUMMARY, Completed with 0 error(s).
%RCSL-I-SUMMARY, Completed with 0 warning(s).

 %RCSL-I-SUMMARY, Completed with 0 error(s).