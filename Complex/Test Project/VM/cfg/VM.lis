    1          Прогр ВЕР{
    2          
    3          ТАКТ 50;
    4          КОНСТ ВКЛ 1;
    5          КОНСТ ВЫКЛ 0;
    6          КОНСТ ОжиданиеОтветаОтАлгоритма 10;
    7          КОНСТ ЗадержкаОбъекта 10;
    8          
    9          /*Коды сообщений от оператора */ 
   10          ПЕРЕЧИСЛЕНИЕ {
   11          	КОМ2АУ_В_РУЧНОЕ_УПРАВЛЕНИЕ,
   12          	КОМ2АУ_ОТКЛЮЧИТЬ_РУЧНОЕ_УПРАВЛЕНИЕ,
   13          	КОМ2АУ_ВКЛЮЧИТЬ_СУШИЛКУ,
   14          	КОМ2АУ_ВЫКЛЮЧИТЬ_СУШИЛКУ
   15          };
   16          
   17          /*Коды сообщений к оператору */ 
   18          ПЕРЕЧИСЛЕНИЕ 
   19          {
   20          	АУ2ГУИ_ЕСТЬ_СУШИЛКА_В_РУЧНОЕ_УПРАВЛЕНИЕ,
   21          	АУ2ГУИ_ЕСТЬ_ОТКЛЮЧИТЬ_РУЧНОЕ_УПРАВЛЕНИЕ,
   22          	АУ2ГУИ_СУШИЛКА_ВЫКЛЮЧЕНА,
   23          	АУ2ГУИ_СУШИЛКА_ВКЛЮЧЕНА
   24          };
   25          
   26           /*Набор команд для БВ*/
   27           ПЕРЕЧИСЛЕНИЕ 
   28          {
   29          	БУС2БВ_РУЧНОЕ_УПРАВЛЕНИЕ_ВКЛЮЧЕНИЕ,
   30          	БУС2БВ_РУЧНОЕ_УПРАВЛЕНИЕ_ВЫКЛЮЧЕНИЕ,
   31          	БУС2БВ_АВТОМАТИЧЕСКОЕ_УПРАВЛЕНИЕ_РУКИ_ПОМЕЩЕНЫ,
   32          	БУС2БВ_АВТОМАТИЧЕСКОЕ_УПРАВЛЕНИЕ_РУКИ_УБРАНЫ,
   33          	БУС2БВ_КОНЕЦ_ШТАНОГО_РЕЖИМА	
   34          };
   35          
   36          /*Набор команд для БУС от БВ*/
   37          ПЕРЕЧИСЛЕНИЕ
   38          {
   39          	БВ2БУС_СЛЕДУЮЩИЙ_СЦЕНАРИЙ,
   40          	БВ2БУС_ОШИБКА_ОСТАНОВ
   41          };
   42          
   43          /*Набор Команд для ГОО */
   44          ПЕРЕЧИСЛЕНИЕ
   45          {
   46          	БВ2ГОО_ВключениеРучногоУправленияУспешно,
   47          	БВ2ГОО_ВыключениеРучногоУправленияУспешно,
   48          	БВ2ГОО_ВключениеАвтоматическоеУспешно,
   49          	БВ2ГОО_ВыключениеАвтоматическоеУспешно,
   50          	БВ2ГОО_ТестУспешен,
   51          	БВ2ГОО_ОшибкаТеста,
   52          	БВ2ГОО_ВерификацияЗавершение,
   53          	БВ2ГОО_
   54          };
   55          
   56          ПЕРЕЧИСЛЕНИЕ
   57          {
   58          	БВ2ГОО_ВключениеРучногоУправленияНЕУспешно = БВ2ГОО_ + 1,
   59          	БВ2ГОО_ВыключениеРучногоУправленияНЕУспешно,
   60          	БВ2ГОО_СамопроизвольноеОтключениеРежимаРучногоУправления,
   61          	БВ2ГОО_СамопроизвольноеВключениеРежимаРучногоУправления,
   62          	БВ2ГОО_ОШИБКА_СамопроизвольноеВыключениеВавтоматРежиме,
   63          	БВ2ГОО_ОШИБКА_СамопроизвольноеВключениеВавтоматРежиме
   64          };
   65          
   66          ФУНКЦИЯ ЦЕЛ  SendMsgGUICode       (ЦЕЛ);
   67          
   68          
   69          /*CA Input msg queue*/
   70          
   71          ФУНКЦИЯ ЦЕЛ GetNextMsgFromCA(ПУСТО);
   72          ФУНКЦИЯ ЦЕЛ GetMsgCodeFromCA(ПУСТО);  /*чтение из памяти кода события */
   73          
   74          /*SCM  Input msg queue*/
   75          ФУНКЦИЯ ЦЕЛ GetNextMsgFromSCM(ПУСТО);
   76          ФУНКЦИЯ ЦЕЛ GetMsgCodeFromSCM(ПУСТО);  /*чтение из памяти кода события */
   77          
   78          /*SCM  Output msg queue*/
   79          ФУНКЦИЯ ЦЕЛ SendMsgCodeToSCM(ЦЕЛ);
   80          
   81          ВХОД  ЛОГ_ВЫХОДЫ_ОТ_АУ1  0 0 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
   82          ВХОД  ЛОГ_ВЫХОДЫ_ОТ_АУ2  0 1 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
   83          ВХОД  ЛОГ_ВЫХОДЫ_ОТ_ВОУ1  0 2 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
   84          ВХОД  ЛОГ_ВЫХОДЫ_ОТ_ВОУ2  0 3 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
   85          
   86          ПРОЦ Инициализация
   87          {
   88          	ЛОГ К_РУКИ_ПОД_СУШИЛКОЙ    = {ЛОГ_ВЫХОДЫ_ОТ_ВОУ1[1]} ДЛЯ ВСЕХ;
   89          
   90          /* ВЫХОДНЫЕ СИГНАЛЫ (т.к. привязаны к модулю выходов): */ 
   91          	ЛОГ У_ВКЛ_СУШИЛКУ = {ЛОГ_ВЫХОДЫ_ОТ_АУ1[1]} ДЛЯ ВСЕХ;
   92          
   93          	ЛОГ ФлагРучноеУправление ДЛЯ ВСЕХ;
   94          	ЛОГ ФлагРучноеУправлениеПоддверждено  ДЛЯ ВСЕХ;
   95          	ЛОГ ФлагРукиПодСушилкой  ДЛЯ ВСЕХ;
   96          
   97          /*########  СОСТОЯНИЯ ПРОЦЕССА  #########*/
   98           СОСТ Начало
   99           {  /* NB: 1-е f-сост. 1-го проц. - активно по включению питания */
  100          	ФлагРучноеУправление = ВЫКЛ;
  101          	ФлагРучноеУправлениеПоддверждено = ВЫКЛ;
  102          	ФлагРукиПодСушилкой = ВЫКЛ;
  103          	/* СТАРТ ПРОЦ ЧтениеСообщенийОтАУ; */
  104          	СТАРТ ПРОЦ ЧтениеСообщенийОтБУС;
  105          	СТАРТ ПРОЦ КонтрольОтключенияРучногоУправления;
  106          	СТОП;
  107           }
  108          
  109          } /* \ПРОЦ */
  110          
  111          ПРОЦ ЧтениеСообщенийОтБУС{  
  112          ИЗ ПРОЦ Инициализация ФлагРучноеУправление, ФлагРукиПодСушилкой; 
  113          /* */
  114          ЦЕЛ КодСообщенияОтБУС ЛОКАЛ;
  115           СОСТ Начало{
  116              /*  читаем код и параметр события из кольцевого буфера в структуру */
  117          	SendMsgGUICode(БВ2ГОО_ТестУспешен);
  118          	SendMsgGUICode(БВ2ГОО_ОшибкаТеста);
  119          /*	SendMsgGUICode(БВ2ГОО_ВерификацияЗавершение); */
  120          	
  121              ЕСЛИ (GetNextMsgFromSCM()) 
  122          	{
  123          		КодСообщенияОтБУС = GetMsgCodeFromSCM();
  124          		ЕСЛИ (КодСообщенияОтБУС == БУС2БВ_РУЧНОЕ_УПРАВЛЕНИЕ_ВКЛЮЧЕНИЕ)
  125          		{
  126          			/* ФлагРучноеУправление = ВКЛ; */
  127          			СТОП ПРОЦ КонтрольАвтоматическойРаботыСушилки;
  128          			СТОП ПРОЦ КонтрольОтключенияРучногоУправления;
  129          			СТАРТ ПРОЦ КонтрольВключенияРучногоУправления;
  130          		}
  131          		ИНАЧЕ ЕСЛИ (КодСообщенияОтБУС == БУС2БВ_РУЧНОЕ_УПРАВЛЕНИЕ_ВЫКЛЮЧЕНИЕ)
  132          		{
  133          			/*ФлагРучноеУправление = ВЫКЛ; */
  134          			СТАРТ ПРОЦ КонтрольОтключенияРучногоУправления;
  135          			СТОП ПРОЦ КонтрольВключенияРучногоУправления;
  136          		}
  137          		ИНАЧЕ ЕСЛИ (КодСообщенияОтБУС == БУС2БВ_АВТОМАТИЧЕСКОЕ_УПРАВЛЕНИЕ_РУКИ_ПОМЕЩЕНЫ ||
  138          					КодСообщенияОтБУС == БУС2БВ_АВТОМАТИЧЕСКОЕ_УПРАВЛЕНИЕ_РУКИ_УБРАНЫ)
  139          		{
  140          		 /*	ФлагРучноеУправление = ВЫКЛ; */
  141          			ФлагРукиПодСушилкой = ВКЛ;
  142          			СТАРТ ПРОЦ КонтрольАвтоматическойРаботыСушилки;
  143          		}
  144          	}
  145          	ЗАЦИКЛИТЬ;
  146          }
  147          }
  148          
  149          ПРОЦ КонтрольАвтоматическойРаботыСушилки
  150          {
  151          ИЗ ПРОЦ Инициализация К_РУКИ_ПОД_СУШИЛКОЙ, У_ВКЛ_СУШИЛКУ;
  152          
  153          	СОСТ Начало
  154          	{
  155          		ЕСЛИ (К_РУКИ_ПОД_СУШИЛКОЙ == ВКЛ) В СОСТ ОжиданиеВключения;
  156          		ИНАЧЕ В СОСТ ОжиданиеОтключения; 
  157          	}
  158          	СОСТ ОжиданиеВключения
  159          	{
  160          		ЕСЛИ (У_ВКЛ_СУШИЛКУ == ВКЛ)
  161          		{
  162          			В СОСТ СушилкаВключена;
  163          			SendMsgGUICode(БВ2ГОО_ВключениеАвтоматическоеУспешно);
  164          		}
  165          			
  166          		ТАЙМАУТ ОжиданиеОтветаОтАлгоритма В СОСТ ОшибкаВключения;
  167          	}
  168          	СОСТ ОжиданиеОтключения
  169          	{
  170          		ЕСЛИ (У_ВКЛ_СУШИЛКУ == ВЫКЛ) 
  171          		{
  172          			В СОСТ СушилкаВыключена;
  173          			SendMsgGUICode(БВ2ГОО_ВыключениеАвтоматическоеУспешно);
  174          		}
  175          		ТАЙМАУТ ОжиданиеОтветаОтАлгоритма В СОСТ ОшибкаВыключения;		
  176          	}
  177          	СОСТ СушилкаВключена 
  178          	{
  179          		ЕСЛИ (У_ВКЛ_СУШИЛКУ == ВЫКЛ  && К_РУКИ_ПОД_СУШИЛКОЙ == ВКЛ)
  180          		{
  181          			SendMsgGUICode(БВ2ГОО_ОШИБКА_СамопроизвольноеВыключениеВавтоматРежиме);
  182          			СТОП;
  183          		}
  184          		ИНАЧЕ ЕСЛИ (К_РУКИ_ПОД_СУШИЛКОЙ == ВЫКЛ) В СОСТ ОжиданиеПеремен;
  185          	}
  186          	СОСТ ОжиданиеПеремен
  187          	{
  188          		ЕСЛИ (К_РУКИ_ПОД_СУШИЛКОЙ == ВКЛ) В СОСТ СушилкаВключена;
  189          		ТАЙМАУТ ЗадержкаОбъекта В СОСТ Начало;
  190          	}	
  191          	СОСТ ОшибкаВключения
  192          	{
  193          			SendMsgGUICode(БВ2ГОО_ВключениеРучногоУправленияНЕУспешно);
  194          			СТОП;
  195          	}
  196          	СОСТ ОшибкаВыключения
  197          	{
  198          		СТОП;
  199          	}
  200          	СОСТ СушилкаВыключена 
  201          	{
  202          		ЕСЛИ (У_ВКЛ_СУШИЛКУ == ВКЛ  && К_РУКИ_ПОД_СУШИЛКОЙ == ВЫКЛ)
  203          		{
  204          			SendMsgGUICode(БВ2ГОО_ОШИБКА_СамопроизвольноеВыключениеВавтоматРежиме);
  205          			СТОП;
  206          		}
  207          		ИНАЧЕ ЕСЛИ (К_РУКИ_ПОД_СУШИЛКОЙ == ВЫКЛ) В СОСТ Начало;
  208          	}
  209          }
  210          
  211          ПРОЦ КонтрольОтключенияРучногоУправления
  212          {
  213          ИЗ ПРОЦ Инициализация ФлагРучноеУправлениеПоддверждено;
  214          	СОСТ Старт
  215          	{
  216          		ЕСЛИ (ФлагРучноеУправлениеПоддверждено == ВЫКЛ)
  217          		{
  218          			SendMsgGUICode(БВ2ГОО_ВыключениеРучногоУправленияУспешно);
  219          			В СОСТ Контроль;
  220          		}
  221          		ТАЙМАУТ ОжиданиеОтветаОтАлгоритма В СЛЕДУЮЩЕЕ;
  222          	}
  223          	СОСТ Беда
  224          	{
  225          		SendMsgGUICode(БВ2ГОО_ВыключениеРучногоУправленияНЕУспешно);
  226          		СТОП;
  227          	}
  228          	СОСТ Контроль
  229          	{
  230          		ЕСЛИ (ФлагРучноеУправлениеПоддверждено != ВЫКЛ)
  231          		{
  232          			SendMsgGUICode(БВ2ГОО_СамопроизвольноеВключениеРежимаРучногоУправления);
  233          			СТОП;
  234          		}
  235          	}
  236          }
  237          
  238          ПРОЦ КонтрольВключенияРучногоУправления
  239          {
  240          ИЗ ПРОЦ Инициализация ФлагРучноеУправлениеПоддверждено;
  241          
  242          	СОСТ Старт
  243          	{
  244          		ЕСЛИ (ФлагРучноеУправлениеПоддверждено == ВКЛ)
  245          		{
  246          			SendMsgGUICode(БВ2ГОО_ВключениеРучногоУправленияУспешно);
  247          			В СОСТ Контроль;
  248          		}
  249          		ТАЙМАУТ ОжиданиеОтветаОтАлгоритма В СЛЕДУЮЩЕЕ;
  250          	}	
  251          	СОСТ Беда
  252          	{
  253          		SendMsgGUICode(БВ2ГОО_ВключениеРучногоУправленияНЕУспешно);
  254          		СТОП;
  255          	}
  256          	СОСТ Контроль
  257          	{
  258          		ЕСЛИ (ФлагРучноеУправлениеПоддверждено != ВКЛ)
  259          		{
  260          			SendMsgGUICode(БВ2ГОО_СамопроизвольноеОтключениеРежимаРучногоУправления);
  261          			СТОП;
  262          		}
  263          	}
  264          }
  265          
  266          
  267          }  /* \Прогр */

%RCSL-I-SUMMARY, Completed with 0 error(s).
%RCSL-I-SUMMARY, Completed with 0 warning(s).

 %RCSL-I-SUMMARY, Completed with 0 error(s).