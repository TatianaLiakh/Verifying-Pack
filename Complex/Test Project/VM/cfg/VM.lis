    1          Прогр ВЕР{
    2          
    3          ТАКТ 50;
    4          КОНСТ ВКЛ 1;
    5          КОНСТ ВЫКЛ 0;
    6          КОНСТ ОжиданиеОтветаОтАлгоритма 10;
    7          КОНСТ ЗадержкаОбъекта 10;
    8          
    9          /*Коды сообщений от оператора */ 
   10          ПЕРЕЧИСЛЕНИЕ {
   11          	КОМ2АУ_В_РУЧНОЕ_УПРАВЛЕНИЕ,
   12          	КОМ2АУ_ОТКЛЮЧИТЬ_РУЧНОЕ_УПРАВЛЕНИЕ,
   13          	КОМ2АУ_ВКЛЮЧИТЬ_СУШИЛКУ,
   14          	КОМ2АУ_ВЫКЛЮЧИТЬ_СУШИЛКУ
   15          };
   16          
   17          /*Коды сообщений к оператору */ 
   18          ПЕРЕЧИСЛЕНИЕ 
   19          {
   20          	АУ2ГУИ_ЕСТЬ_СУШИЛКА_В_РУЧНОЕ_УПРАВЛЕНИЕ,
   21          	АУ2ГУИ_ЕСТЬ_ОТКЛЮЧИТЬ_РУЧНОЕ_УПРАВЛЕНИЕ,
   22          	АУ2ГУИ_СУШИЛКА_ВЫКЛЮЧЕНА,
   23          	АУ2ГУИ_СУШИЛКА_ВКЛЮЧЕНА
   24          };
   25          
   26           /*Набор команд для БВ*/
   27           ПЕРЕЧИСЛЕНИЕ 
   28          {
   29          	БУС2БВ_РУЧНОЕ_УПРАВЛЕНИЕ_ВКЛЮЧЕНИЕ,
   30          	БУС2БВ_РУЧНОЕ_УПРАВЛЕНИЕ_ВЫКЛЮЧЕНИЕ,
   31          	БУС2БВ_АВТОМАТИЧЕСКОЕ_УПРАВЛЕНИЕ_РУКИ_ПОМЕЩЕНЫ,
   32          	БУС2БВ_АВТОМАТИЧЕСКОЕ_УПРАВЛЕНИЕ_РУКИ_УБРАНЫ,
   33          	БУС2БВ_КОНЕЦ_ШТАНОГО_РЕЖИМА	
   34          };
   35          
   36          /*Набор команд для БУС от БВ*/
   37          ПЕРЕЧИСЛЕНИЕ
   38          {
   39          	БВ2БУС_СЛЕДУЮЩИЙ_СЦЕНАРИЙ,
   40          	БВ2БУС_ОШИБКА_ОСТАНОВ
   41          };
   42          
   43          /*Набор Команд для ГОО */
   44          ПЕРЕЧИСЛЕНИЕ
   45          {
   46          	БВ2ГОО_ВключениеРучногоУправленияУспешно,
   47          	БВ2ГОО_ВыключениеРучногоУправленияУспешно,
   48          	БВ2ГОО_ВключениеАвтоматическоеУспешно,
   49          	БВ2ГОО_ВыключениеАвтоматическоеУспешно,
   50          	БВ2ГОО_ТестУспешен,
   51          	БВ2ГОО_ОшибкаТеста,
   52          	БВ2ГОО_ВерификацияЗавершение,
   53          	БВ2ГОО_
   54          };
   55          
   56          ПЕРЕЧИСЛЕНИЕ
   57          {
   58          	БВ2ГОО_ВключениеРучногоУправленияНЕУспешно = БВ2ГОО_ + 1,
   59          	БВ2ГОО_ВыключениеРучногоУправленияНЕУспешно,
   60          	БВ2ГОО_СамопроизвольноеОтключениеРежимаРучногоУправления,
   61          	БВ2ГОО_СамопроизвольноеВключениеРежимаРучногоУправления,
   62          	БВ2ГОО_ОШИБКА_СамопроизвольноеВыключениеВавтоматРежиме,
   63          	БВ2ГОО_ОШИБКА_СамопроизвольноеВключениеВавтоматРежиме
   64          };
   65          
   66          ФУНКЦИЯ ЦЕЛ  SendMsgGUICode       (ЦЕЛ);
   67          
   68          
   69          /*CA Input msg queue*/
   70          
   71          ФУНКЦИЯ ЦЕЛ GetNextMsgFromCA(ПУСТО);
   72          ФУНКЦИЯ ЦЕЛ GetMsgCodeFromCA(ПУСТО);  /*чтение из памяти кода события */
   73          
   74          /*SCM  Input msg queue*/
   75          ФУНКЦИЯ ЦЕЛ GetNextMsgFromSCM(ПУСТО);
   76          ФУНКЦИЯ ЦЕЛ GetMsgCodeFromSCM(ПУСТО);  /*чтение из памяти кода события */
   77          
   78          /*SCM  Output msg queue*/
   79          ФУНКЦИЯ ЦЕЛ SendMsgCodeToSCM(ЦЕЛ);
   80          
   81          ВХОД  ЛОГ_ВЫХОДЫ_ОТ_АУ1  0 0 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
   82          ВХОД  ЛОГ_ВЫХОДЫ_ОТ_АУ2  0 1 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
   83          ВХОД  ЛОГ_ВЫХОДЫ_ОТ_ВОУ1  0 2 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
   84          ВХОД  ЛОГ_ВЫХОДЫ_ОТ_ВОУ2  0 3 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
   85          
   86          ПРОЦ Инициализация
   87          {
   88          	ЛОГ К_РУКИ_ПОД_СУШИЛКОЙ    = {ЛОГ_ВЫХОДЫ_ОТ_ВОУ1[1]} ДЛЯ ВСЕХ;
   89          
   90          /* ВЫХОДНЫЕ СИГНАЛЫ (т.к. привязаны к модулю выходов): */ 
   91          	ЛОГ У_ВКЛ_СУШИЛКУ = {ЛОГ_ВЫХОДЫ_ОТ_АУ1[1]} ДЛЯ ВСЕХ;
   92          
   93          	ЛОГ ФлагРучноеУправление ДЛЯ ВСЕХ;
   94          	ЛОГ ФлагРучноеУправлениеПоддверждено  ДЛЯ ВСЕХ;
   95          	ЛОГ ФлагРукиПодСушилкой  ДЛЯ ВСЕХ;
   96          
   97          /*########  СОСТОЯНИЯ ПРОЦЕССА  #########*/
   98           СОСТ Начало
   99           {  /* NB: 1-е f-сост. 1-го проц. - активно по включению питания */
  100          	ФлагРучноеУправление = ВЫКЛ;
  101          	ФлагРучноеУправлениеПоддверждено = ВЫКЛ;
  102          	ФлагРукиПодСушилкой = ВЫКЛ;
  103          	/* СТАРТ ПРОЦ ЧтениеСообщенийОтАУ; */
  104          	СТАРТ ПРОЦ ЧтениеСообщенийОтБУС;
  105          	СТАРТ ПРОЦ КонтрольОтключенияРучногоУправления;
  106          	СТОП;
  107           }
  108          
  109          } /* \ПРОЦ */
  110          
  111          ПРОЦ ЧтениеСообщенийОтБУС{  
  112          ИЗ ПРОЦ Инициализация ФлагРучноеУправление, ФлагРукиПодСушилкой; 
  113          /* */
  114          ЦЕЛ КодСообщенияОтБУС ЛОКАЛ;
  115           СОСТ Начало{
  116              /*  читаем код и параметр события из кольцевого буфера в структуру */
  117          	SendMsgGUICode(БВ2ГОО_ТестУспешен);
  118          	SendMsgGUICode(БВ2ГОО_ОшибкаТеста);
  119          	
  120              ЕСЛИ (GetNextMsgFromSCM()) 
  121          	{
  122          		КодСообщенияОтБУС = GetMsgCodeFromSCM();
  123          		ЕСЛИ (КодСообщенияОтБУС == БУС2БВ_РУЧНОЕ_УПРАВЛЕНИЕ_ВКЛЮЧЕНИЕ)
  124          		{
  125          			/* ФлагРучноеУправление = ВКЛ; */
  126          			СТОП ПРОЦ КонтрольАвтоматическойРаботыСушилки;
  127          			СТОП ПРОЦ КонтрольОтключенияРучногоУправления;
  128          			СТАРТ ПРОЦ КонтрольВключенияРучногоУправления;
  129          		}
  130          		ИНАЧЕ ЕСЛИ (КодСообщенияОтБУС == БУС2БВ_РУЧНОЕ_УПРАВЛЕНИЕ_ВЫКЛЮЧЕНИЕ)
  131          		{
  132          			/*ФлагРучноеУправление = ВЫКЛ; */
  133          			СТАРТ ПРОЦ КонтрольОтключенияРучногоУправления;
  134          			СТОП ПРОЦ КонтрольВключенияРучногоУправления;
  135          		}
  136          		ИНАЧЕ ЕСЛИ (КодСообщенияОтБУС == БУС2БВ_АВТОМАТИЧЕСКОЕ_УПРАВЛЕНИЕ_РУКИ_ПОМЕЩЕНЫ ||
  137          					КодСообщенияОтБУС == БУС2БВ_АВТОМАТИЧЕСКОЕ_УПРАВЛЕНИЕ_РУКИ_УБРАНЫ)
  138          		{
  139          		 /*	ФлагРучноеУправление = ВЫКЛ; */
  140          			ФлагРукиПодСушилкой = ВКЛ;
  141          			СТАРТ ПРОЦ КонтрольАвтоматическойРаботыСушилки;
  142          		}
  143          	}
  144          	ЗАЦИКЛИТЬ;
  145          }
  146          }
  147          
  148          ПРОЦ КонтрольАвтоматическойРаботыСушилки
  149          {
  150          ИЗ ПРОЦ Инициализация К_РУКИ_ПОД_СУШИЛКОЙ, У_ВКЛ_СУШИЛКУ;
  151          
  152          	СОСТ Начало
  153          	{
  154          		ЕСЛИ (К_РУКИ_ПОД_СУШИЛКОЙ == ВКЛ) В СОСТ ОжиданиеВключения;
  155          		ИНАЧЕ В СОСТ ОжиданиеОтключения; 
  156          	}
  157          	СОСТ ОжиданиеВключения
  158          	{
  159          		ЕСЛИ (У_ВКЛ_СУШИЛКУ == ВКЛ)
  160          		{
  161          			В СОСТ СушилкаВключена;
  162          			SendMsgGUICode(БВ2ГОО_ВключениеАвтоматическоеУспешно);
  163          		}
  164          			
  165          		ТАЙМАУТ ОжиданиеОтветаОтАлгоритма В СОСТ ОшибкаВключения;
  166          	}
  167          	СОСТ ОжиданиеОтключения
  168          	{
  169          		ЕСЛИ (У_ВКЛ_СУШИЛКУ == ВЫКЛ) 
  170          		{
  171          			В СОСТ СушилкаВыключена;
  172          			SendMsgGUICode(БВ2ГОО_ВыключениеАвтоматическоеУспешно);
  173          		}
  174          		ТАЙМАУТ ОжиданиеОтветаОтАлгоритма В СОСТ ОшибкаВыключения;		
  175          	}
  176          	СОСТ СушилкаВключена 
  177          	{
  178          		ЕСЛИ (У_ВКЛ_СУШИЛКУ == ВЫКЛ  && К_РУКИ_ПОД_СУШИЛКОЙ == ВКЛ)
  179          		{
  180          			SendMsgGUICode(БВ2ГОО_ОШИБКА_СамопроизвольноеВыключениеВавтоматРежиме);
  181          			СТОП;
  182          		}
  183          		ИНАЧЕ ЕСЛИ (К_РУКИ_ПОД_СУШИЛКОЙ == ВЫКЛ) В СОСТ ОжиданиеПеремен;
  184          	}
  185          	СОСТ ОжиданиеПеремен
  186          	{
  187          		ЕСЛИ (К_РУКИ_ПОД_СУШИЛКОЙ == ВКЛ) В СОСТ СушилкаВключена;
  188          		ТАЙМАУТ ЗадержкаОбъекта В СОСТ Начало;
  189          	}	
  190          	СОСТ ОшибкаВключения
  191          	{
  192          			SendMsgGUICode(БВ2ГОО_ВключениеРучногоУправленияНЕУспешно);
  193          			СТОП;
  194          	}
  195          	СОСТ ОшибкаВыключения
  196          	{
  197          		СТОП;
  198          	}
  199          	СОСТ СушилкаВыключена 
  200          	{
  201          		ЕСЛИ (У_ВКЛ_СУШИЛКУ == ВКЛ  && К_РУКИ_ПОД_СУШИЛКОЙ == ВЫКЛ)
  202          		{
  203          			SendMsgGUICode(БВ2ГОО_ОШИБКА_СамопроизвольноеВыключениеВавтоматРежиме);
  204          			СТОП;
  205          		}
  206          		ИНАЧЕ ЕСЛИ (К_РУКИ_ПОД_СУШИЛКОЙ == ВЫКЛ) В СОСТ Начало;
  207          	}
  208          }
  209          
  210          ПРОЦ КонтрольОтключенияРучногоУправления
  211          {
  212          ИЗ ПРОЦ Инициализация ФлагРучноеУправлениеПоддверждено;
  213          	СОСТ Старт
  214          	{
  215          		ЕСЛИ (ФлагРучноеУправлениеПоддверждено == ВЫКЛ)
  216          		{
  217          			SendMsgGUICode(БВ2ГОО_ВыключениеРучногоУправленияУспешно);
  218          			В СОСТ Контроль;
  219          		}
  220          		ТАЙМАУТ ОжиданиеОтветаОтАлгоритма В СЛЕДУЮЩЕЕ;
  221          	}
  222          	СОСТ Беда
  223          	{
  224          		SendMsgGUICode(БВ2ГОО_ВыключениеРучногоУправленияНЕУспешно);
  225          		СТОП;
  226          	}
  227          	СОСТ Контроль
  228          	{
  229          		ЕСЛИ (ФлагРучноеУправлениеПоддверждено != ВЫКЛ)
  230          		{
  231          			SendMsgGUICode(БВ2ГОО_СамопроизвольноеВключениеРежимаРучногоУправления);
  232          			СТОП;
  233          		}
  234          	}
  235          }
  236          
  237          ПРОЦ КонтрольВключенияРучногоУправления
  238          {
  239          ИЗ ПРОЦ Инициализация ФлагРучноеУправлениеПоддверждено;
  240          
  241          	СОСТ Старт
  242          	{
  243          		ЕСЛИ (ФлагРучноеУправлениеПоддверждено == ВКЛ)
  244          		{
  245          			SendMsgGUICode(БВ2ГОО_ВключениеРучногоУправленияУспешно);
  246          			В СОСТ Контроль;
  247          		}
  248          		ТАЙМАУТ ОжиданиеОтветаОтАлгоритма В СЛЕДУЮЩЕЕ;
  249          	}	
  250          	СОСТ Беда
  251          	{
  252          		SendMsgGUICode(БВ2ГОО_ВключениеРучногоУправленияНЕУспешно);
  253          		СТОП;
  254          	}
  255          	СОСТ Контроль
  256          	{
  257          		ЕСЛИ (ФлагРучноеУправлениеПоддверждено != ВКЛ)
  258          		{
  259          			SendMsgGUICode(БВ2ГОО_СамопроизвольноеОтключениеРежимаРучногоУправления);
  260          			СТОП;
  261          		}
  262          	}
  263          }
  264          
  265          
  266          }  /* \Прогр */

%RCSL-I-SUMMARY, Completed with 0 error(s).
%RCSL-I-SUMMARY, Completed with 0 warning(s).

 %RCSL-I-SUMMARY, Completed with 0 error(s).