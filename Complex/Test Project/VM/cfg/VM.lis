    1          Прогр ВЕР{
    2          
    3          ТАКТ 50;
    4          КОНСТ ВКЛ 1;
    5          КОНСТ ВЫКЛ 0;
    6          КОНСТ ОжиданиеОтветаОтАлгоритма 10;
    7          КОНСТ ЗадержкаОбъекта 10;
    8          
    9          /*Коды сообщений от оператора */ 
   10          ПЕРЕЧИСЛЕНИЕ {
   11          	КОМ2АУ_В_РУЧНОЕ_УПРАВЛЕНИЕ,
   12          	КОМ2АУ_ОТКЛЮЧИТЬ_РУЧНОЕ_УПРАВЛЕНИЕ,
   13          	КОМ2АУ_ВКЛЮЧИТЬ_СУШИЛКУ,
   14          	КОМ2АУ_ВЫКЛЮЧИТЬ_СУШИЛКУ
   15          };
   16          
   17          /*Коды сообщений к оператору */ 
   18          ПЕРЕЧИСЛЕНИЕ 
   19          {
   20          	АУ2ГУИ_ЕСТЬ_СУШИЛКА_В_РУЧНОЕ_УПРАВЛЕНИЕ,
   21          	АУ2ГУИ_ЕСТЬ_ОТКЛЮЧИТЬ_РУЧНОЕ_УПРАВЛЕНИЕ,
   22          	АУ2ГУИ_СУШИЛКА_ВЫКЛЮЧЕНА,
   23          	АУ2ГУИ_СУШИЛКА_ВКЛЮЧЕНА
   24          };
   25          
   26           /*Набор команд для БВ*/
   27            ПЕРЕЧИСЛЕНИЕ 
   28          {
   29          	БУС2БВ_РУЧНОЕ_УПРАВЛЕНИЕ_ВКЛЮЧЕНИЕ,
   30          	БУС2БВ_РУЧНОЕ_УПРАВЛЕНИЕ_ВЫКЛЮЧЕНИЕ,
   31          	БУС2БВ_АВТОМАТИЧЕСКОЕ_УПРАВЛЕНИЕ_РУКИ_ПОМЕЩЕНЫ,
   32          	БУС2БВ_АВТОМАТИЧЕСКОЕ_УПРАВЛЕНИЕ_РУКИ_УБРАНЫ,
   33          	БУС2БВ_КОНЕЦ_ШТАНОГО_РЕЖИМА,
   34          	БУС2БВ_Для_проверки
   35          };
   36          
   37          ПЕРЕЧИСЛЕНИЕ
   38          {
   39          	БУС2БВ_НЕИСПРАВНОСТЬ_РУЧНОЕ_УПРАВЛЕНИЕ_ВКЛЮЧЕНИЕ = БУС2БВ_КОНЕЦ_ШТАНОГО_РЕЖИМА + 1,
   40          	БУС2БВ_НЕИСПРАВНОСТЬ_РУЧНОЕ_УПРАВЛЕНИЕ_ВЫКЛЮЧЕНИЕ,
   41          	БУС2БВ_НЕИСПРАВНОСТЬ_АВТОМАТИЧЕСКОЕ_УПРАВЛЕНИЕ_РУКИ_ПОМЕЩЕНЫ,
   42          	БУС2БВ_НЕИСПРАВНОСТЬ_НЕИСПРАВНОСТЬ_АВТОМАТИЧЕСКОЕ_УПРАВЛЕНИЕ_РУКИ_УБРАНЫ
   43          };
   44          
   45          /*Набор команд для БУС от БВ*/
   46          ПЕРЕЧИСЛЕНИЕ
   47          {
   48          	БВ2БУС_СЛЕДУЮЩИЙ_СЦЕНАРИЙ,
   49          	БВ2БУС_ОШИБКА_ОСТАНОВ
   50          };
   51          
   52          /*Набор Команд для ГОО */
   53          ПЕРЕЧИСЛЕНИЕ
   54          {
   55          	БВ2ГОО_ВключениеРучногоУправленияУспешно,
   56          	БВ2ГОО_ВыключениеРучногоУправленияУспешно,
   57          	БВ2ГОО_ВключениеАвтоматическоеУспешно,
   58          	БВ2ГОО_ВыключениеАвтоматическоеУспешно,
   59          	БВ2ГОО_ТестУспешен,
   60          	БВ2ГОО_ОшибкаТеста,
   61          	БВ2ГОО_ВерификацияЗавершение,
   62          	БВ2ГОО_
   63          };
   64          
   65          ПЕРЕЧИСЛЕНИЕ
   66          {
   67          	БВ2ГОО_ВключениеРучногоУправленияНЕУспешно = БВ2ГОО_ + 1,
   68          	БВ2ГОО_ВыключениеРучногоУправленияНЕУспешно,
   69          	БВ2ГОО_СамопроизвольноеОтключениеРежимаРучногоУправления,
   70          	БВ2ГОО_СамопроизвольноеВключениеРежимаРучногоУправления,
   71          	БВ2ГОО_ОШИБКА_СамопроизвольноеВыключениеВавтоматРежиме,
   72          	БВ2ГОО_ОШИБКА_СамопроизвольноеВключениеВавтоматРежиме
   73          };
   74          
   75          ФУНКЦИЯ ЦЕЛ  SendMsgGUICode       (ЦЕЛ);
   76          
   77          
   78          /*CA Input msg queue*/
   79          
   80          ФУНКЦИЯ ЦЕЛ GetNextMsgFromCA(ПУСТО);
   81          ФУНКЦИЯ ЦЕЛ GetMsgCodeFromCA(ПУСТО);  /*чтение из памяти кода события */
   82          
   83          /*SCM  Input msg queue*/
   84          ФУНКЦИЯ ЦЕЛ GetNextMsgFromSCM(ПУСТО);
   85          ФУНКЦИЯ ЦЕЛ GetMsgCodeFromSCM(ПУСТО);  /*чтение из памяти кода события */
   86          
   87          /*SCM  Output msg queue*/
   88          ФУНКЦИЯ ЦЕЛ SendMsgCodeToSCM(ЦЕЛ);
   89          
   90          ВХОД  ЛОГ_ВЫХОДЫ_ОТ_АУ1  0 0 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
   91          ВХОД  ЛОГ_ВЫХОДЫ_ОТ_АУ2  0 1 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
   92          ВХОД  ЛОГ_ВЫХОДЫ_ОТ_ВОУ1  0 2 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
   93          ВХОД  ЛОГ_ВЫХОДЫ_ОТ_ВОУ2  0 3 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
   94          
   95          ПРОЦ Инициализация
   96          {
   97          	ЛОГ К_РУКИ_ПОД_СУШИЛКОЙ    = {ЛОГ_ВЫХОДЫ_ОТ_ВОУ1[1]} ДЛЯ ВСЕХ;
   98          
   99          /* ВЫХОДНЫЕ СИГНАЛЫ (т.к. привязаны к модулю выходов): */ 
  100          	ЛОГ У_ВКЛ_СУШИЛКУ = {ЛОГ_ВЫХОДЫ_ОТ_АУ1[1]} ДЛЯ ВСЕХ;
  101          
  102          	ЛОГ ФлагРучноеУправление ДЛЯ ВСЕХ;
  103          	ЛОГ ФлагРучноеУправлениеПоддверждено  ДЛЯ ВСЕХ;
  104          	ЛОГ ФлагРукиПодСушилкой  ДЛЯ ВСЕХ;
  105          
  106          /*########  СОСТОЯНИЯ ПРОЦЕССА  #########*/
  107           СОСТ Начало
  108           {  /* NB: 1-е f-сост. 1-го проц. - активно по включению питания */
  109          	ФлагРучноеУправление = ВЫКЛ;
  110          	ФлагРучноеУправлениеПоддверждено = ВЫКЛ;
  111          	ФлагРукиПодСушилкой = ВЫКЛ;
  112          	/* СТАРТ ПРОЦ ЧтениеСообщенийОтАУ; */
  113          	СТАРТ ПРОЦ ЧтениеСообщенийОтБУС;
  114          	СТАРТ ПРОЦ КонтрольОтключенияРучногоУправления;
  115          	СТОП;
  116           }
  117          
  118          } /* \ПРОЦ */
  119          
  120          ПРОЦ ЧтениеСообщенийОтБУС{  
  121          ИЗ ПРОЦ Инициализация ФлагРучноеУправление, ФлагРукиПодСушилкой; 
  122          /* */
  123          ЦЕЛ КодСообщенияОтБУС ЛОКАЛ;
  124           СОСТ Начало{
  125              /*  читаем код и параметр события из кольцевого буфера в структуру */
  126          	SendMsgGUICode(БВ2ГОО_ТестУспешен);
  127          	SendMsgGUICode(БВ2ГОО_ОшибкаТеста);
  128          /*	SendMsgGUICode(БВ2ГОО_ВерификацияЗавершение); */
  129          	
  130              ЕСЛИ (GetNextMsgFromSCM()) 
  131          	{
  132          		КодСообщенияОтБУС = GetMsgCodeFromSCM();
  133          		ЕСЛИ (КодСообщенияОтБУС == БУС2БВ_РУЧНОЕ_УПРАВЛЕНИЕ_ВКЛЮЧЕНИЕ)
  134          		{
  135          			/* ФлагРучноеУправление = ВКЛ; */
  136          			СТОП ПРОЦ КонтрольАвтоматическойРаботыСушилки;
  137          			СТОП ПРОЦ КонтрольОтключенияРучногоУправления;
  138          			СТАРТ ПРОЦ КонтрольВключенияРучногоУправления;
  139          		}
  140          		ИНАЧЕ ЕСЛИ (КодСообщенияОтБУС == БУС2БВ_РУЧНОЕ_УПРАВЛЕНИЕ_ВЫКЛЮЧЕНИЕ)
  141          		{
  142          			/*ФлагРучноеУправление = ВЫКЛ; */
  143          			СТАРТ ПРОЦ КонтрольОтключенияРучногоУправления;
  144          			СТОП ПРОЦ КонтрольВключенияРучногоУправления;
  145          		}
  146          		ИНАЧЕ ЕСЛИ (КодСообщенияОтБУС == БУС2БВ_АВТОМАТИЧЕСКОЕ_УПРАВЛЕНИЕ_РУКИ_ПОМЕЩЕНЫ ||
  147          					КодСообщенияОтБУС == БУС2БВ_АВТОМАТИЧЕСКОЕ_УПРАВЛЕНИЕ_РУКИ_УБРАНЫ)
  148          		{
  149          		 /*	ФлагРучноеУправление = ВЫКЛ; */
  150          			ФлагРукиПодСушилкой = ВКЛ;
  151          			СТАРТ ПРОЦ КонтрольАвтоматическойРаботыСушилки;
  152          		}
  153          	}
  154          	ЗАЦИКЛИТЬ;
  155          }
  156          }
  157          
  158          ПРОЦ КонтрольАвтоматическойРаботыСушилки
  159          {
  160          ИЗ ПРОЦ Инициализация К_РУКИ_ПОД_СУШИЛКОЙ, У_ВКЛ_СУШИЛКУ;
  161          
  162          	СОСТ Начало
  163          	{
  164          		ЕСЛИ (К_РУКИ_ПОД_СУШИЛКОЙ == ВКЛ) В СОСТ ОжиданиеВключения;
  165          		ИНАЧЕ В СОСТ ОжиданиеОтключения; 
  166          	}
  167          	СОСТ ОжиданиеВключения
  168          	{
  169          		ЕСЛИ (У_ВКЛ_СУШИЛКУ == ВКЛ)
  170          		{
  171          			В СОСТ СушилкаВключена;
  172          			SendMsgGUICode(БВ2ГОО_ВключениеАвтоматическоеУспешно);
  173          		}
  174          			
  175          		ТАЙМАУТ ОжиданиеОтветаОтАлгоритма В СОСТ ОшибкаВключения;
  176          	}
  177          	СОСТ ОжиданиеОтключения
  178          	{
  179          		ЕСЛИ (У_ВКЛ_СУШИЛКУ == ВЫКЛ) 
  180          		{
  181          			В СОСТ СушилкаВыключена;
  182          			SendMsgGUICode(БВ2ГОО_ВыключениеАвтоматическоеУспешно);
  183          		}
  184          		ТАЙМАУТ ОжиданиеОтветаОтАлгоритма В СОСТ ОшибкаВыключения;		
  185          	}
  186          	СОСТ СушилкаВключена 
  187          	{
  188          		ЕСЛИ (У_ВКЛ_СУШИЛКУ == ВЫКЛ  && К_РУКИ_ПОД_СУШИЛКОЙ == ВКЛ)
  189          		{
  190          			SendMsgGUICode(БВ2ГОО_ОШИБКА_СамопроизвольноеВыключениеВавтоматРежиме);
  191          			СТОП;
  192          		}
  193          		ИНАЧЕ ЕСЛИ (К_РУКИ_ПОД_СУШИЛКОЙ == ВЫКЛ) В СОСТ ОжиданиеПеремен;
  194          	}
  195          	СОСТ ОжиданиеПеремен
  196          	{
  197          		ЕСЛИ (К_РУКИ_ПОД_СУШИЛКОЙ == ВКЛ) В СОСТ СушилкаВключена;
  198          		ТАЙМАУТ ЗадержкаОбъекта В СОСТ Начало;
  199          	}	
  200          	СОСТ ОшибкаВключения
  201          	{
  202          			SendMsgGUICode(БВ2ГОО_ВключениеРучногоУправленияНЕУспешно);
  203          			СТОП;
  204          	}
  205          	СОСТ ОшибкаВыключения
  206          	{
  207          		СТОП;
  208          	}
  209          	СОСТ СушилкаВыключена 
  210          	{
  211          		ЕСЛИ (У_ВКЛ_СУШИЛКУ == ВКЛ  && К_РУКИ_ПОД_СУШИЛКОЙ == ВЫКЛ)
  212          		{
  213          			SendMsgGUICode(БВ2ГОО_ОШИБКА_СамопроизвольноеВыключениеВавтоматРежиме);
  214          			СТОП;
  215          		}
  216          		ИНАЧЕ ЕСЛИ (К_РУКИ_ПОД_СУШИЛКОЙ == ВЫКЛ) В СОСТ Начало;
  217          	}
  218          }
  219          
  220          ПРОЦ КонтрольОтключенияРучногоУправления
  221          {
  222          ИЗ ПРОЦ Инициализация ФлагРучноеУправлениеПоддверждено;
  223          	СОСТ Старт
  224          	{
  225          		ЕСЛИ (ФлагРучноеУправлениеПоддверждено == ВЫКЛ)
  226          		{
  227          			SendMsgGUICode(БВ2ГОО_ВыключениеРучногоУправленияУспешно);
  228          			В СОСТ Контроль;
  229          		}
  230          		ТАЙМАУТ ОжиданиеОтветаОтАлгоритма В СЛЕДУЮЩЕЕ;
  231          	}
  232          	СОСТ Беда
  233          	{
  234          		SendMsgGUICode(БВ2ГОО_ВыключениеРучногоУправленияНЕУспешно);
  235          		СТОП;
  236          	}
  237          	СОСТ Контроль
  238          	{
  239          		ЕСЛИ (ФлагРучноеУправлениеПоддверждено != ВЫКЛ)
  240          		{
  241          			SendMsgGUICode(БВ2ГОО_СамопроизвольноеВключениеРежимаРучногоУправления);
  242          			СТОП;
  243          		}
  244          	}
  245          }
  246          
  247          ПРОЦ КонтрольВключенияРучногоУправления
  248          {
  249          ИЗ ПРОЦ Инициализация ФлагРучноеУправлениеПоддверждено;
  250          
  251          	СОСТ Старт
  252          	{
  253          		ЕСЛИ (ФлагРучноеУправлениеПоддверждено == ВКЛ)
  254          		{
  255          			SendMsgGUICode(БВ2ГОО_ВключениеРучногоУправленияУспешно);
  256          			В СОСТ Контроль;
  257          		}
  258          		ТАЙМАУТ ОжиданиеОтветаОтАлгоритма В СЛЕДУЮЩЕЕ;
  259          	}	
  260          	СОСТ Беда
  261          	{
  262          		SendMsgGUICode(БВ2ГОО_ВключениеРучногоУправленияНЕУспешно);
  263          		СТОП;
  264          	}
  265          	СОСТ Контроль
  266          	{
  267          		ЕСЛИ (ФлагРучноеУправлениеПоддверждено != ВКЛ)
  268          		{
  269          			SendMsgGUICode(БВ2ГОО_СамопроизвольноеОтключениеРежимаРучногоУправления);
  270          			СТОП;
  271          		}
  272          	}
  273          }
  274          
  275          
  276          }  /* \Прогр */

%RCSL-I-SUMMARY, Completed with 0 error(s).
%RCSL-I-SUMMARY, Completed with 0 warning(s).

 %RCSL-I-SUMMARY, Completed with 0 error(s).