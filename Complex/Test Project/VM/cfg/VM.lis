    1          Прогр ВЕР{
    2          
    3          ТАКТ 50;
    4          КОНСТ ВКЛ 1;
    5          КОНСТ ВЫКЛ 0;
    6          КОНСТ ОжиданиеОтветаОтАлгоритма 10;
    7          КОНСТ ЗадержкаОбъекта 10;
    8          
    9          /*Коды сообщений от оператора */ 
   10          ПЕРЕЧИСЛЕНИЕ {
   11          	КОМ2АУ_В_РУЧНОЕ_УПРАВЛЕНИЕ,
   12          	КОМ2АУ_ОТКЛЮЧИТЬ_РУЧНОЕ_УПРАВЛЕНИЕ,
   13          	КОМ2АУ_ВКЛЮЧИТЬ_СУШИЛКУ,
   14          	КОМ2АУ_ВЫКЛЮЧИТЬ_СУШИЛКУ
   15          };
   16          
   17          /*Коды сообщений к оператору */ 
   18          ПЕРЕЧИСЛЕНИЕ 
   19          {
   20          	АУ2ГУИ_ЕСТЬ_СУШИЛКА_В_РУЧНОЕ_УПРАВЛЕНИЕ,
   21          	АУ2ГУИ_ЕСТЬ_ОТКЛЮЧИТЬ_РУЧНОЕ_УПРАВЛЕНИЕ,
   22          	АУ2ГУИ_СУШИЛКА_ВЫКЛЮЧЕНА,
   23          	АУ2ГУИ_СУШИЛКА_ВКЛЮЧЕНА
   24          };
   25          
   26           /*Набор команд для БВ*/
   27            ПЕРЕЧИСЛЕНИЕ 
   28          {
   29          	БУС2БВ_РУЧНОЕ_УПРАВЛЕНИЕ_ВКЛЮЧЕНИЕ,
   30          	БУС2БВ_РУЧНОЕ_УПРАВЛЕНИЕ_ВЫКЛЮЧЕНИЕ,
   31          	БУС2БВ_АВТОМАТИЧЕСКОЕ_УПРАВЛЕНИЕ_РУКИ_ПОМЕЩЕНЫ,
   32          	БУС2БВ_АВТОМАТИЧЕСКОЕ_УПРАВЛЕНИЕ_РУКИ_УБРАНЫ,
   33          	БУС2БВ_КОНЕЦ_ШТАНОГО_РЕЖИМА	
   34          };
   35          
   36          ПЕРЕЧИСЛЕНИЕ
   37          {
   38          	БУС2БВ_НЕИСПРАВНОСТЬ_РУЧНОЕ_УПРАВЛЕНИЕ_ВКЛЮЧЕНИЕ = БУС2БВ_КОНЕЦ_ШТАНОГО_РЕЖИМА + 1,
   39          	БУС2БВ_НЕИСПРАВНОСТЬ_РУЧНОЕ_УПРАВЛЕНИЕ_ВЫКЛЮЧЕНИЕ,
   40          	БУС2БВ_НЕИСПРАВНОСТЬ_АВТОМАТИЧЕСКОЕ_УПРАВЛЕНИЕ_РУКИ_ПОМЕЩЕНЫ,
   41          	БУС2БВ_НЕИСПРАВНОСТЬ_НЕИСПРАВНОСТЬ_АВТОМАТИЧЕСКОЕ_УПРАВЛЕНИЕ_РУКИ_УБРАНЫ
   42          };
   43          
   44          /*Набор команд для БУС от БВ*/
   45          ПЕРЕЧИСЛЕНИЕ
   46          {
   47          	БВ2БУС_СЛЕДУЮЩИЙ_СЦЕНАРИЙ,
   48          	БВ2БУС_ОШИБКА_ОСТАНОВ
   49          };
   50          
   51          /*Набор Команд для ГОО */
   52          ПЕРЕЧИСЛЕНИЕ
   53          {
   54          	БВ2ГОО_ВключениеРучногоУправленияУспешно,
   55          	БВ2ГОО_ВыключениеРучногоУправленияУспешно,
   56          	БВ2ГОО_ВключениеАвтоматическоеУспешно,
   57          	БВ2ГОО_ВыключениеАвтоматическоеУспешно,
   58          	БВ2ГОО_ТестУспешен,
   59          	БВ2ГОО_ОшибкаТеста,
   60          	БВ2ГОО_ВерификацияЗавершение,
   61          	БВ2ГОО_
   62          };
   63          
   64          ПЕРЕЧИСЛЕНИЕ
   65          {
   66          	БВ2ГОО_ВключениеРучногоУправленияНЕУспешно = БВ2ГОО_ + 1,
   67          	БВ2ГОО_ВыключениеРучногоУправленияНЕУспешно,
   68          	БВ2ГОО_СамопроизвольноеОтключениеРежимаРучногоУправления,
   69          	БВ2ГОО_СамопроизвольноеВключениеРежимаРучногоУправления,
   70          	БВ2ГОО_ОШИБКА_СамопроизвольноеВыключениеВавтоматРежиме,
   71          	БВ2ГОО_ОШИБКА_СамопроизвольноеВключениеВавтоматРежиме
   72          };
   73          
   74          ФУНКЦИЯ ЦЕЛ  SendMsgGUICode       (ЦЕЛ);
   75          
   76          
   77          /*CA Input msg queue*/
   78          
   79          ФУНКЦИЯ ЦЕЛ GetNextMsgFromCA(ПУСТО);
   80          ФУНКЦИЯ ЦЕЛ GetMsgCodeFromCA(ПУСТО);  /*чтение из памяти кода события */
   81          
   82          /*SCM  Input msg queue*/
   83          ФУНКЦИЯ ЦЕЛ GetNextMsgFromSCM(ПУСТО);
   84          ФУНКЦИЯ ЦЕЛ GetMsgCodeFromSCM(ПУСТО);  /*чтение из памяти кода события */
   85          
   86          /*SCM  Output msg queue*/
   87          ФУНКЦИЯ ЦЕЛ SendMsgCodeToSCM(ЦЕЛ);
   88          
   89          ВХОД  ЛОГ_ВЫХОДЫ_ОТ_АУ1  0 0 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
   90          ВХОД  ЛОГ_ВЫХОДЫ_ОТ_АУ2  0 1 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
   91          ВХОД  ЛОГ_ВЫХОДЫ_ОТ_ВОУ1  0 2 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
   92          ВХОД  ЛОГ_ВЫХОДЫ_ОТ_ВОУ2  0 3 8; /* имя, базовый адрес, доп. адр. порта, 8бит */
   93          
   94          ПРОЦ Инициализация
   95          {
   96          	ЛОГ К_РУКИ_ПОД_СУШИЛКОЙ    = {ЛОГ_ВЫХОДЫ_ОТ_ВОУ1[1]} ДЛЯ ВСЕХ;
   97          
   98          /* ВЫХОДНЫЕ СИГНАЛЫ (т.к. привязаны к модулю выходов): */ 
   99          	ЛОГ У_ВКЛ_СУШИЛКУ = {ЛОГ_ВЫХОДЫ_ОТ_АУ1[1]} ДЛЯ ВСЕХ;
  100          
  101          	ЛОГ ФлагРучноеУправление ДЛЯ ВСЕХ;
  102          	ЛОГ ФлагРучноеУправлениеПоддверждено  ДЛЯ ВСЕХ;
  103          	ЛОГ ФлагРукиПодСушилкой  ДЛЯ ВСЕХ;
  104          
  105          /*########  СОСТОЯНИЯ ПРОЦЕССА  #########*/
  106           СОСТ Начало
  107           {  /* NB: 1-е f-сост. 1-го проц. - активно по включению питания */
  108          	ФлагРучноеУправление = ВЫКЛ;
  109          	ФлагРучноеУправлениеПоддверждено = ВЫКЛ;
  110          	ФлагРукиПодСушилкой = ВЫКЛ;
  111          	/* СТАРТ ПРОЦ ЧтениеСообщенийОтАУ; */
  112          	СТАРТ ПРОЦ ЧтениеСообщенийОтБУС;
  113          	СТАРТ ПРОЦ КонтрольОтключенияРучногоУправления;
  114          	СТОП;
  115           }
  116          
  117          } /* \ПРОЦ */
  118          
  119          ПРОЦ ЧтениеСообщенийОтБУС{  
  120          ИЗ ПРОЦ Инициализация ФлагРучноеУправление, ФлагРукиПодСушилкой; 
  121          /* */
  122          ЦЕЛ КодСообщенияОтБУС ЛОКАЛ;
  123           СОСТ Начало{
  124              /*  читаем код и параметр события из кольцевого буфера в структуру */
  125          	SendMsgGUICode(БВ2ГОО_ТестУспешен);
  126          	SendMsgGUICode(БВ2ГОО_ОшибкаТеста);
  127          /*	SendMsgGUICode(БВ2ГОО_ВерификацияЗавершение); */
  128          	
  129              ЕСЛИ (GetNextMsgFromSCM()) 
  130          	{
  131          		КодСообщенияОтБУС = GetMsgCodeFromSCM();
  132          		ЕСЛИ (КодСообщенияОтБУС == БУС2БВ_РУЧНОЕ_УПРАВЛЕНИЕ_ВКЛЮЧЕНИЕ)
  133          		{
  134          			/* ФлагРучноеУправление = ВКЛ; */
  135          			СТОП ПРОЦ КонтрольАвтоматическойРаботыСушилки;
  136          			СТОП ПРОЦ КонтрольОтключенияРучногоУправления;
  137          			СТАРТ ПРОЦ КонтрольВключенияРучногоУправления;
  138          		}
  139          		ИНАЧЕ ЕСЛИ (КодСообщенияОтБУС == БУС2БВ_РУЧНОЕ_УПРАВЛЕНИЕ_ВЫКЛЮЧЕНИЕ)
  140          		{
  141          			/*ФлагРучноеУправление = ВЫКЛ; */
  142          			СТАРТ ПРОЦ КонтрольОтключенияРучногоУправления;
  143          			СТОП ПРОЦ КонтрольВключенияРучногоУправления;
  144          		}
  145          		ИНАЧЕ ЕСЛИ (КодСообщенияОтБУС == БУС2БВ_АВТОМАТИЧЕСКОЕ_УПРАВЛЕНИЕ_РУКИ_ПОМЕЩЕНЫ ||
  146          					КодСообщенияОтБУС == БУС2БВ_АВТОМАТИЧЕСКОЕ_УПРАВЛЕНИЕ_РУКИ_УБРАНЫ)
  147          		{
  148          		 /*	ФлагРучноеУправление = ВЫКЛ; */
  149          			ФлагРукиПодСушилкой = ВКЛ;
  150          			СТАРТ ПРОЦ КонтрольАвтоматическойРаботыСушилки;
  151          		}
  152          	}
  153          	ЗАЦИКЛИТЬ;
  154          }
  155          }
  156          
  157          ПРОЦ КонтрольАвтоматическойРаботыСушилки
  158          {
  159          ИЗ ПРОЦ Инициализация К_РУКИ_ПОД_СУШИЛКОЙ, У_ВКЛ_СУШИЛКУ;
  160          
  161          	СОСТ Начало
  162          	{
  163          		ЕСЛИ (К_РУКИ_ПОД_СУШИЛКОЙ == ВКЛ) В СОСТ ОжиданиеВключения;
  164          		ИНАЧЕ В СОСТ ОжиданиеОтключения; 
  165          	}
  166          	СОСТ ОжиданиеВключения
  167          	{
  168          		ЕСЛИ (У_ВКЛ_СУШИЛКУ == ВКЛ)
  169          		{
  170          			В СОСТ СушилкаВключена;
  171          			SendMsgGUICode(БВ2ГОО_ВключениеАвтоматическоеУспешно);
  172          		}
  173          			
  174          		ТАЙМАУТ ОжиданиеОтветаОтАлгоритма В СОСТ ОшибкаВключения;
  175          	}
  176          	СОСТ ОжиданиеОтключения
  177          	{
  178          		ЕСЛИ (У_ВКЛ_СУШИЛКУ == ВЫКЛ) 
  179          		{
  180          			В СОСТ СушилкаВыключена;
  181          			SendMsgGUICode(БВ2ГОО_ВыключениеАвтоматическоеУспешно);
  182          		}
  183          		ТАЙМАУТ ОжиданиеОтветаОтАлгоритма В СОСТ ОшибкаВыключения;		
  184          	}
  185          	СОСТ СушилкаВключена 
  186          	{
  187          		ЕСЛИ (У_ВКЛ_СУШИЛКУ == ВЫКЛ  && К_РУКИ_ПОД_СУШИЛКОЙ == ВКЛ)
  188          		{
  189          			SendMsgGUICode(БВ2ГОО_ОШИБКА_СамопроизвольноеВыключениеВавтоматРежиме);
  190          			СТОП;
  191          		}
  192          		ИНАЧЕ ЕСЛИ (К_РУКИ_ПОД_СУШИЛКОЙ == ВЫКЛ) В СОСТ ОжиданиеПеремен;
  193          	}
  194          	СОСТ ОжиданиеПеремен
  195          	{
  196          		ЕСЛИ (К_РУКИ_ПОД_СУШИЛКОЙ == ВКЛ) В СОСТ СушилкаВключена;
  197          		ТАЙМАУТ ЗадержкаОбъекта В СОСТ Начало;
  198          	}	
  199          	СОСТ ОшибкаВключения
  200          	{
  201          			SendMsgGUICode(БВ2ГОО_ВключениеРучногоУправленияНЕУспешно);
  202          			СТОП;
  203          	}
  204          	СОСТ ОшибкаВыключения
  205          	{
  206          		СТОП;
  207          	}
  208          	СОСТ СушилкаВыключена 
  209          	{
  210          		ЕСЛИ (У_ВКЛ_СУШИЛКУ == ВКЛ  && К_РУКИ_ПОД_СУШИЛКОЙ == ВЫКЛ)
  211          		{
  212          			SendMsgGUICode(БВ2ГОО_ОШИБКА_СамопроизвольноеВыключениеВавтоматРежиме);
  213          			СТОП;
  214          		}
  215          		ИНАЧЕ ЕСЛИ (К_РУКИ_ПОД_СУШИЛКОЙ == ВЫКЛ) В СОСТ Начало;
  216          	}
  217          }
  218          
  219          ПРОЦ КонтрольОтключенияРучногоУправления
  220          {
  221          ИЗ ПРОЦ Инициализация ФлагРучноеУправлениеПоддверждено;
  222          	СОСТ Старт
  223          	{
  224          		ЕСЛИ (ФлагРучноеУправлениеПоддверждено == ВЫКЛ)
  225          		{
  226          			SendMsgGUICode(БВ2ГОО_ВыключениеРучногоУправленияУспешно);
  227          			В СОСТ Контроль;
  228          		}
  229          		ТАЙМАУТ ОжиданиеОтветаОтАлгоритма В СЛЕДУЮЩЕЕ;
  230          	}
  231          	СОСТ Беда
  232          	{
  233          		SendMsgGUICode(БВ2ГОО_ВыключениеРучногоУправленияНЕУспешно);
  234          		СТОП;
  235          	}
  236          	СОСТ Контроль
  237          	{
  238          		ЕСЛИ (ФлагРучноеУправлениеПоддверждено != ВЫКЛ)
  239          		{
  240          			SendMsgGUICode(БВ2ГОО_СамопроизвольноеВключениеРежимаРучногоУправления);
  241          			СТОП;
  242          		}
  243          	}
  244          }
  245          
  246          ПРОЦ КонтрольВключенияРучногоУправления
  247          {
  248          ИЗ ПРОЦ Инициализация ФлагРучноеУправлениеПоддверждено;
  249          
  250          	СОСТ Старт
  251          	{
  252          		ЕСЛИ (ФлагРучноеУправлениеПоддверждено == ВКЛ)
  253          		{
  254          			SendMsgGUICode(БВ2ГОО_ВключениеРучногоУправленияУспешно);
  255          			В СОСТ Контроль;
  256          		}
  257          		ТАЙМАУТ ОжиданиеОтветаОтАлгоритма В СЛЕДУЮЩЕЕ;
  258          	}	
  259          	СОСТ Беда
  260          	{
  261          		SendMsgGUICode(БВ2ГОО_ВключениеРучногоУправленияНЕУспешно);
  262          		СТОП;
  263          	}
  264          	СОСТ Контроль
  265          	{
  266          		ЕСЛИ (ФлагРучноеУправлениеПоддверждено != ВКЛ)
  267          		{
  268          			SendMsgGUICode(БВ2ГОО_СамопроизвольноеОтключениеРежимаРучногоУправления);
  269          			СТОП;
  270          		}
  271          	}
  272          }
  273          
  274          
  275          }  /* \Прогр */

%RCSL-I-SUMMARY, Completed with 0 error(s).
%RCSL-I-SUMMARY, Completed with 0 warning(s).

 %RCSL-I-SUMMARY, Completed with 0 error(s).